# URLの応用

HTMLの属性には、属性値としてURLを指定するものが多数あります。URLについては既にCHAPTER 1-5で説明しましたが、ここではURLのさまざまな形式と、属性値として指定する際の注意点を説明します。

## 絶対URLと相対URL

属性の中には、値としてURLを指定するものがあります。代表例は`a`要素の`href`属性です。

01 絶対URLをhref属性に記述した例

```html
<a href="https://example.com/foo/bar.html">bar</a>
```

スキームから始まる形式のURLは、「絶対URL（absolute URL）」といいます。01は絶対URLで記述した例です。

一方で、スキームで始まらない形式のURLを「相対
URL（relativeURL）」といいます。属性にURLを指定する場合、相対URLも利用できます。

02 相対URLをhref属性に記述した例

```html
<a href="../bar.html">bar</a>
```

相対URLは、「基準URL（base URL）」からの相対位置を示すものです。基準URLは`base`要素で指定できますが、`base`要素による指定がない場合は現在のURLが基準URLとなります。

相対URLには、さらに以下のような種類があります。

- スキーム相対URL（scheme relative URL）
- パス絶対URL（path absolute URL）
- パス相対URL（path relative URL）

### スキーム相対URL

スキーム相対URLは、絶対URLからスキームと`:`を取り除いたもので、先頭が//で始まり、ホスト名が続きます

03 スキーム相対URLの例

```text
//example.com/foo/bar.html
```

スキーム相対URLを使用した場合、スキームは基準URLと同じものとみなされます。03の例は、基準URLのスキームが`https`ならば`https://example.com/foo/bar.html`に、`http`ならば`http://example.com/foo/bar.html`と同じになります。

### パス絶対URL

パス絶対URLは、スキーム相対URLから`//`とホスト名を取り除いたもので、先頭が`/`で始まり、パスの記述が続きます。

04 パス絶対URLの例

```text
/foo/bar.html
```

パス絶対URLを使用した場合、スキームとホスト名は基準URLと同じものとみなされます。
メモ:名前に「絶対」とありますが、これはURL全体が絶対という意味ではなく、パス部分が絶対パスで書かれているという意味です。パス絶対URLは絶対URLではなく、相対URLの一種です。

### パス相対URL

パス相対URLは、先頭が`/`で始まらないパスです。

05 パス相対URLの例

```text
foo/bar.html
```

パス相対URLを使用した場合、スキームとホスト名は基準URLと同じとみなされ、基準URLからの相対パスとして解釈します。

パスの`/`で区切られたそれぞれの部分を「URLパスセグメント（URL pathsegment）」といいます。05の例では`foo`と`bar.html`がURLパスセグメントにあたります。

特殊なURLパスセグメントとして、現在と同じ階層を示す`.`（単一ドットパスセグメント：single-dot path segment）と、親階層を示す`..`（二重ドットパスセグメント：double-dot path segment）があります。

パス相対URLでこれらを使用すると、現在の階層や親階層を指定できます。たとえば、基準URLのパスが`/foo/bar/baz.html`であるとき、以下のようになります。

- `./`→`/foo/bar/`
- `../`→`/foo/`
- `../../`→`/`
- `./baz2.html`→`/foo/bar/baz2.html`
- ../baz2.html → /foo/baz2.html 

## URLに使える文字とパーセントエンコード

URLに使える文字は、「URLコードポイント（URL code points）」として定められています。具体的には、次の文字になります。
- ASCII英数字（ASCII alphanumeric） 
- 記号類：!、$、&、'、(、)、*、+、,、-、.、/、:、;、=、?、@、_、~ 
- U+00A0～U+10FFFDのUnicode文字。ただし、「サロゲート(surrogates)」と「非文字(noncharacters)」を除く

メモ:括弧`(`および`)`が使えることに注意してください。メールなどで文中のURLがリンクになるような仕組みがありますが、`(https://example.com)`と書くと、末尾の`)`がURLの一部とみなされることがあります。不等号（`<`および`>`）はURLに使用できないため、URLを囲みたい場合は`<https://example.com>`のように不等号を使うと誤認識を防げます。

### パーセントエンコード

URLに使えない文字や、特別な意味に解釈される文字は、「パーセントエンコードバイト（percent-encoded bytes）」として記述できます。文字をパーセントエンコードバイトに変換することを「パーセントエンコード（percent-encode）」といいます。

パーセントエンコードバイトは、`%`に続いて2桁の16進数で文字コードを表現します。たとえば、`<`は`%3C`、`>`は`%3E`となります。`%`文字そのものを書きたい場合は、`%25`と記述します。

非ASCII文字をパーセントエンコードする際には、原則としてUTF-8で符号化して扱います。たとえば、「日本語」という文字列の場合、UTF-8で符号化すると以下のようになります。

- 「日」（U+65E5）→ E6 97 A5
- 「本」（U+672C）→ E6 9C AC
- 「語」（U+8A9E）→ E8 AA 9E

これをパーセントエンコードすると06のようになります。 

06パーセントエンコードバイトの例

```text
%E6%97%A5%E6%9C%AC%E8%AA%9E
```

### パーセントデコード

パーセントエンコードされた文字を元に戻すことを「パーセントデコード（percent-decode）」といいます。パーセントデコードの処理では、`%`に続いて2桁の16進数と解釈できる文字が出現した場合、それを元の文字に戻します。たとえば、`%2F`は`/`となります。

パーセントエンコード・デコードの処理の詳細については、 URLStandard[^6]を参照してください。 
[^6]: <https://url.spec.whatwg.org/#percent-encoded-bytes>

### `&`を含むURLを属性値に記述する場合

URLのクエリーには`&`が含まれることがあります。前述のように`&`はURLに使える文字であり、URLの中に出現しても問題ありません。しかし、`&`はHTMLの文字参照に使用する文字でもあるため、`&`を含むURLを属性値に記述するときは、`&amp;`と書く必要があります。

07 &を含むURLを属性値に記述する例

```html

<a href="foo.php?name=a&amp;value=b">
```

## サブリソースとして利用できるURLスキーム

HTMLの要素の中には、属性に「サブリソース（subresource）」のURLを指定するものもあります。サブリソースとは、起点となるHTMLファイル以外のリソースで、HTMLに埋め込まれる画像などのメディアファイル、CSSファイル、JavaScriptファイルなどが該当します。

たとえば、`img`要素の`src`属性に画像のURLを指定すると、HTML文書の中に画像を埋め込んで表示できます。

08 属性にサブリソースを利用した例

```html

<img src="https://example.com/foo.png" alt="foo">

```

08のURLのスキームはhttps であり、サブリソースとして利用可能な「Fetchスキーム（fetch scheme）」に分類されます。Fetch Standard[^7]では、以下のスキームをFetchスキームと定義しています。
[^7]: <https://fetch.spec.whatwg.org/>

- http、https：一般的に利用されるウェブを経由した取得
- file：ローカルファイルを指定して取得
- about：about:blankとして空のリソースを取得
- blob：JavaScriptなどで生成したデータURL
- data：インラインに埋め込まれるデータURL 

### Fetchスキーム以外のスキーム

Fetchスキーム以外のURLのスキームは、リソースを取得できないため、サブリソースとして利用できません。

たとえば、`mailto`スキームや`javascript`スキームは、`img`要素の`src`属性に指定した場合、多くのブラウザーは壊れた画像のアイコンを表示します。これらのスキームを持つURLはサブリソースとして利用できません。

09リソースを取得できないURLの記述例

```html

<img src="mailto:foo@example.com" alt="foo@example.com"> 
<img src="javascript:alert(1)" alt="alert"> 

