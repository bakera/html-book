<!-- ch3-7.txt (4ページ、3000～4600字想定) -->
# エンベディッドコンテンツ

ウェブページでは、画像や音声、映像などのメディアを埋め込むことができます。また、あるウェブページに他のウェブページを埋め込むこともできます。このChapterでは、このようなメディアの埋め込みを行う要素について説明します。

## `img`要素

`img`要素は、画像を表す要素です。PNG、GIF（アニメーションGIFを含む）、JPEG、SVGといった画像をHTMLに埋め込むことができます。

### 内容モデル

`img`要素の内容モデルはNothingで、内容を持つことはできません。また、終了タグを書くこともできません。

### 属性

基本的には、`src`属性で画像のURLを指定し、`alt`属性で代替テキストを指定します。また、いくつかの廃止された属性についても取り上げます。

#### `src`属性

`src`属性で画像のURLを指定します。

```html
<img src="cat.png" alt="ねこのかわいい写真">
```

データURLを指定することで、画像を直接埋め込むこともできます。データURLについてはChapter2-3を参照してください。以下はデータURLでSVG画像を埋め込んだ例です。

```html
<img src="data:image/svg+xml,%3csvg%20xmlns%3d%22http%3a%2f%2fwww.w3.org%2f2000%2fsvg%22%20viewbox%3d%220%200%20100%20100%22%3e%3crect%20fill%3d%22%23ff3300%22%20width%3d%22100%22%20height%3d%22100%22%20rx%3d%2220%22%20ry%3d%2220%22%2f%3e%3c%2fsvg%3e" alt="">
```

上記の例のように、SVGの場合はXMLのテキストをそのままエンコードして記述でき、base64エンコードは必ずしも必要ありません。しかし、テキスト埋め込み形式のデータURLに対応していないレガシーブラウザー<!-- (IEなど) -->の互換性のために、あえてbase64エンコードして埋め込むこともあります。

#### `srcset`属性

`srcset`属性を使用すると、複数の画像候補を指定できます。詳細は、後述の「`picture`要素とレスポンシブ画像」で説明します。

#### `alt`属性

`alt`属性は、画像の代替テキスト（alternative text）または置換テキスト（replacement text）を表します。

何らかの原因で画像が見られない場合、画像の代わりに代替テキストによって内容が伝えられます。スクリーンリーダーのユーザーがアクセスした場合はもちろん、検索エンジンなどの機械がアクセスする場合や、ネットワークの不調により画像が表示できない場合など、さまざまな場合に代替テキストが活用されます。

構文上は`alt`属性は省略できますが、原則として省略してはなりません。装飾的な画像の場合は`alt=""`を指定し、そうでない場合は画像と等価な代替テキストを属性値に記述しなければなりません。

`alt`属性は、ウェブアクセシビリティを考える上で、もっとも重要な属性の1つに挙げられます。アクセシビリティ上の注意点も参照してください。

#### `loading`属性

`loading`属性は、lazy loadingとして知られる遅延読み込みを制御します。`loading`属性は列挙型属性で、値は"`lazy`"と"`eager`"の2つです。`eager`がデフォルト状態で、従来どおり画像を読み込みます。`lazy`が遅延読み込みを指示します。

```html
<!-- ユーザーエージェントに画像の遅延読み込みを指示 -->
<img src="resource" alt="" loading="lazy">
```

`img`要素が画面外にあっても、通常は`src`属性で指定したURLのリソースを読み込み、レンダリングしようとします。しかし、画面外の`img`要素の画像は、今すぐには必要ないかもしれません。`lazy`を指定すると、`img`要素がビューポートの外にあるときには画像の読み込みを抑制できます。こうすることで、他のサブリソースを優先して読ませることができます。

#### 廃止された属性:`border`属性

かつてのHTML仕様では`img`要素に`border`属性が定義されていましたが、現在では廃止されています。

ただし、`border`属性の値が"0"の場合のみ「旧式だが適合する機能」(Obsolete but conforming)として扱われ、ブラウザーによって解釈されることが期待されます。これは、画像にリンクを付与した場合に、枠線を表示しないようにするテクニックとして使われていたものです。

コンテンツ制作者は`img`要素の`border`属性を使用するべきではありません。画像の枠線を制御したい場合は、`border`属性の代わりにスタイルシートで設定します。

#### 廃止された属性:`hspace`属性、`vspace`属性

古いHTML仕様では、画像の周囲に余白を取るための`hspace`属性、`vspace`属性が定義されていました。CSSで同じ表現ができるため、これらは廃止されています。画像の周囲の余白はCSSで指定します。

#### 廃止された属性:`align`属性

`align`属性は、画像の配置を指定する属性です。"`left`"や"`right`"を指定すると、画像が左右に配置され、続くテキストが画像を回り込むように配置されます。これはCSSの`float`プロパティと同等の機能です。CSSで同じ機能が実現できるため、この属性は廃止されています。画像のフロート配置はCSSで行います。

#### 廃止された属性:`longdesc`属性

HTML4では、`img`要素に`longdesc`属性が定義されていました。

これは画像の説明を参照するための属性で、属性値にはURLを指定します。`a`要素のように画像をクリックして飛ぶというものではなく、ブラウザーやスクリーンリーダーの機能でリンク先の説明が利用できる想定でした。具体的な用法は、Techniques for WCAG 2のH45<!-- Using longdesc-->[^1]を参照してください。

[^1]: <https://w3c.github.io/wcag/techniques/html/H45>

ウェブアクセシビリティのために導入された属性ですが、適切に利用されるケースが少なく、対応するブラウザーも少なかったため、現在のHTML仕様では削除されています[^2]。

[^2]: HTML5 Image Description Extension (longdesc)で再定義されていますが、事実上機能していません。<https://www.w3.org/TR/html-longdesc/>

画像の詳細な説明を提供したい場合は、可視のテキストとして説明を配置するか、あるいは`a`要素で説明にリンクさせるとよいでしょう。具体例については、Techniques for WCAG 2のG73<!-- Providing a long description in another location with a link to it that is immediately adjacent to the non-text content-->[^3]が参考になるでしょう。

[^3]: <https://w3c.github.io/wcag/techniques/general/G73>

### アクセシビリティ上の注意点

`img`要素のデフォルトARIAロールは、`alt`属性の値によって変化します。

空でない`alt`属性が指定されている場合は`img`ロールとなり、意味のある画像が存在する扱いになります。多くのスクリーンリーダーは、代替テキストを読み上げたあとに「イメージ」「画像」などと読み上げ、そこに画像があることを伝えます。

空の`alt`属性（すなわち`alt=""`）が指定されている場合は`presentation`ロールとなり、特定の役割を持たない状態になります。スクリーンリーダーは画像を無視し、何も読み上げません。画像の存在自体が伝えらないことに注意してください。装飾画像など、読み上げないほうが望ましいものに対して`alt=""`を指定するとよいでしょう[^4]。

[^4]: いわゆるスペーサー画像も該当しますが、仕様では`img`要素をレイアウトに用いてはならない<!--("The img element must not be used as a layout tool.")-->とされています。<https://html.spec.whatwg.org/multipage/embedded-content.html#the-img-element>

`alt`属性そのものが省略されている場合、意味のある画像があり、しかしながら代替テキストが提供されていないと解釈されます。この場合、スクリーンリーダーは画像の内容を可能な限り伝えようとします。`title`属性やその他の属性でテキストが指定されていればそのテキストを読み上げますが、そうでない場合の挙動はスクリーンリーダーによって異なります。「ラベルのない画像」と読み上げることもあれば、画像のファイル名を読み上げることもあります。

システムが生成した無意味な英数字の羅列がファイル名に使われている場合、読み上げられると混乱を招くことがあります。

```html
<img src="/assets/93cc401e5a2939b25985d1db70de2aa9.jpg">
```

この例では、突如として「きゅうさんシーシー…（略）…エーきゅう、ジェイピージー、イメージ」という意味不明な読み上げが行われることになります。

いずれの場合も、`alt`属性がなければユーザーは画像の内容を知ることができません。`alt`属性を省略するのは最後の手段と考えましょう。HTML仕様では`alt`属性を省略できる場合もあるとされていますが、省略できるケースは極めて限定されています[^5]。

[^5]: <https://html.spec.whatwg.org/multipage/images.html#unknown-images>

どのような場合に属性値を空にするのか（`alt=""`）、どのような代替テキストが望ましいか、属性そのものを省略するのはどのような場合かについての例は、HTML仕様のRequirements for providing text to act as an alternative for images[^6]で詳しく説明されています。また、アクセシビリティの観点からAn alt Decision Tree[^7]というW3Cによるリソースも存在します。それぞれ参考にするとよいでしょう。

[^6]: https://html.spec.whatwg.org/multipage/images.html#alt

[^7]: https://www.w3.org/WAI/tutorials/images/decision-tree/

#### `alt`属性の値をどのように書くか

`alt`属性を指定するときは、どのような意図で画像を使っているか把握した上で、画像をテキストに置き換えても違和感なく、内容が過不足なく伝わるように記述します。

しかし、実際にどのようなテキストを設定するのかは悩ましいところです。代替テキストもコンテンツであり、その文章の書き方に唯一の正解は存在しません。画像を通して伝えたい内容は、そのページのコンテキストにも依存します。

ここでは、代替テキストを記述する際のヒントとして、2つの原則を紹介します。

##### 代替テキストの第1原則：画像と等価なテキストであること

1つ目の原則は、画像と等価なテキストであることです。画像の内容を過不足なく伝えるものである必要があります。画像を代替テキストに置き換えた際に、コンテンツの意味が変わらないようにする必要があります。

代替テキストを考えるにあたっては、電話で誰かに画像を伝えることを想像するという方法があります。電話口でコンテンツを順に読み上げていく際に、画像の部分をどう読み上げるか考え、それを代替テキストにするとよいでしょう。ただし、必要以上に詳しく説明したり、意味を補ったりしないように注意してください。

なお、「画像と等価」とは、画像と代替テキストが1対1で対応するという意味ではありません。代替テキストの内容は、画像そのものだけでなく、前後の文脈にも影響を受けます。ときには、同じ画像にまったく異なる代替テキストを指定することもあります。

たとえば、ある駅とその駅の周辺の地図があり、最寄りの駅、会社のビル、近くのコンビニエンスストアの位置が示されているとします。

<!-- 地図の例。
イメージとしては、 https://www.ginza-vd.com/wp-content/themes/vd/img/imgMap.gif このような画像でより抽象化した架空の地図を用意する -->

会社案内のページにこの画像を掲載する場合、以下のような代替テキストが考えられるでしょう。

```html
<p>
<img src="rough-map.png" alt="当社入居ビルまでの地図。九段下駅の6番出口から出て、靖国通りを西に進み、九段下の交差点を南に進んだ建物です。">
```

ここでは会社への経路を伝えることを目的としているため、経路に関係のないコンビニエンスストアについては、代替テキストでは言及しません。

しかし、まったく同じ地図の画像を使って、コンビニエンスストアの場所を伝えたい場合もあるかもしれません。そのような場合は、代替テキストでコンビニエンスストアへの道順を説明する必要があるでしょう。このように、まったく同じ画像でも、文脈によって代替テキストが異なる場合があってよいのです。

##### 代替テキストの第2原則：繰り返しを避ける

もう1つの原則は、繰り返しを避けることです。画像の前後にキャプションや説明文を提供することがしばしばありますが、その情報を繰り返すべきではありません。以下の例は、先の例と同じ地図を想定していますが、ここでは地図の下に道順の説明文が付いています。

<!-- 地図の例2 -->
```html
<p><img src="rough-map.png" alt="当社ビルまでの地図">
<p>当社入居ビルまでの地図。九段下駅の6番出口から出て、靖国通りを西に進み、九段下の交差点を南に進んだ建物です。</p>
```

地の文で道順を示しているため、`alt`属性には道順を記載せず、単にどのような画像かを記しています。冗長な情報を省くことで、スクリーンリーダーが同じ内容を二度読み上げることを防ぎます。

なお、`alt=""`を指定すると画像の存在自体が伝わらないことに注意してください。上記の例では、`alt`属性の内容と直後の文の冒頭が重複していますが、属性値をすべて省いて`alt=""`を指定した場合、スクリーンリーダーのユーザーには画像の存在自体が伝わらないことがあります。また、画像を保存するといった操作も難しくなります。意味のある画像に対しては、多少重複しても何らかの代替テキストを指定しておくほうがよいでしょう。
<!-- /a11y note -->

## `picture`要素とレスポンシブ画像

`picture`要素や`srcset`属性、`sizes`属性を使用すると、状況による画像の出しわけ、いわゆる「レスポンシブ」な画像を実現できます。コンテンツ制作者は複数の画像リソースを提示し、ユーザーエージェントがその中から最適な画像を選択します。選択の基準には以下の4つがあります。

- デバイスピクセル比に基づく選択（Device-pixel-ratio-based selection）
- ビューポートに基づく選択（Viewport-based selection）
- アートディレクションに基づく選択（Art direction-based selection）
- 画像フォーマットに基づく選択（Image format-based selection）

最初の2つは`img`要素の`srcset`や`sizes`属性を用いて、後ろの2つは`picture`と`source`要素を用いて実現します。以下、各選択基準について簡単に説明します。

### デバイスピクセル比に基づく選択

画像のレンダリングサイズを固定した上で、デバイスピクセルの異なる複数の画像を提示して、そのデバイスに適した解像度の画像を選択します。より高精細な画面で高解像度の画像を表示させたい場合などに利用できます。

<!-- HTML LS -->
```html
<img src="/uploads/100-marie-lloyd.jpg"
     srcset="/uploads/150-marie-lloyd.jpg 1.5x, /uploads/200-marie-lloyd.jpg 2x"
     alt="" width="100" height="150">
```

`srcset`属性で複数の画像を指定し、それぞれに`x`記述子でデバイスのピクセル比を記述します。これにより、高いデバイスピクセル比を持つスクリーンで、より高解像度となる画像が選択されます。

### ビューポートに基づく選択の例

画像のレンダリングサイズを固定せずに、デバイスピクセルの異なる複数の画像を提示して、ビューポートの大きさに適したサイズの画像を選択します。ウィンドウの一定割合を画像で表示させたい場合など利用できます。

<!-- HTML LSからのコピー -->
```html
<img sizes="100vw" srcset="wolf-400.jpg 400w, wolf-800.jpg 800w, wolf-1600.jpg 1600w"
     src="wolf-400.jpg" alt="The rad wolf">
```

`srcset`属性で複数の画像を指定し、それぞれに`w`記述子で画像のサイズを記述します。`sizes`属性で指定されるレンダリングサイズから各画像の効果的なピクセル密度を算出し、画面のピクセル密度、ズームレベル、ネットワークの状態などから、最適な画像をユーザーエージェントが選択します。

上記のコード例では、たとえばビューポートの幅が320 CSSピクセルである場合（100vw=320pxとなる場合）、`wolf-400.jpg 1.25x, wolf-800.jpg 2.5x, wolf-1600.jpg 5x`という指定と等価になります。

なお、上記のコード例では`src`属性と`srcset`属性の両方で"wolf-400.jpg"を指定していますが、これは互換性のための指定です。`srcset`属性の`w`記述子を理解するユーザーエージェントは`src`属性を無視します。

### アートディレクションに基づく選択

複数の画像を提示し、それぞれに対してメディアクエリーを指定すると、指定した状況に応じて画像を切り替えることができます。縦長の画面と横長の画面で表示する画像を切り替えたい場合など、コンテンツ制作者側で細かい制御をしたい場合に利用できます。

<!-- https://dev.opera.com/articles/ja/responsive-images/ 改 -->
```html
<picture>
  <source media="(min-width: 1024px)"
                srcset="fullshot.jpg">
  <img src="closeup.jpg" alt="Opera House">
</picture>
```

ブラウザーのウィンドウ幅が1024 CSSピクセル以上の場合、全景の写真（fullshot.jpg）が選択されます。ウィンドウ幅がそれよりも小さい場合は、ズームアップされた写真（closeup.jpg）が選択されます。

### 画像フォーマットに基づく選択の例

ウェブで使用できる画像のフォーマットにはさまざまなものがありますが、ユーザーエージェントがそのすべてに対応しているとは限りません。モダンなユーザーエージェントには新しいフォーマットの画像を表示させつつ、対応していないユーザーエージェントには広くサポートされている古い画像フォーマットを選択させたいような場合に、この機能を利用できます。

```html
<picture>
  <source srcset="happy.webp" type="image/webp">
  <source srcset="happy.jxr" type="image/vnd.ms-photo">
  <img src="happy.jpg" alt="">
</picture>
```

この例ではブラウザーがWebPをサポートする場合はWebPを、そうでなければJPEG XR画像を、いずれもサポートしない場合はフォールバックとしてJPEGが選択されます。

<!--
参考リソース
https://www.html5rocks.com/ja/tutorials/responsive/picture-element/
https://dev.opera.com/articles/ja/responsive-images/
https://developer.mozilla.org/ja/docs/Web/HTML/Element/picture
https://developer.mozilla.org/ja/docs/Web/HTML/Element/source
-->

<!-- 画像だけ、というわけでもない -->
## `iframe`要素

`iframe`（インラインフレーム）要素は、現在表示しているページに別のウェブコンテンツを埋め込む要素です。他のドメインのコンテンツでも埋め込めるため、サードパーティのドメインから配信される動画やスライド、広告といったものを埋め込む目的でよく利用されています。

### 内容モデル

`iframe`要素の内容モデルはNothingです。つまり、内容に何も入れることができません。にもかかわらず、`iframe`要素の終了タグは省略できません。

歴史的には、`iframe`要素を解釈しないブラウザーに対して、`iframe`要素の内容をフォールバックとして認識させる書き方がありました。

```html
<!-- 現在では正しくない書き方 -->
<iframe src="xxx.html">iframeを知らないブラウザーに表示させたい内容</iframe>
```

現在ではこのような書き方は許されておらず、この例は単に構文違反になります。ブラウザーは`iframe`要素の内容を無視し、表示しません。
<!-- /内容モデル -->

### 属性

#### `src`属性

`src`属性はリソースの存在するURLを指定します。以下の例では、YouTubeの埋め込みプレーヤーのURLを指定しています。

```html
<iframe width="560" height="315" src="https://www.youtube.com/embed/JDc-xApip7k" title="YouTube video player"></iframe>
```

#### `allow`属性、`allowfullscreen`属性

`allow`属性はPermissions policy仕様[^8]に基づいて、許可する機能やAPIを指定するものです。

`allowfullscreen`属性もPermissions policy仕様に基づくもので、全画面表示のAPI `requestFullscreen()`を許可するブール型属性です。

[^8]: Permissions Policy <https://w3c.github.io/webappsec-permissions-policy/>

#### `srcdoc`属性

`srcdoc`属性を使用すると、属性値にHTMLを指定して直接埋め込むことが可能です。

```html
<iframe sandbox srcdoc="<p>ごはんを温めますか？"></iframe>
```

#### `loading`属性

`loading`属性を用いると、`img`要素と同様に遅延読み込みを指定できます。詳細は`img`要素の`loading`属性を参照してください。

#### 廃止された属性: `frameborder`属性

かつてのHTMLでは`frameborder`属性が定義されており、`iframe`要素の周囲の枠線の表示を制御できました。コンテンツ制作者は`frameborder`属性を使用するべきではありません。枠線を制御したい場合は、代わりにスタイルシートで設定します。

`iframe`要素を使って外部サービスを埋め込むための埋め込みコードには、この属性が利用されていることがあります。たとえば、以下は2021年9月に確認したYouTubeの埋め込みコードです。

```html
<iframe width="560" height="315" src="https://www.youtube.com/embed/JDc-xApip7k" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
```

#### `sandbox`属性

`iframe`要素に`sandbox`属性を指定すると、iframeに埋め込まれたコンテンツの機能を制限できます。たとえば、JavaScriptの実行やフォームの送信などを禁止できます。属性値が空文字列の場合（`sandbox=""`もしくは単に`sandbox`と指定した場合）、すべての機能を制限します。

```html
<iframe src="https://example.com/" sandbox></iframe>
```

特定機能の制限を解除したい場合は、その機能に対応するトークンを属性値に指定します。複数の機能を許可したい場合、スペース区切りで複数のトークンの指定も可能です。たとえば、以下の例ではフォーム送信とダウンロードを許可しています。

```html
<iframe src="https://example.com/download-form"
  sandbox="allow-forms allow-downloads">
</iframe>
```

指定できるトークンの詳細はMDNを参照してください[^9]。

[^9]: <https://developer.mozilla.org/ja/docs/Web/HTML/Element/iframe#attr-sandbox>

##### セキュリティ上の注意点
<!-- security consideration -->
`iframe`要素にはセキュリティ上の問題も多く知られており、使い方を誤ると攻撃に悪用されることがあります。

`iframe`要素で読み込んだウェブページと、`iframe`要素の置かれたウェプページは、`postMessage`という機能で通信して情報のやり取りができます。本書では詳細を述べませんが、この利用方法を誤ると、情報漏洩などのセキュリティ問題を起こすことがあります。[^10]

[^10]: 徳丸浩著「体系的に学ぶ 安全なWebアプリケーションの作り方 第2版 脆弱性が生まれる原理と対策の実践」などが参考になります。
<!--
https://blog.jxck.io/entries/2018-03-08/feature-policy-permission-delegation.html
-->

また、`iframe`要素を悪用する攻撃手法もあります。その代表例が「クリックジャッキング」で、攻撃側のサイトで`iframe`要素を利用します。この攻撃への対策として、多くのウェブサイトが`iframe`要素で読み込まれないように制限をするようになりました。かつては外部サイトであっても自由に`iframe`要素で埋め込むことができましたが、現在は埋め込みできないサイトが増えています。
<!-- https://www.jpcert.or.jp/research/HTML5-20131030.pdf -->
<!-- /security consideration -->

### アクセシビリティ上の注意点

`iframe`要素はアクセシビリティ上の問題を起こしやすい要素です。スクリーンリーダーでは`iframe`要素の内容をそのまま読み上げる場合や、能動的に操作をしないと中身を読み上げない場合など、種類や設定によって扱われ方が異なります。

`iframe`要素に`title`属性を付けておくと、スクリーンリーダーはその`title`属性の値を読み上げることがあります。読み上げる必要のない`iframe`要素を読み飛ばしたいと考えるユーザーもいるため、`iframe`要素には正確な名前を付けておくとよいでしょう。[^11]

[^11]: WCAG2 SC 2.4.1を満たすのに十分な方法です。Techniques for WCAG 2 H64も参照。<https://www.w3.org/WAI/WCAG21/Techniques/html/H64>

外部のウェブサービスのコンテンツを埋め込んで利用する際、サービス側から指定された埋め込みコードに`iframe`要素が含まれることがあります。この場合、提供されるHTMLコードは、構文上必ずしも正しいとは限りません。アクセシビリティの配慮が不足していることも多く、そのまま利用すると問題を起こす場合があります。外部から提供されたコードについても、アクセシブルであるかどうか確認してから用いると良いでしょう。
<!-- /a11y note -->

## `object`要素と`param`要素

`object`要素は、外部リソースを表す汎用的な要素です。主にプラグインで処理されるコンテンツなどを埋め込むことができます。画像や映像、音声、HTML文書の埋め込みにも利用できますが、`img`、`iframe`、`video`、`audio`要素といった専門の要素で代用可能なことが多いでしょう。

子要素に`param`要素を持つことができます。これにより、`object`要素にパラメーターを与えることができます。

次のコードはFlashプラグインを用いるFlashの動画を埋め込む古典的な例です。[^12]

[^12]: Flashプラグインのサポートは終了しているため、モダンな環境ではもはやこのコードは動作しません。

```html
<!-- object要素のみで指定 -->
<object data="movie.swf"
  type="application/x-shockwave-flash"></object>

<!-- param要素と併用で指定 -->
<object type="application/x-shockwave-flash">
  <param name="movie" value="movie.swf">
</object>
```

### 内容モデル

`object`要素の内容モデルは`param`要素と、それに続いてTransparentの内容を書くことができます。Transparentの部分はフォールバックコンテンツとなります。

フォールバックコンテンツは、指定したリソースが埋め込み表示できない場合に使われるもので、画像でいう代替テキストの機能を果たします。`img`要素の`alt`属性と異なり、マークアップを含むことができるため、メディアへの直接リンクを提供したり、テキストの一部を強調したりもできます。

```html
<object data="rough-map.png">
  <!--画像が埋め込み表示できない場合、画像へのリンクとテキストが表示される-->
  <p><a href="rough-map.png">当社入居ビルまでの地図</a>。
  九段下駅の<em>6番出口</em>から出て、靖国通りを西に進み、九段下の交差点を南に進んだ建物です。</p>
</object>
```

`object`要素の中に`object`要素を記述する入れ子にもできます。この場合、親から順に表示を試みて、表示できない場合には子に随時フォールバックしていきます。

```html
<!-- できればsvgを表示したい -->
<object data="image.svg">
  <!-- svgがだめならwebpを表示 -->
  <object data="image.webp">
    <!-- webpもだめならpngを表示 -->
    <object data="image.png">
      <!-- 画像が何も表示できないなら代替テキストを使用 -->
      <p>代替テキストです</p>
    </object>
  </object>
</object>
```
<!-- /内容モデル -->

### アクセシビリティ上の注意点

`object`要素にデフォルトのロールはありません。`object`要素はさまざまなリソースを扱えるため、リソースに応じたロールを付けておくとよいでしょう。画像であれば`role="img"`、HTMLなどの文書であれば`role="document"`の指定が考えられます。

`object`要素の内容がアプリケーションのようなものであって、キー操作を必要とする場合、`role="application"`を指定すると、スクリーンリーダーにキー操作を横取りされず、直接操作できることが期待されます。

`role="img"`を追加した場合、スクリーンリーダーによっては単に「ラベルのない画像」とだけ読み上げ、フォールバックコンテンツの内容を確認できないことがあります。この場合、`aria-labelledby`属性[^13]でフォールバックコンテンツを参照すれば読まれることもありますが、このように苦労して`object`要素を使うより、`img`要素を利用する方が早いでしょう。

[^13]: `aria-labelledby`属性についてはChapter4-1を参照してください。
<!-- /a11y note -->

### コラム：`object`要素と`embed`要素

`object`要素の代わりに、あるいは`object`要素の子要素として`embed`要素が使われているコードを見ることがあるかもしれません。

`embed`要素は、`object`要素が登場する前から使われていた要素で、`object`要素と似た機能を持ちます。`object`要素の登場後も、互換性のために併用して使われることがありました。

仕様としては`embed`要素はW3C HTML 5.0で初めて標準化され、現在のHTML Standardでも定義されています。しかし実務上、この要素がFlashの埋め込み以外の用途に使われるケースは少なく、Flashのサポート終了に伴ってほとんど見かけなくなりました。今後、この要素を利用することはほぼないでしょう。

## メディア要素：`video`要素と`audio`要素

仕様では、`video`要素と`audio`要素をまとめてメディア要素と呼びます。前者は映像を表し、後者は音声を表します。要素の使い方はどちらもほぼ同様で、`src`属性でリソースを指定するか、あるいは`source`要素を用いて複数のリソース候補を指定できます。以下は`src`属性を使用した例です。

```html
<video controls src="https://archive.org/download/BigBuckBunny_124/Content/big_buck_bunny_720p_surround.mp4"
    poster="https://peach.blender.org/wp-content/uploads/title_anouncement.jpg?x11217"
    width="620">
  このブラウザーは埋め込み動画に対応していません。
  <a href="https://archive.org/details/BigBuckBunny_124">ダウンロード</a>してお好みの動画プレイヤーでご覧ください。
</video>
```

`source`要素を使用する場合は、`src`属性は使用しません。

```html
<audio>
  <!-- できればogg形式の音声を再生してほしい -->
  <source src="foo.ogg" type="audio/ogg; codecs=vorbis">
  <!-- oggに対応していなければmp3を再生させる -->
  <source src="foo.mp3" type="audio/mpeg">
</audio>
```

### 内容モデル

`video`要素および`audio`要素の内容モデルは、`source`要素（`src`属性がない場合に限る）、`track`要素（後述）、そしてTransparentです。Transparentの部分にはフォールバックコンテンツを入れることができます。

```html
<video controls src="https://archive.org/download/BigBuckBunny_124/Content/big_buck_bunny_720p_surround.mp4"
    poster="https://peach.blender.org/wp-content/uploads/title_anouncement.jpg?x11217"
    width="620">
このブラウザーは埋め込み動画に対応していません。
<a href="https://archive.org/details/BigBuckBunny_124">ダウンロード</a>してお好みの動画プレイヤーでご覧ください。
</video>
```

ただし、`video`要素および`audio`要素を子孫要素にできません。複数の映像や音声をフォールバックさせたい場合は、先に紹介したように`source`要素を使用してください。
<!-- /内容モデル -->

<!-- a11y note -->
### アクセシビリティ上の注意点

`video`要素および`audio`要素にデフォルトのARIAロールはありません。

支援技術でも`video`要素および`audio`要素の利用は可能ですが、ユーザーの視覚が利用できない場合、映像が再生されても、その情報を受け取ることはできません。同様に、聴覚に障害がある場合や、音声を再生できない環境では、音声の情報を利用できません。

この問題への対処の1つとして、テキスト情報を提示する方法があります。単にテキストを書き起こす方法もありますが、映像や音声は「時間依存メディア」(time-based media)ですので、場面が再生されるタイミングにあわせて字幕やキャプションなどのテキストトラックを表示することが望ましいでしょう。後述の`track`要素も参照してください。

## track要素

`track`要素は、時間指定のテキストトラックを指定するものです。テキストトラックのデータ形式にはさまざまなものがありますが、基本的にはテキストデータと、それを表示するタイミング（再生開始からの秒数）を指定します。たとえば、WebVTT (Web Video Text Tracks)では以下のようなフォーマットとなります。

<!-- コードグリッドからのほぼ複写 （CC-BY 3.0）https://app.codegrid.net/entry/2017-webvtt-1）-->
```WebVTT
WEBVTT

NOTE
これはコメントです。

my-cue-id-1
00:00.000 --> 00:05.000 line:90%
これは<b>WebVTT</b>による字幕です。
```

このようなテキストトラックデータを用意し、以下のように`track`要素の`src`属性で指定します。

```html
<video>
  <!-- 読み込む動画ファイルの指定 -->
  <source src="movie.mp4" type="video/mp4">
  <!-- 読み込む字幕ファイルの指定（日本語） -->
  <track label="日本語" kind="captions" srclang="ja" src="movie-ja.vtt" type="text/vtt" default>
  <!-- 読み込む字幕ファイルの指定（英語） -->
  <track label="English" kind="captions" srclang="en" src="movie-en.vtt" type="text/vtt">
</video>
```

これにより、音声や映像に字幕を付与でき、アクセシビリティを確保できます。

字幕の作成はなかなかに大変な作業ですが、近年では作成を支援するサービスも多数出てきています。たとえば、YouTubeには自動字幕生成の機能がありますし、生成された字幕をテキストトラックファイルに書き出すこともできます。字幕は、画像の代替テキストと同様の重要性を持つものですので、積極的に取り組んでいくとよいでしょう。

動画に関する一般的なアクセシビリティの対処方法については、W3C WAIのリソースMaking Audio and Video Media Accessible[^14]も参考になります。

[^14]: <https://www.w3.org/WAI/media/av/>
<!-- /a11y note -->

## `map`要素と`area`要素によるイメージマップ

イメージマップは、1つの画像上で、クリックする場所によって別々のリンクを割り当てることのできる機能です。`img`要素、`map`要素および`area`要素によって実現します。

### 内容モデル

`map`要素の内容モデルはTransparentです。通常は`area`要素を入れますが、他の要素を入れることもできます。以下は、`area`要素と、それに対応する`a`要素による通常のリンクを入れている例です。

```html
<map name="nav">
  <p>
    <a href="/clothes/">clothes</a>
    <area alt="clothes" coords="0,0,100,50" href="/clothes/"> |
    <a href="/toys/">toys</a>
    <area alt="toys" coords="100,0,200,50" href="/toys/"> |
    <a href="/food/">food</a>
    <area alt="food" coords="200,0,300,50" href="/food/"> |
    <a href="/books/">books</a>
    <area alt="books" coords="300,0,400,50" href="/books/">
  </p>
</map>
```

<!-- 互換性メモ -->
なお、古いHTML4では`a`要素に`shape`属性や`coords`属性を指定でき、上記の例は`area`要素なしの`a`要素のみで実現できることになっていました。しかし、現在のHTMLでは`a`要素の`shape`属性や`coords`属性は廃止されました。面倒でも`area`要素を利用してください。
<!-- /互換性メモ -->
<!-- /内容モデル -->

### 属性

典型的な`img`要素、`map`要素および`area`要素によって実現するイメージマップのコード例は次のようになります。

<!-- LSからのコピー（改）-->
```html
<p>
  形状を選んでください:
  <img src="shapes.png" usemap="#shapes"
       alt="くり抜かれた赤い正方形、緑の円、青い三角形、十字型の黄色の星の4つの形状があります。">
  <map name="shapes">
    <area shape=rect coords="50,50,100,100"> <!-- 赤い正方形の穴 -->
    <area shape=rect coords="25,25,125,125" href="red.html" alt="赤い正方形">
    <area shape=circle coords="200,75,50" href="green.html" alt="緑の円">
    <area shape=poly coords="325,25,262,125,388,125" href="blue.html" alt="青い三角形">
    <area shape=poly coords="450,25,435,60,400,75,435,90,450,125,465,90,500,75,465,60"
          href="yellow.html" alt="黄色の星">
  </map>
</p>
```

`img`要素の`usemap`属性と、`map`要素の`name`属性とでイメージマップを関連付けます。`name`属性はイメージマップの名前になります。`usemap`属性値はハッシュ名による`name`属性への参照です。

`area`要素が個々のリンクになります。`area`要素には`href`属性をはじめ、`a`要素と共通の属性を指定できます。Chapter3-5も参照してください。

`area`要素の`shape`属性は、イメージマップ内に作成する図形の種類を表し、`circle`、`poly`、`rect`、`default`の4つのキーワードから選択する列挙型属性です。

`coords`属性は、イメージマップ内に作成する図形の座標を表す、CSSピクセルで表されるリストです。指定する座標の数は、`shape`属性値によって変化します。

### アクセシビリティ上の注意点

`map`要素にデフォルトのARIAロールはありません。

視覚が利用できない状況では、多くの場合イメージマップが使いにくいことに注意してください。`area`要素には`alt`属性を指定できるため、適切なリンクテキストを指定しておきましょう。ナビゲーションなどの重要なリンクを提供する場合は、イメージマップだけでなく、通常の`a`要素によるリンクと併用するとよいでしょう。
<!-- /a11y note -->
