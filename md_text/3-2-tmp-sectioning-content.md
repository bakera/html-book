#### コラム：入れ子によるランクの表現

このコラムに記載されたコード例については推奨されるものではありません。後述するように、見出しのランクを使い分けることを勧めます。また、`hgroup`要素で複数の見出しを囲んで小見出しを表現するのと同じ問題があります。

セクショニングコンテンツを入れ子にして使えば、入れ子の深さでランクを表現できます。セクショニングコンテンツを入れ子にした場合、まず入れ子の深さでランクが判断され、見出し要素のランクよりも優先されます。

そうすると理論上、見出し要素の使い分けによるランクの表現は不要になります。先の例では`section`要素で階層構造を表現できているため、中の見出しを`h1`にできます。

```html
<h1>見出し1</h1>
<p>最初の本文です</p>
<section class="note">
  <h1>注意</h1>
  <p>注意書きです</p>
</section>
<p>本文の続きです</p>
```

同じ`h1`要素が出現していますが、片方は`section`要素の中にあるため、1つ下のランクであると判断できます。HTMLのアウトラインアルゴリズムの上では、このようにしても、`h2`を使った場合と同じアウトラインになります。

`section`要素を入れ子にしていくことで、`h3`や`h4`に相当する階層も表現できます。

```html
<h1>見出し1</h1>
<p>見出し1の本文</p>
<section>
  <h1>見出し2</h1>
  <p>見出し2の本文</p>
  <section>
    <h1>見出し3</h1>
    <p>見出し3の本文</p>
    <section>
      <h1>見出し4</h1>
      <p>見出し4の本文</p>
    </section>
  </section>
</section>
```

入れ子を深くすれば、さらに深い階層も表現できます。見出し要素のランクは`h6`までしか用意されていませんが、この方法ならば7階層以上の深いランクも表現できます。

このように表現すると、階層によって見出しのマークアップを変更する必要がないというメリットもあります。見出しを含むHTMLの部品をコンポーネントとして使い回す場合に、出現場所に応じて見出しのレベルを変更することなく、完全に同じHTMLのまま使い回すことができます。しかし、繰り返しになりますが、このアウトラインアルゴリズムは支援技術によってサポートされていません。面倒ではありますが、見出しのレベルを使い分けることを推奨します。

#### コラム：見出しランクとの併用

セクショニングコンテンツの入れ子と、見出しランクによる暗黙のセクションの併用もできます。以下のマークアップ例を考えてみましょう。

<!--とびとびのランクの例-->
```html
<body>
  <h4>哺乳類</h4>
  <p>乳で子を育てるのが特徴です。</p>
  <section>
    <h2>霊長類</h2>
    <p>ヒトを含むサルの仲間を指します。</p>
    <h6>ヒト</h6>
    <p>人間です。</p>
    <h1>クジラ目</h1>
    <p>クジラなどの海に住む哺乳類のグループです。</p>
  </section>
</body>
```

このマークアップでは見出し要素のランクがとびとびですし、暗黙のセクションも存在します。しかし、理論上は問題なく、以下のようなアウトラインになります。

```text
哺乳類
├ 霊長類
│ └ ヒト
└ クジラ
```

一方で、前述したように、アウトラインアルゴリズムはユーザーエージェントでサポートされません。そのため、セクションの入れ子の階層に応じたランクの見出し要素を使用することが推奨されます。さきほどの例は以下のようにマークアップするとよいでしょう。

<!--ランクに応じた見出しの例-->
```html
<body>
  <h1>哺乳類</h1>
  <p>乳で子を育てるのが特徴です。</p>
  <section>
    <h2>霊長類</h2>
    <p>ヒトを含むサルの仲間を指します。</p>
    <section>
      <h3>ヒト</h3>
      <p>人間です。</p>
    </section>
  </section>
  <section>
    <h2>クジラ目</h2>
    <p>クジラなどの海に住む哺乳類のグループです。</p>
 </section>
</body>
```

### タイトルのないセクション <!-- コラム？ -->

セクショニングコンテンツは、基本的に見出し要素と併用します。セクショニングコンテンツ内の最初の見出しがそのセクションのタイトルになります。

セクショニングコンテンツ内に見出しが複数ある場合、先に説明したように、2番目以降の見出しは暗黙のセクションを作ります。このため、1つのセクションに複数のタイトルが付くようなことはありません。

では、セクショニングコンテンツ内に見出しがまったくない場合はどうなるでしょうか。この場合、タイトルのないセクションができることになります。アウトラインを表示するツールによっては、"Untitled section"のような仮タイトルが与えられます。

タイトルのないセクションは禁止されてはいませんが、アウトラインの観点からは理解しにくくなり、好ましいとはいえません。そのため、HTMLチェックツールは警告を出すことがあります。たとえば、Nu HTML Checkerは以下のような警告メッセージを出します。

> Warning: Section lacks heading. Consider using h2-h6 elements to add identifying headings to all sections.

### セクショニングルート

見出しやセクショニングコンテンツが単純にアウトラインに組み込まれると困る場合もあります。その典型例は引用です。引用した文章に見出しやセクションが含まれる場合、その見出しが文書全体のアウトラインに影響すると混乱が生じてしまいます。

以下は`blockquote`要素を使用して文章を引用している例です。引用部分に見出しが含まれますが、これは単に引用元に見出しがあったに過ぎません。

<!-- 構造はMDNからお借りしており -->
```html
<section>
  <h1>初音ミク</h1>
  <section>
    <h2>はじめに</h2>
    <p>このセクションでは、黎明期の初音ミクについて説明します。</p>
  </section>
  <section>
    <h2>アイテム</h2>
    <p>初音ミクの定番アイテムといえばネギが有名ですが、ここでWikipediaの『初音ミク』の記述を見てみましょう。</p>
    <blockquote>
       <h1>初音ミクとネギ</h1>
       <p>これは派生キャラクターのはちゅねミクを生み出した動画...</p>
    </blockquote>
  </section>
</section>
```
<!-- ここまでMDNから構造をお借り -->

このようなケースでは、引用内部の見出しが文書アウトラインに出現すると混乱が生じます。かといって見出しを単に無視すると、引用部に複数の見出しが現れるようなケースで、引用部のアウトラインを理解できなくなってしまいます。

そこでHTML仕様では、`blockquote`要素の内側と外側が独立したアウトラインを持つようになっています。このように、その要素内に独自のアウトラインを持ち、内側のセクションと見出しが祖先のアウトラインに寄与しないものを「セクショニングルート」(sectioning root)と呼びます。

先ほどの例は、次のアウトラインを導き出します。

```text
初音ミク
├ はじめに
└ アイテム
```

引用を表す`blockquote`要素はセクショニングルートとされているため、内側の見出しは文書全体のアウトラインには現れていません。

セクショニングルートとなる要素は他にもあります。代表例の1つは`td`要素です。`td`要素は表のセルを表しますが、セル中に見出しが出現しても文書全体のアウトラインには影響しません。`table`要素をレイアウト目的に使っていると、意図したアウトラインにならないことがあるので注意が必要です。

他にセクショニングルートとなるのは、`body`要素、`details`要素、`dialog`要素、`fieldset`要素、`figure`要素です。

`body`要素もセクショニングルートであることに注意してください。たとえば以下のようにマークアップしたとします。

```html
<body>
<section>
 <h1>Apples</h1>
 <p>Pomaceous.</p>
</section>
</body>
```

この場合、`body`要素に対応する見出しがないため、タイトルのないセクションができることになります。アウトラインは以下のようになります。

```text
[body element with no heading]
└ Apples
```

なお、アウトラインアルゴリズムはユーザエージェントでサポートされていませんので、セクショニングルートについてもサポートされません。また、スクリーンリーダーもセクショニングルートについて特別な扱いをすることはありません。