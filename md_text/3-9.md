<!-- ch3-9.txt (4ページ、3000～4600字想定) -->
# フォーム

HTMLには「フォーム」を表示する機能があり、利用者はフォームにデータを入力し、それをウェブサーバーに情報を送信することができます。この節では、フォームとそれを構成する入力欄に関連する要素について説明します。


## フォーム概説

Webコンテンツの中には、利用者による入力を受け付けるものがあります。以下は、本書で何度か紹介しているHTML文法チェッカー "Nu Html Checker" の画面です。

![図: Nu Html Checkerのスクリーンショット]()

ここでは、利用者がチェック対象のURLを入力することができます。また、オプションとして何を表示するのか、チェックボックスで選択することができます。チェック方法を選択することもできます。こうして、一通りの入力と選択を終えた後、"check"ボタンを押すと文法チェックが行われます。

このように、テキストを入力したり、選択肢を選んだりしてから送信ボタンを押す、という一連の操作を提供するもの全体を「フォーム」(form)と呼びます。「入力フォーム」と呼ばれることもあります。フォームの中には、テキスト入力欄、ラジオボタン、ボタン、といったさまざまな部品が置かれ、利用者はこれらを操作することで、フォームに対して値を指定し、入力を行います。このような、利用者が値を入力・設定するための部品を「フォームコントロール」(form control) と呼びます。

## `form`要素

`form`要素は、サーバーに情報を送信する値を表すための、フォーム関連要素のコレクションを表します。典型的なHTMLフォームは、`action`属性によってフォームを送信するURLを、`method`属性でデータの送信方法を指定します。

```html
<form method="get" action="/search.cgi">
  <!-- 具体的なフォームの中身 -->
</form>
```

`method`属性は列挙属性です。上記の例で指定されるキーワード`get`は、HTTP GETメソッドを示します[^1]。これにより、指定したURLのリソースをサーバーから要求します。

キーワード`post`は、HTTP POSTメソッドを示します[^2]。これにより、URLへフォームを送信します。

キーワード`dialog`は、`dialog`要素と組み合わせて使用します。

[^1]: RFC 7231 4.3.1で定義されています。 https://tools.ietf.org/html/rfc7231#section-4.3.1

[^2]: RFC 7231 4.3.3で定義されています。 https://tools.ietf.org/html/rfc7231#section-4.3.3

## `label`要素

`label`要素は、ユーザーインターフェイスのキャプションを表します。この要素はラベル付け可能要素と呼ばれるフォーム関連要素に対して、ラベルのテキストを単に視覚的に関連付けるだけでなく、プログラム的にも関連付けるところがポイントです。

```html
<label>クエリー: <input name="q" type="text"></label>
```

このようにすれば、ラベル「クエリー:」をクリックすると、ほとんどのブラウザーで`input`要素にフォーカスが当たります。また、フォーカスが当たったときにスクリーンリーダーは明示的にラベルを読み上げ、どのようなデータを入力するのが適当か理解しやすくなるでしょう。

また、次の例のように`for`と`id`属性を用いて、ラベル付けすることもできます。ただし、ページ内で一意でなければならない`id`属性が増えることになりますから、特段の事情がなければ属性を用いてのマークアップしない方がシンプルでしょう。

```html
<label for="id">Query: </label><input name="q" id="q" type="text">
```

## `input`要素

`input`要素は、ユーザーがデータを編集できるようにするためのフォームコントロールを表します。`input`要素の動作は、`type`属性の値に応じて大きく異なります。以下で個別の値について見ていきます。この属性を指定しない、または属性値がブラウザーに解釈されない場合は`text`になります。

専用の値を適用することで、ブラウザーのインターフェイスやソフトウェアキーボードが変こするものもあります。

<!--`input`要素などの外観を制御するappearance プロパティは、2000年代から標準化が試みていますが、CSS UI 4での現在の規定は依然として混乱しています。-->

### `type=text`と`type=search`

どちらも、1行のプレーンテキスト編集コントロールを表します。

```html
<label>検索キーワード: <input name="q" type="search"></label>
```

`type=text`と`type=search`の大きな違いは、検索に適したインターフェイスを提供するかどうかです。`type=search`を解釈するブラウザーでは、入力ボックスの端に×印のアイコンを表示し、入力欄をクリアする機能を提供するものもあります。

### `type=tel`

`type=tel`をもつ`input`要素は、ユーザーに電話番号の入力や編集をさせるコントロールを表します。

`type=tel`の入力欄は標準の`type=text`の入力欄と一見同じですが、有用な機能を提供します。とくにスマートフォンに搭載されるモバイルブラウザーでは、電話番号の入力に最適化された専用のキーパッドを表示することがあります。

電話番号には様々なパターンがあります。日本に限ったとしても、国番号（日本の場合+81）から始まることがありえますし、固定電話の市外局番は2桁から5桁までの桁数がありえます。警察への緊急電話は110ですし、道路緊急ダイヤルは＃9910です。最後の2つをフォームに入力させることはまずないと思いますが、入力されうる値を確認した上で、値の検証を行う必要があります。

### `type=url`

`type=url`をもつ`input`要素は、ユーザーに絶対URLの入力や編集をさせるコントロールを表します。後述の`pattern`属性を使って、入力値の検証を行うこともできます。詳細については、`pattern`属性の節を参照してください。

### `type=email`

`type=email`をもつ`input`要素は、ユーザーにメールアドレスの入力や編集をさせるコントロールを表します。

### `type=password`

`type=password`をもつ`input`要素は、パスワードのようなセンシティブな値をユーザーに入力させるためのコントロールを表します。入力した値は通常、直接見えないようになります。

### 日付および時刻のコントロール

さまざまな日付と時刻を入力するためのコントロールがあります。

- `type=month` 年と月
- `type=week` 年と週番号
- `type=date` 年月日
- `type=time` 時刻
- `type=datetime-local` 日付と時刻

フォームの送信時には、HTML5の日付および時刻形式に従った値を返します。すなわち、日付を持つコントロールの場合、値はハイフン（`-`）で区切られます。時と分はコロン（`:`）で区切られます。日付と時間は`T`で区切られます。ただし、タイムゾーン情報は持ちません。

値の入力インターフェースは、ブラウザーによってさまざまです。多くのブラウザーでは、日付を入力するコントロールではカレンダーに似たインターフェイスで入力することができ、`type=text`よりも直感的に日付を選択することができます。

`min`属性と`max`属性で日付や時刻の範囲を指定することができます。また、`step`属性で値の間隔を指定することができます。たとえば、10時から20時までで、15分刻みのフォームにするには、次のようになります。

```
<input type=time min=10:00 max=20:00 step=900>
```

`min`は範囲の最小値、`max`は範囲の最大値を指定します。言い換えると、`max`値は`min`よりも常に大きいです。

時刻の場合、デフォルトのステップは60秒（1分）です。秒単位でステップを指定するため、この例の15分では値を900とします。

### `type=number`

`type=number`をもつ`input`要素は、ユーザーに数値を入力させるために使用します。

ここで言う数値は、HTML仕様で定義される妥当な浮動小数点数（valid floating-point number）です。つまり、小数を受け付けることに注意してください。

フィールドを初期値を10にした、1以上100以下の整数の範囲にしたい場合は、次のようになります。

```
<input type=number min=1 max=100 step=1 value=10>
```

このように`type=number`を用いても、ブラウザーによっては浮動小数点数で許容される以外の文字が入力できます。値は送信時に検証されますが、フォームで確実に数値を選択させたい場合は、`select`要素を使用することを検討したほうがよいでしょう。

### `type=range`

`type=range`をもつ`input`要素は、ユーザーに範囲内の数値を指定せるために使用します。多くの場合、スライダーコントロールでレンダリングされます。

スライダーでつまみを動かすというインターフェイスであるため、大まかな値を直感的に指定できる反面、正確な値を指定するにはあまり向いていないことに注意が必要です。

```
<p>
<label>範囲が0～100、ステップが0.2なスライダーに50ごとに目盛りをつける
<input id="range01" type="range" min="0" max="100" step="0.2" value="0" list="scale" />
</label>
<datalist id="scale">
<option>0</option>
<option>50</option>
<option>100</option>
</datalist>
```

`datalist`要素を使って、目盛りを与えることができます。

### `type=color`

値は6桁のRGB 16進記法で返されます（sRGB）。

これは、アルファチャンネルは指定できないことを意味します。また、たとえHSLのようなRGBとは異なる色指定方法で指定できるインターフェイスが備わっていたとしても、値はRGBで返されます。

### `type=checkbox`

`type=checkbox`をもつ`input`要素は、選択肢の中から複数選択が可能なチェックボックスを表します。

```html
所有している機器：
<label><input type=checkbox name=gadget value=desktop>デスクトップパソコン</label>
<label><input type=checkbox name=gadget value=laptop>ノートパソコン</label>
<label><input type=checkbox name=gadget value=smartphone>スマートフォン</label>
<label><input type=checkbox name=gadget value=tablet>タブレット</label>
```

チェックボックスはチェックされている状態と、チェックされていない状態を持ちます。これとは別に、チェックがされているともされていないとも言えない、未確定（indeterminate）状態があります。これは`HTMLInputElement`インターフェイスの`indeterminate`プロパティにより設定可能です。

この未確定状態でフォーム送信された場合、チェックされていない場合と同じ結果になります。

### `type=radio`

`type=checkbox`をもつ`input`要素は、選択肢の中から1つのみが選択可能なラジオボタンを表します。

```html
性別：
<label><input type=checkbox name=sex value=1>男性</label>
<label><input type=checkbox name=sex value=2>女性</label>
<label><input type=checkbox name=sex value=9>その他</label>
<label><input type=checkbox name=sex value=0 checked>回答しない</label>
```

`checked`属性を与えることで、規定のボタンを選択させることができます。

### `type=file`

`type=file`をもつ`input`要素は、選択された1つ以上のファイルのリストを表します。選択されると、ファイルはフォーム送信を利用してサーバーにアップロードしたり、File APIを使用して操作したりできます。
最低限の複数ファイルの送信フォームは次のようになります。

```html
<form enctype="multipart/form-data" method="post" action="hoge.cgi">
<label>アップロードするファイルを選択してください：
<input type="file" name="file" multiple>
</label>
<button>送信</button>
</form>　
```

`type=file`を持つフォームを設置する場合は、`form`要素の`enctype`を`multipart/form-data`とします。こうすることで、複数の種類のデータを一度に送信させることができます。

`multiple`属性を設定することで、複数のファイルを選択できるようになります。

### `type=submit`、`type=reset`、`type=button`

`type=submit`、`type=reset`、`type=button`をもつ`input`要素は、`button`要素でもマークアップすることができます。レガシーな環境のために、これらの`type`属性値をもつ`input`要素を使用しなければならない場合を除いて、`button`要素を選択した方がよいでしょう。機能については、`button`要素を参照してください。

### `type=image`

`type=image`をもつ`input`要素は、画像による送信ボタンを表します。この目的では、代わりに`button`要素を使用できます。

また、クリックした画像の座標を送信できます。サーバーサイドイメージマップと似た動作を実現することができますが、アクセシビリティ上の問題があります。この目的では、代わりにクライアントサイドイメージマップ（`area`要素）を使うのが望ましいです。

## 共通`input`要素属性

特定の`type`属性に対して、組み合わせて使用できる共通の属性について説明します。どの`type`に対して使用できるの正確な情報については、仕様を参照してください。

### `maxlength`および`minlength`属性

許容する長さを指定します。`maxlingth`属性は最大の長さを、`minlength`属性は最小の長さをそれぞれ指定します。

```html
<label>パスワード<input type=password minlength=8></label>
```

この例では、8文字以上のパスワードを受け付けるようになります。

### `size`属性

`size`属性は、`input`要素の文字数による幅を指定します。初期値は20です。ユーザーエージェントによって解釈が異なることが知られていますので、正確な大きさを指定するにはスタイルシートで指定した方がよいでしょう。

### `readonly`属性

`readonly`属性は、コントロールが編集可能かどうかを表す真偽属性です。指定される場合、読み取り専用コントロールとなります。

`disabled`と`readonly`との違いは、`readonly`はコントロールが機能するのに対し、`disabled`はコントロールが有効化されるまで機能しないという点にあります。

### `required`属性

`required`属性は、必須かどうかを表す真偽属性です。指定される場合、ユーザーはそのコントロールを必ず入力しなければなりません。

```html
<label>ユーザー名: <input name="username" required></label> 必須
```

このようにマークアップすれば、ユーザー名は必須項目になります。


### `multiple`属性

`multiple`属性は、ユーザーに複数の値を指定することを許可するかどうかを表す真偽属性です。

### `pattern`属性

`pattern`属性は、コントロールの値を検査する正規表現です。正規表現の文法は、JavaScript の正規表現アルゴリズムと同一です。この属性を指定する場合、`title`属性で、どのようなパターンなのかを説明すべきです。

例えば、`https://`で始まるURLのみをフォームで受け付けたい場合は、次のように書くことができるでしょう。

```html
<input type="url" pattern="^https://.+" title="httpsで始まるURLを入力してください。">
```

この例のように`title`属性も持たせることで、`pattern`にマッチしない値が入力されたときに、どのようなパターンを入力する必要があるのかのヒントを与えることができます。

### `min`および`max`属性

`min`および`max`属性はそれぞれ、最小と最大の値（数値または日時）を示します。

例えば日付コントロールで2019年1月3日から2019年5月3日までの範囲を指定する場合、次のようになります。

```html
<input type="date" min="2019-01-03" max="2019-05-03">
```

### `step`属性

`step`属性は、値の刻み幅を制御します。文字列`any`または正の浮動小数点数を指定できます。属性値に数値を指定した場合、コントロールはstep値の倍数のみを受け入れます。例については、日付および時刻のコントロールも参照ください。


### `list`属性

`list`属性は、ユーザーに提案する定義済み候補のリストを示します。値は、同一文書内の `datalist`要素のIDでなければなりません。詳細については、`datalist`要素を参照ください。


## `button`要素

`button`要素は、ボタンを表します。

`type`属性は、アクティブ時のボタンの振る舞いを制御します。この属性は列挙属性であり、次の表の値を取ります。

|`type`属性値  |機能の概要 |
|---|---|
|`submit`  |フォームを送信します。  |
|`reset` |フォームをリセットします。  |
|`button`| 何もしません。 |

`type`属性を省略した場合、`submit`が指定されたのと同じになります。

`input`要素でも`button`要素の機能を実現できますが、`input`要素は`value`属性に文字列しか設定できないのに対し、`button`要素はコンテンツとして表すことができます。言い換えると、`button`要素の内側で要素（フレージングコンテンツ）を置くこともできることになります。

```html
<!-- inputとbutton要素の比較 -->
<input type="submit" value="送信">
<button type="submit">送信</button>
```

## `select`要素

`select`要素は、オプションから選択するためのコントロールを表します。子要素として、`option`要素で選択肢を記述します。

```html MDN(改)
<label>ペットを選びます:
<select>
    <option value="">--ペットの選択肢--</option>
    <option value="dog">いぬ</option>
    <option value="cat">ねこ</option>
    <option value="parakeet">インコ</option>
</select>
</label>
```

`optgroup`要素を使用することで、選択肢をグループ化できます。`label`属性は、オプションのグループの名前です。これは必須の属性です。

```html MDN→上と対応
<select>
  <optgroup label="ほ乳類">
    <option>いぬ</option>
    <option>ねこ</option>
  </optgroup> 
  <optgroup label="鳥類">
    <option>インコ</option>
  </optgroup>
</select>
```

`value`属性はサーバーに送信される値です。この属性を省いた場合、要素の内容が送信されます。


## `datalist`要素

`datalist`要素は、他のコントロール用のオプションを表す`option`要素の集合を表します。

```html MDN
<label for="ice-cream-choice">アイスクリームのフレーバー:</label>
<input list="ice-cream-flavors" id="ice-cream-choice" name="ice-cream-choice">

<datalist id="ice-cream-flavors">
    <option value="Chocolate">
    <option value="Coconut">
    <option value="Mint">
    <option value="Strawberry">
    <option value="Vanilla">
</datalist>
```


## `textarea`要素

`textarea`要素は、複数行のプレーンテキスト編集コントロールを表します。コメント欄やお問い合わせフォームのように、ユーザーが大量の自由記述なテキストを入力できるようにするときに便利です。

```html
<label for="advanced">高度な例:
  <textarea id="advanced" name="advanced"
            rows="3" cols="33" maxlength="200">
rows属性とcols属性でサイズが指定されたtextarea要素。最大文字数は、maxlengthによって200に制限されています。
  </textarea>
</label>
```

`row`属性で行を、`cols`属性で幅を指定することができます。

`maxlength` 属性は、ユーザーが入力可能な文字 (Unicode コードポイント) の最大文字数です。<!--maxlengthについてもっと調べておく-->


## `output`要素

`output`要素は、アプリケーションによって実行された計算の結果やユーザー操作の結果を表します。

次のように、簡単な電卓の出力部分に`output`要素を使用できます。

```html
<form onsubmit="return false" oninput="o.value = a.valueAsNumber + b.valueAsNumber">
 <input id=a type=number step=any> +
 <input id=b type=number step=any> =
 <output id=o for="a b"></output>
</form>
```


## `progress`要素

`progress`要素は、タスクの進捗状況を表します。これは通常、プログレスバーとしてレンダリングされます。

```html
<progress id=p max="100" value="50"><span>50</span>%</progress>
<script>
  var progressBar = document.getElementById('p');
  function updateProgress(newValue) {
    progressBar.value = newValue;
    progressBar.getElementsByTagName('span')[0].textContent = newValue;
  }
 </script>
```

このように`updateProgress()`メソッドを外部から呼び出すことで、`progress`要素の値を更新することができます。


## `meter`要素

`meter`要素は既知の範囲のスカラー量、または小数の値を表します。たとえば、ディスク使用量、投票人口の割合などです。
<!-- std -->

次の例は、すべて3/4で満たされる3つのゲージを示します。

```html
ストレージ容量の使用状況: <meter value=6 max=8>6ブロック使用済み (合計8個中)</meter>
投票率: <meter value=0.75><img alt="75%" src="graph75.png"></meter>
チケット販売数: <meter min="0" max="100" value="75"></meter>
```
<!-- https://www.tagindex.com/html5/form/meter.html ここに色の挙動が書かれているのでこれをごにょごにょ  -->


## `fieldset`要素

`fieldset`要素は、関連するコントロールのセットをグループ化するために使用されます。

```html
<fieldset>
 <legend>ディスプレイ表示</legend>
 <p><label><input type=radio name=c value=0 checked>黒地に白字</label>
 <p><label><input type=radio name=c value=1>白地に黒字</label>
 <p><label><input type=checkbox name=g>グレースケールを使用する</label>
 <p><label>コントラストを強調する <input type=range name=e list=contrast min=0 max=100 value=0 step=1></label>
 <datalist id=contrast>
  <option label=Normal value=0>
  <option label=Maximum value=100>
 </datalist>
</fieldset>
```

## `legend`要素

`legend`要素は、`fieldset`要素のキャプションを表します。


## フォームコントロールの共通属性
### 名前フォームコントロール：`name`属性
<!--もうちょっと説明を深化したほうがよさげ-->
フォームコントロールで用いる`name`属性は、フォームコントロールの名前を与えます。`a`要素に付与する`name`属性（`id`属性のように使用されていました）とは役割が異なることに注意してください（これは廃止されました）。

処理系によっては、`name`属性の後に`[]`を付与することによって、配列のようにデータを扱うことができます。

```html
<input type=checkbox name="animal[]" value="cat"> ねこ
<input type=checkbox name="animal[]" value="dog"> いぬ
```

### 入力長さの制限：`maxlength`属性と`minlength`属性

`maxlength`属性は入力できる最大の文字数を、`minlength`属性は入力に必要な最小の文字数をそれぞれ指定します。両方が指定される場合、`minlength`属性の値は`maxlength`属性の値以下でなければなりません。

文字数は、Infra標準で説明される、JavaScript長さで数えられます<!--U+xxxxとかで説明した方がよいのか？-->。`textarea`要素にこれらの属性が指定される場合、改行は、1文字として数えられます。

### フォームコントロールの有効化および無効化：`disabled`属性
<!--もうちょっと説明が必要？-->
`disabled`属性が設定される場合、そのフォームコントロールは無効にされます。無効な要素は、アクティブにできませんし、フォーカスを当てることもできません。

### フォームコントロールを自動フォーカスする：`autofocus`属性

`autofocus`属性は、ページ読み込み時にフォーカスを持つことを指定するものです。1つのフォーム要素に複数設定してはなりません。

自動的にフォーカスを奪うため、利用者の混乱をかえって招く可能性があることに注意すべきでしょう。

### オートフィルフォームコントロール：`autocomplete`属性

`autocomplete`属性は、フォームコントロールがどのような目的で提供されるかを示唆すると同時に、ユーザーエージェントへのヒントの手段に使用できるものです。

例えば、氏名や住所、URLやメールアドレス、性別やクレジットカードの番号などと言った意味をフォームコントロールに付与することができます。完全な属性の値と組み合わせについては、仕様を参照してください。

たとえば、フォームで2つの配送先住所がある場合、次のようにマークアップできます。

<!--何かわかりやすい例を作成 以下はHTMLStdからの複写-->
```html
<fieldset>
 <legend>1つ目のギフトの配送先</legend>
 <p> <label>郵便番号: <input name=bp autocomplete="section-blue shipping postal-code"> </label>
 <p> <label>都道府県: <input name=bc autocomplete="section-blue shipping address-level1"> </label>
 <p> <label>住所:     <textarea name=ba autocomplete="section-blue shipping street-address"></textarea> </label>


</fieldset>
<fieldset>
 <legend>2つ目のギフトの配送先</legend>
 <p> <label>郵便番号: <input name=rp autocomplete="section-red shipping postal-code"> </label>
 <p> <label>都道府県: <input name=rc autocomplete="section-red shipping address-level1"> </label>
 <p> <label>住所:     <textarea name=ra autocomplete="section-red shipping street-address"></textarea> </label>
</fieldset>
```
