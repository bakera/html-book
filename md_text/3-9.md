<!-- ch3-9.txt (4ページ、3000～4600字想定) -->
# フォーム

ブラウザーには、ユーザーが入力したデータをウェブサーバーに送信する機能があり、HTMLには、その入力と送信のための要素が用意されています。このChapterでは、入力フォームの基礎となる`form`要素と`input`要素について説明します。

## フォーム概説

ウェブコンテンツの中には、利用者による入力を受け付けるものがあります。以下は、本書で何度か紹介しているHTMLチェッカー"Nu Html Checker"の画面です。

![図: Nu Html Checkerのスクリーンショット](../img/3-9-00.png)
<!-- 横着して00にしてますが、後で変える -->

ここでは、ユーザーがチェック対象のURLを入力できます。また、オプションとして何を表示するのかを、チェックボックスで選択できます。さらに、チェック方法も選択できます。こうして、一通りの入力と選択を終えたあと、"check"ボタンを押すとチェックが行われます。

このように、テキストを入力したり、選択肢を選んだりしてから送信ボタンを押す、という一連の操作を提供するもの全体を「フォーム」(form)と呼びます。フォームは「入力フォーム」と呼ばれることもあります。

フォームの中には、テキスト入力欄やラジオボタンといったさまざまな部品が置かれます。ユーザーはこれらを操作し、値を入力したり、設定したりします。このような、ユーザーが値を入力・設定するための部品を「フォームコントロール」(form control) と呼びます。

ほとんどのフォームでは、ユーザーが入力・設定した値を、最終的にサーバーに向けて「送信」(submit)します。この送信を行うボタンを「送信ボタン」(submit button)と呼びます。多くのフォームでは、ユーザーが送信ボタンを押すまで情報がサーバーに送信されることはありません。送信ボタンを押す前であれば、ユーザーは自由に入力内容を修正できます。

HTMLには、フォームやフォームコントロール表現する要素が多数用意されており、これらを利用することで、基本的なフォームを表現できます。

## `form`要素

`form`要素は、フォーム全体を表します。以下は簡単な検索フォームの例です。

```html
<form method="get" action="/search.cgi">
  <input type="text" name="k">
  <button>検索</button>>
</form>
```

### 内容モデル

`form`要素の内容モデルはFlowです。フォームコントロール以外にも、見出し、説明文、テーブルなど、さまざまな要素を入れることができます。

ただし、子孫要素に`form`要素を入れ子にはできません。フォーム内に複数のボタンがあり、ボタンによってフォームの送信先を変えたいような場合、`form`要素を入れ子にするのではなく、ボタンに`formaction`属性を指定することで実現します。
<!-- /内容モデル -->

### 属性
<!--
accept-charset — 説明あり
action — 説明あり
autocomplete — 共通のところに追記
enctype — 説明あり
method — 説明あり
name — 共通のところを参照?
novalidate — 説明を追加
target — 説明あり
rel - 説明あり
-->
`form`要素にはフォーム送信の制御に関する属性がいくつかあります。また、下記の他に`autocomplete`属性を指定できます。`autocomplete`属性については、後述のフォームコントロールの共通属性を参照してください。

#### `method`属性

`method`属性でフォーム送信時の送信方法を指定します。`method`属性は列挙型属性で、`get`、`post`、`dialog`のいずれかを指定します。

##### `get`

`get`を指定すると、入力内容はHTTPのGETメソッドで送信されます。フォームに入力されたデータは、URLのクエリーに付与されます。HTTPのメソッドについてはChapter1-6を、URLのクエリーについてはChapter1-5を参照してください。

URLのクエリーに付与される値は、`application/x-www-form-urlencoded`のアルゴリズムでシリアライズされます。詳細は後述の`enctype`属性の項で説明します。

たとえば、先に挙げた簡単な検索フォームの例に「テスト」と入力した場合、次のようなURLにアクセスします。

```text
/search.cgi?k=%E3%83%86%E3%82%B9%E3%83%88
```

`method`属性を省略した際のデフォルト値は`get`です。`method`属性を省略しても、フォーム送信は行われることに注意してください。フォームの入力内容をサーバーに送信する必要がない場合、JavaScriptでフォームの送信を明示的に抑制しないと、意図しないデータ送信が行われることがあります。

##### `post`

`post`を指定すると、入力内容がHTTP POSTメソッドで送信されます。この場合、入力された値はHTTPリクエストのリクエストボディに含まれます。HTTPのメソッドについてはChapter1-6を参照してください。リクエストボディのデータ形式については、後述の`enctype`属性を参照してください。

##### `dialog`

`dialog`を指定した場合、入力内容はサーバーに対して送信されません。これは`dialog`要素と組み合わせて使用するもので、入力内容は主にJavaScriptで取得します。

`method="dialog"`のフォームを送信すると、対応するダイアログが閉じられると同時に、フォーム入力の内容を`dialog`要素の`returnValue`プロパティから読み取れるようになります。以下は、ダイアログを閉じた際に押されたボタンを表示する例です。

```html
<dialog id="confirm_dialog">
  <form method="dialog">
    <p>OKですか?</p>
    <button type="submit" value="OK">OK</button>
    <button type="submit" value="Cancel">Cancel</button>
  </form>
</dialog>
<script>
const dialog = document.getElementById('confirm_dialog');
dialog.showModal();
dialog.onclose = () => {
  alert(dialog.returnValue);
};
</script>
```

#### `action`属性

`action`属性で、フォーム送信時の送信先となるURLを指定します。

`action`属性を指定していない場合は、フォームが置いてあるページ自身が送信先となります。`action`属性に空の値を指定する (`action=""`) ことはできず、構文エラーとなりますが、この場合もエラー処理の結果としてフォームが置いてあるページ自身が送信先となります。
<!--
4.10.21.3 Form submission algorithm
>If action is the empty string, let action be the URL of the form document.
-->

#### `enctype`属性

`enctype`属性を指定すると、`method="post"`でフォーム送信するときのリクエストボディの形式を指定できます。`enctype`属性は列挙型属性で、以下のいずれかを指定します。

- `application/x-www-form-urlencoded`
- `multipart/form-data`
- `text/plain`

省略時のデフォルト値は`application/x-www-form-urlencoded`です。

通常は`application/x-www-form-urlencoded`を利用し、ファイル送信が必要な場合には`multipart/form-data`を利用します。`text/plain`を利用することはほとんどありません。

##### `application/x-www-form-urlencoded`

`application/x-www-form-urlencoded`は、フォームコントロールの名前と値のペアをURLエンコードして連結したもので、フォーム送信では最もよく利用される形式です。URL Standardで定義されています[^2]。

[^2]: <https://url.spec.whatwg.org/#application/x-www-form-urlencoded>

たとえば、冒頭の簡単な検索フォームの例において、「k」という名前の入力欄に「テスト」と入力した場合は以下のような形式になります。

```text
k=%E3%83%86%E3%82%B9%E3%83%88
```

名前と値のペアが複数ある場合は`&`で連結します。

```text
name1=value1&name2=value2&
```

##### `multipart/form-data`

`multipart/form-data`は、入力項目それぞれをバウンダリー（区切り文字）で区切った形式であり、主にフォームからファイルを送信する際に利用します。仕様はRFC 7578[^4]で定義されています。たとえば以下のような形式になります。

[^4]: RFC7538 <https://datatracker.ietf.org/doc/html/rfc7578>

```text
------WebKitFormBoundarygOTbtF2D0Y0ZT1Ak
Content-Disposition: form-data; name="name1"

value1
------WebKitFormBoundarygOTbtF2D0Y0ZT1Ak
Content-Disposition: form-data; name="name2"

value2
------WebKitFormBoundarygOTbtF2D0Y0ZT1Ak--
```

##### `text/plain`

`text/plain`は、単純に`名前=値`のペアを改行（CR+LF）で区切った形式です。たとえば以下のようになります。

```text
name1=value1
name2=value2
```

簡素で人間には読みやすい形式ですが、現在ではほとんど使われていません。

#### `target`属性、`rel`属性

`form`要素にも`target`属性と`rel`属性を指定できます。これらは`a`要素の同名の属性と同じものです。Chapter3-5を参照してください。

`rel`属性には基本的に`a`要素と同じリンクタイプを指定できますが、`form`要素の場合にはリンクタイプ`alternate`、`author`、`bookmark`、`tag`を利用できません。

#### `novalidate`属性

`novalidate`属性を指定すると、フォーム送信時の入力値の検証が無効になります。`novalidate`属性はブール型属性です。

特定の形式の値のみを許すフォームコントロール (`type=email`など) や、`required`属性、`pattern`属性などで値が制限されている場合、「クライアント側フォーム検証」(Client-side form validation)[^99]が行われ、条件を満たしていないとエラーとなります。

[^99]: https://html.spec.whatwg.org/multipage/forms.html#client-side-form-validation

`novalidate`属性を指定すると、この検証を無効にし、無条件でフォーム送信ができるようになります。

#### `name`属性

`form`要素に`name`属性を指定すると、フォームに名前をつけられます。この名前は、JavaScriptから参照する際に利用できます。フォームコントロールの`name`属性と異なり、フォーム送信時にこの名前がデータとして送信されることはありません。

#### `accept-charset`属性

古いHTML4では、`accept-charset`属性を指定してフォーム送信時の文字エンコーディングの候補を指定できました。

この属性は現在のHTMLでも定義されていますが、現在のHTML仕様では、UTF-8以外は指定できません。属性の省略時もUTF-8を指定したことになります。現在ではこの属性を利用する意義はありません。

### アクセシビリティ上の注意点

`form`要素のデフォルトのARIAロールはありません。ただし、フォームにアクセシブルな名前が付けられていれば`form`ロールとなります。

フォームが検索フォームである場合、`search`ロールを指定することで、検索フォームであることを明示できます。

なお、`form`ロールや`search`ロールはランドマークロールでもあります。多くのスクリーンリーダーは前後のランドマークに飛んだり、ランドマーク領域全体を読み飛ばしたりする機能を持ちますが、ランドマークでないフォームに飛ぶ機能も持っています。無理に`role="form"`を与える必要はないでしょう。
<!-- /a11y note -->

## `label`要素

`label`要素は、ユーザーインターフェイスのキャプションを表す要素で、フォームコントロールにラベルを付けることができます。

単にフォームコントロールの横にテキストを置いた場合、人間にはラベルのように見えても、ブラウザーにはラベルであることは伝わりません。`label`要素を利用すると、ラベルとフォームコントロールとを明確に関連付けることができ、プログラムによる解釈を可能にします。

ほとんどのブラウザーでは、`label`要素のラベルをクリックすると、対応するフォームコントロールにフォーカスが当たります。また、対応するフォームコントロールにフォーカスが当たった際、スクリーンリーダーは対応する`label`要素を読み上げます。

`label`要素でラベルを付けられる要素を「ラベル付け可能要素」(labelable element)と呼びます。具体的には、以下の要素が該当します。

- `button`要素
- `input`要素（ただし、`type="hidden"`のものを除く）
- `meter`要素
- `output`要素
- `progress`要素
- `select`要素
- `textarea`要素

このほか、カスタム要素で`form-associated`が`true`に設定されているものもラベル付け可能要素となります。

`label`要素とラベル付け可能要素を結び付ける方法は2種類あります。詳細は、後述の内容モデルと`for`属性でそれぞれ説明します。

### 内容モデル

`label`要素の内容モデルはPhrasingです。ただし、`label`要素を子孫に含むことはできません。また、この`label`要素によってラベル付けされた以外のラベル付け可能要素を子孫に含むこともできません。

内容モデルがFlowではないことに注意してください。`label`要素に`h1`などの見出しや、`p`要素などを入れることはできません。

内容にラベル付け可能要素が含まれている場合、`label`要素はその要素に結び付けられます。

```html
<label>クエリー: <input name="q" type="text"></label>
```

この例では、入力欄に「クエリー:」というラベルが結び付けられます。

1つの`label`要素を複数のラベル付け可能要素に関連付けることはできません。`label`要素の子孫にラベル付け可能要素が複数出現した場合はエラーとなり、エラー処理の結果として、最初に出現したラベル付け可能要素だけに結び付けられます。
<!-- /内容モデル -->

### 属性

`label`要素には`for`属性があり、フォームコントロールとの結び付けに使用します。

#### `for`属性

ラベル付け可能要素に`id`属性でIDを指定してある場合、`label`要素の`for`属性にそのIDを指定することで、ラベルを結び付けることができます。

```html
<label for="q">クエリー: </label>
<input name="q" id="q" type="text">
```

なお、`label`要素の中に入れる方法と併用しても問題ありません。

```html
<label for="q">クエリー: <input name="q" id="q" type="text"></label>
```

ただしこの場合、両方が同じ要素を指すようにしなければなりません。以下は誤った例です。

```html
<!-- 文法エラーとなる例 -->
<label for="text2">Query: <input id="text1"></label>
<input id="text2">
```

これはエラーになりますが、エラー処理の結果として`for`属性による指定が優先され、`<input id="text1">`はラベルを持たない状態になります。`for`属性による指定と子孫要素による指定を混在させると混乱のもとになるため、どちらかに統一するとよいでしょう。

`for`属性を利用すると、ラベル付け可能要素を`label`要素の中に入れる必要はないため、配置の自由度が増します。ただし、`id`属性はページ内で一意でなければならないため、ラベル付け可能要素が複数ある場合、`id`属性はそれぞれ異なる値にする必要があります。フォームコントロールが増減するような場合は扱いに注意が必要です。

`for`属性を利用すると、1つのラベル付け可能要素に複数の`label`要素を関連付けることも可能です。以下は正しい例です。

```html
<label>ラベル1<input id="text1"></label>
<label for="text1">ラベル2</label>
<label for="text1">ラベル3</label>
```

この場合、`<input id="text1">`に対して3つのラベルが結び付けられ、ラベル1、ラベル2、ラベル3の順に読み上げることが期待されます。

### アクセシビリティ上の注意点

`label`要素にデフォルトのARIAロールはありません。

`label`要素をラベル付け可能要素に結び付けると、そのラベル付け可能要素のラベルとして扱われます。スクリーンリーダーでフォームを操作する際、ラベルが適切に設定されていないと入力欄が何であるのかわからないことがあるため、適切なラベルを必ず設定しましょう。また、ラベルをクリックすることで対応するフォームコントロールにフォーカスを移せるため、細かなマウス操作が難しいユーザーにも役立ちます。

`label`要素を利用する際は、ラベル付け可能要素との結び付けができているか確認するとよいでしょう。`label`要素の子孫要素にラベル付け可能要素がなく、`for`属性もない場合は、ラベル付け可能要素と結び付いていない状態になります。

```html
<!-- label要素が結び付けられていない -->
<label>名前</label>
<input name="name" type="text">
```

この場合、ラベルとしては機能しませんが、語彙的ルールの観点では問題ないため、HTMLチェッカーで警告されないことがあります。

また、`for`属性の誤りで結び付けに失敗している例もよく見られます。

```html
<!-- for属性に指定したidが間違っている -->
<label for="name">メールアドレス</label>
<input name="email" id="email" type="email">
```

存在しない`id`属性を参照している場合はエラーになりますが、誤って別の要素の`id`属性を指定した場合はエラーにならないので注意が必要です。以下は、2番目の`label`要素の`for`属性が意図しない値になっている例です。

```html
<!-- このlabel要素は問題ない -->
<label for="name">名前</label>
<input name="name" id="name" type="text">

<!-- 上のlabelをコピーし、for属性を直し忘れた -->
<label for="name">メールアドレス</label>
<input name="email" id="email" type="email">
```

この例の場合、2つのラベルが両方とも最初の入力欄に結び付きます。構文上は正しいため、HTMLチェッカーでは誤りを検出できないことに注意してください。
<!-- /a11y note -->

## `input`要素

`input`要素は、データを入力や編集をするフォームコントロールを表します。`input`要素が何を表し、どのように動作するかは、`type`属性の値によって大きく変わります。

### 1行テキスト入力: `text`と`search`

`type=text`と`type=search`は、1行のプレーンテキスト編集コントロールを表します。

```html
<label>検索キーワード: <input name="q" type="search"></label>
```

これは1行の入力欄であるため、改行を入力できません。`value`属性で初期値を指定できますが、`value`属性の値に改行が含まれている場合はエラーとなり、結果として改行文字は取り除かれます。

`type=text`と`type=search`の違いは、検索に適したインターフェイスを提供するかどうかです。`type=search`を解釈するブラウザーは、入力ボックスの端に×印のアイコンを表示し、入力欄をクリアする機能を提供することがあります。また、ソフトウェアキーボード上の入力完了ボタンのラベルが「検索」に変化することもあります。

![スクリーンショット: iOSのSafariでtype=searchの入力欄に入力している様子。右下のボタンのラベルが「検索」となっている](../img/3-9-01.png)

#### アクセシビリティ上の注意点

`type=text`の場合、デフォルトのARIAロールは`textbox`です。スクリーンリーダーは「エディット」「テキストを編集」などと読み上げたあと、現在入力されている値を読み上げます。空欄になっている場合は、「ブランク」と読み上げたり`placeholder`属性の値を読み上げることがあります。

`type=search`の場合、デフォルトのARIAロールは`searchbox`です。基本の挙動は変わりませんが、スクリーンリーダーは「検索テキスト欄」などと読み上げる場合があります。

なお、有効な`list`属性が指定されている場合には、デフォルトのARIAロールは`combobox`となります。後述の`list`属性を参照してください。

### 電話番号の入力: `tel`

`type=tel`は、電話番号の入力や編集をするコントロールを表します。改行が入力できない点も含め、`type=text`の入力欄と機能的にはほとんど同じですが、電話番号の入力に適した機能を提供します。スマートフォンに搭載されるモバイルブラウザーでは、電話番号の入力に最適化された専用のキーパッドを提供することがあります。

後述の`type=url`や`type=email`と異なり、デフォルトでは入力値の検証が行われません。電話番号にはさまざまなパターンがあり、`-`、`*`、`#`が入力されるケース、国番号（日本の場合+81）を表す`+`が入力されるケースがあるほか、海外では電話番号にアルファベットを含むこともあります。こういった事情から、`type=tel`は改行以外のあらゆる文字を受け入れます。厳密な入力値検証が必要な場合は、後述の`pattern`属性と併用するとよいでしょう。

#### アクセシビリティ上の注意点

`type=tel`の場合、デフォルトのARIAロールは`textbox`です。有効な`list`属性が指定されている場合には、デフォルトのARIAロールは`combobox`となります。後述の`list`属性を参照してください。

スクリーンリーダーは`type=text`の入力欄と同様に読み上げ、電話番号の入力欄であることは伝えない場合があります。電話番号の入力欄であることがわかるようなラベルを関連付けておくとよいでしょう。

### URLの入力: `url`

`type=url`は、絶対URLの入力や編集をするコントロールを表します。URLについてはChapter1-5を参照してください。

改行が入力できない点も含め、`type=text`の入力欄と機能的にはほとんど同じですが、URLの入力に適した機能を提供します。ブラウザーはURLの入力補助のために補完候補を出したり、URLの入力に最適化された専用のキーパッドを表示するかもしれません。

`type=url`の入力欄では、フォーム送信時に入力値の検証が行われます。空でない値が入力されている場合には、絶対URLの形式になっている必要があります。そうでない場合、フォーム送信をしようとするとエラーメッセージが表示され、送信できません。ただし、値の前後には空白が許されており、空白が入っていた場合は自動的に取り除かれます。

![スクリーンショット: type=urlの入力欄に不適切な値を入力して送信を試みている様子。エラーメッセージが表示されている。](../img/3-9-02.png)

`value`属性で初期値を指定できますが、この場合も絶対URLの形式になっている必要があります。

URLのスキームがHTTPやHTTPSに限られないことに注意してください。スキームが適切であるかどうかも問わないため、未知のスキームも受け付けてしまいます。たとえば、"a:"という値は適切な絶対URLとみなされます。`:`（コロン）を含む文字列はほとんどすべて許可してしまうため、厳密な入力値の検証が必要な場合は、後述の`pattern`属性を併用するとよいでしょう。

#### アクセシビリティ上の注意点

`type=url`の場合、デフォルトのARIAロールは`textbox`です。有効な`list`属性が指定されている場合には、デフォルトのARIAロールは`combobox`となります。後述の`list`属性を参照してください。

スクリーンリーダーは`type=text`の入力欄と同様に読み上げ、URLの入力欄であることは伝えない場合があります。URLの入力欄であることがわかるようなラベルを関連付けておくとよいでしょう。

### 電子メールアドレスの入力: `email`

`type=email`は、電子メールアドレスの入力や編集をするコントロールを表します。

`type=email`の入力欄では、フォーム送信時に入力値の検証が行われます。空でない値が入力されている場合には、適切な電子メールアドレスの形式になっている必要があります。そうでない場合、フォーム送信をしようとするとエラーメッセージが表示され、送信できません。ただし、値の前後には空白が許されており、空白が入っていた場合は自動的に取り除かれます。

なお、この検証で許される電子メールアドレスの形式は、電子メールに関するルールを定めるRFC 5322の仕様とは異なります。これは「意図的な逸脱」(willful violation)です。たとえば、RFC 5322では電子メールアドレス内のコメントが許可されていますが、現実のメールアドレスでコメントを含むことはないに等しいといえます。そのため、`type=email`の検証ではコメントを含むメールアドレスはエラーとなります。検証ルールの詳細は、仕様の"valid email address"[^5]を参照してください。

[^5]: <https://html.spec.whatwg.org/multipage/input.html#valid-e-mail-address>

また、`type=url`の場合と同様、後述の`pattern`属性との併用も可能です。

`type=email`の入力欄には、`multiple`属性を指定できます。`multiple`属性はブール型属性です。`multiple`属性が指定されていると、複数のメールアドレスをカンマ区切りで列挙して入力できるようになります。

#### アクセシビリティ上の注意点

`type=email`の場合、デフォルトのARIAロールは`textbox`です。有効な`list`属性が指定されている場合には、デフォルトのARIAロールは`combobox`となります。後述の`list`属性を参照してください。

スクリーンリーダーは`type=text`の入力欄と同様に読み上げ、電子メールアドレスの入力欄であることは伝えない場合があります。電子メールアドレスの入力欄であることがわかるようなラベルを関連付けておくとよいでしょう。

### センシティブな値の入力`password`

`type=password`は、パスワードのようなセンシティブな値を入力するコントロールを表します。`type=text`と異なるのは、入力した値が伏せられ、ユーザーから直接見えなくなることが期待されるという点です。これは、人がパスワードなどを盗み見する「ショルダーハック」を防ぐためとされています。

ただし、モバイルデバイスなどでは、入力中の1文字が見るようになっていることがあります。また、ブラウザーによっては、ユーザーの操作で値を表示できる機能を持つ場合もあります。

`type=password`の入力欄では、`autocomplete`属性の挙動が他の入力欄と異なる場合があります。詳しくは`autocomplete`属性を参照してください。

#### アクセシビリティ上の注意点

`type=password`の場合、デフォルトのARIAロールはありません。スクリーンリーダーは「パスワード」「保護されたテキスト」などと読み上げる場合があります。

入力された値を読み上げるかどうかはスクリーンリーダーの設定に依存します。入力値は視覚的には伏せられますが、スクリーンリーダーの場合、設定によっては読み上げられることもあるので注意が必要です。

### 日付および時刻のコントロール: `month`、`week`、`date`、`time`、`datetime-local`

`type`属性に以下の値を指定することで、日付や時刻を入力するコントロールを表現できます。

- `type=month`：年と月
- `type=week`：年と週番号
- `type=date`：年月日
- `type=time`：時刻
- `type=datetime-local`：日付と時刻

これらの値を入力するインターフェイスは、ブラウザーによってさまざまです。多くのブラウザーでは、日付を入力する場合にはカレンダーが表示され、日付を選択するだけで入力できます。

![スクリーンショット: type=datetime-localで日付と時刻を入力する際のインターフェイスの例](../img/3-9-03.png)

多くのブラウザーでは、カレンダーが表示されるときに現在の日付が選択された状態となります。たとえば、ユーザーの生年月日を入力させる場合に`type=date`コントロールを使用すると、生年月日によっては遡るのに大変な労力がかかります。

なお、ほとんどのブラウザーにはカレンダーの年を選択する機能がありますが、残念ながらわかりやすいとはいえません。後述する`min`属性と`max`属性で日付の範囲を制限すると、使いやすくなる場合があります。

`step`属性で値の間隔を指定できます。以下の例では、10時から20時までの時刻を、15分刻みの単位で指定できます。

```html
<input type="time" min="10:00" max="20:00" step="900">
```

時刻の場合、`step`属性の値は秒単位で指定します。デフォルトの間隔は60秒（1分）です。この例では値を900とすることで、900秒=15分を指定しています。

フォーム送信時には、フォームコントロールに応じた、HTML仕様で定義される日付および時刻形式の値を送ります。日付を持つコントロールの場合、年月日はそれぞれ`-`（ハイフン）で区切られます。時刻を持つコントロールの場合、時と分は`:`（コロン）で区切られ、タイムゾーン情報は持ちません。日付と時刻の両方を持つ場合は`T`で区切られます。たとえば、2020年11月29日15時40分は以下のようになります。<!-- https://jra.jp/datafile/seiseki/g1/jc/result/jc2020.html -->

```text
2020-11-29T15:40
```

#### アクセシビリティ上の注意点

`month`、`week`、`date`、`time`、`datetime-local`はいずれも、デフォルトのARIAロールはありません。

このコントロールの表現方法はブラウザーによってさまざまであり、スクリーンリーダーによる読み上げや操作方法もさまざまです。カレンダーが表示される場合、カレンダーを`table`要素のようにテーブルとして読み上げることもあります。

### 数値の入力: `number`

`type=number`は、ユーザーに数値を入力させるコントロールを表します。ブラウザーは、数値を入力するのに適した機能を提供することがあります。たとえば、数字のみを入力できるキーパッドを表示したり、数値を増減させるためのスピンボタンを表示する場合があります。

![スクリーンショット: スピンボタンが表示されたtype=numberの例](../img/3-9-04.png)

ここでいう数値は、HTML仕様で定義される「妥当な浮動小数点数」（valid floating-point number）です。数字以外の文字も入力できることに注意してください。小数を表す`.`（ピリオド）や、`+`や`-`の正負符号も入力可能です。`3.14e+20`のような指数表記も可能で、`e`と`E`が入力できます。

デフォルトではあらゆる数値を入力できますが、`min`属性、`max`属性、`step`属性を利用すると、値の範囲を指定できます。たとえば、1以上100以下の整数を入力させたい場合は、次のようにします。

```html
<input type="number" min="1" max="100" step="1" value="1">
```

`min`属性や`max`属性には負の数も指定可能です。また、`step`属性には小数も指定可能です。-1以上1以下の数値を0.01刻みで入力させたい場合は、次のようになります。

```html
<input type="number" min="-1" max="1" step="0.01" value="0">
```

数字で表現されているものが、必ずしも数値とはならないことに注意してください。たとえば、ID番号、郵便番号、クレジットカード番号などは数字で表現されてはいますが、数値を増減させるような操作にはなじみません。そのような数字を入力させる場合は、`type=text`を使うのが適しています。`type=number`を使用する目安としては、スピンボックスで値を増減することが適当かどうかを考えるのがよいでしょう。

`type=number`の入力欄では、フォーム送信時に入力値の検証が行われます。空でない値が入力されている場合には、浮動小数点数の形式となる必要があります。そうでない場合、フォーム送信をしようとするとエラーメッセージが表示され、送信できません。

値の先頭に符号を付けていたり、指数形式で入力していたりする場合でも、値の変換は行われないことに注意してください。たとえば、"+1e-3"と入力されていた場合、これは"0.001"と同値ですが、変換されることなく"+1e-3"という文字列がそのまま送られます。数字のみで構成された値を選択させたい場合は、`select`要素を検討するとよいでしょう。

#### `maxlength`属性と`size`属性の扱い

`input`要素に`type=number`を指定した場合、`maxlength`属性や`size`属性は指定できないことになっています（最大値を制限したい場合は、`max`属性を利用します）。

しかし、`type=number`を解釈しない古いブラウザーは、これを`type=text`であると解釈します。その場合には`maxlength`属性や`size`属性が有効になるため、これらの属性が意味を持つことになります。この互換性のため、これらの属性は「旧式だが適合する機能」(Obsolete but conforming)という扱いで許容されています。

ただし、チェッカーは好ましくないものとして警告を出します。互換性の観点での必要性がない場合には、これらの属性は指定しないほうがよいでしょう。

#### アクセシビリティ上の注意点

`type=number`の場合、デフォルトのARIAロールは`spinbutton`です。スクリーンリーダーは「スピンボタン」「ステッパー」などと読み上げることがあります。

### 一定範囲内の数値を指定: `range`

`type=range`は、一定範囲内の数値を指定するコントロールを表します。多くの場合、スライダーコントロールとして表現されます。スライダーでつまみを動かすインターフェイスであるため、大まかな値を感覚的に指定しやすい反面、正確な値の細かい指定には向いていません。

![スクリーンショット: type=rangeによるスライダーの例](../img/3-9-05.png)

`type=number`と同様、`min`属性、`max`属性、`step`属性で値の範囲を指定できます。これらの指定がない場合は、`min=0`、`max=100`、`step=1`がデフォルト値となります。

`datalist`要素と組み合わせると、スライダーに目盛りを付けることができます。目盛りがある場合、ブラウザーは目盛りに近い値を目盛りの値に合わせてくれる（目盛りにスナップさせる）ことがあります。以下は、範囲が0～100、ステップが0.2のスライダーに、50ごとに目盛りを付ける例です。

```html
<input id="range01" type="range" min="0" max="100" step="0.2" value="0" list="scale" />
<datalist id="scale">
<option>0</option>
<option>50</option>
<option>100</option>
</datalist>
```

#### アクセシビリティ上の注意点

`type=range`の場合、デフォルトのARIAロールは`slider`です。`slider`ロールは暗黙の`aria-orientation`の値`horizontal`を持ちます。これは、要素が水平方向の向きであることを表します。

スクリーンリーダーは「スライダー」などと読み上げることがあります。

### 色の選択: `color`

`type=color`は、色を選択するコントロールを表します。ブラウザーはカラーピッカーを提供することがあります。

![スクリーンショット: type=colorによるカラーピッカーの例](../img/3-9-06.png)

フォーム送信時には、`#`（ハッシュ）で始まる6桁のCSS 16進数記法のsRGB値が送られます。たとえば、"`#ff00a1`"のような値が送信されます。

ブラウザーによっては、HSLのような、RGBではない色指定方法のインターフェイスを採用することがあるかもしれませんが、その場合でも結果の値は常にRGBで送信されます。また、アルファチャンネル値（不透明度; opacity）も指定できません。

#### アクセシビリティ上の注意点

`type=color`の場合、デフォルトのARIAロールはありません。このコントロールの表現方法はブラウザーによってさまざまであり、スクリーンリーダーによる読み上げや操作方法もさまざまです。

### チェックボックス: `checkbox`

`type=checkbox`は、チェックボックスを表します。チェックボックスは、チェックされている状態と、チェックされていない状態を持ちます[^6]。

[^6]: JavaScriptから`HTMLInputElement`インターフェイスの`indeterminate`プロパティを`true`にすると、未確定（indeterminate）という状態にできます。こうすると、チェックボックスの現在の状態が表示されなくなります（オンともオフとも異なる見た目になります）。しかし、これが影響するのは見た目だけで、チェック状態や送信される値には影響しません。チェックボックスがチェックされたあとで`indeterminate`プロパティを`true`に設定しても、チェックが解除されるわけではなく、値がそのまま送信されます。 <!-- Chromeで動作確認しましたがこういう挙動でした。 -->

典型的には、YES/NO、ON/OFFのような二択で選ぶ項目に使うことができます。次の例は、「利用規約に同意する」というラベルを伴うチェックボックスの例です。

```html
<label><input type="checkbox" name="agree">利用規約に同意する</label>
```

また、複数選択が可能な選択肢を提示する場合にも使うことができます。

```html
<fieldset>
<legend>所有している機器 (複数選択可能)：</legend>
<label><input type="checkbox" name="gadget" value="desktop">デスクトップパソコン</label>
<label><input type="checkbox" name="gadget" value="laptop">ノートパソコン</label>
<label><input type="checkbox" name="gadget" value="smartphone">スマートフォン</label>
<label><input type="checkbox" name="gadget" value="tablet">タブレット</label>
</fieldset>
```

フォームを送信するときにチェックボックスがチェックされている場合、`value`属性で指定した値が送られます。なお、`value`属性が存在しない場合は"`on`"という値が送られます。チェックボックスがチェックされていない場合、フォームを送信してもその値は送られません。

`checked`属性を指定すると、チェックされている状態が初期状態になります。`checked`属性はブール型属性です。

#### アクセシビリティ上の注意点

`type=checkbox`の場合、デフォルトのARIAロールは`checkbox`です。スクリーンリーダーは対応するラベルを読み上げたあと、「チェックボックス」などと読み上げ、ラジオボタンがチェックされた状態であれば「チェックされています」などと読み上げて現在のチェック状態を伝えます。

### ラジオボタン: `radio`

`type=radio`は、ラジオボタンを表します。チェックボックスと同様に、チェックされている状態とチェックされていない状態を持ちますが、選択肢の中から1つのみを選択できるという点が異なります。

同一のフォーム内に、同一の`name`属性の値を持つラジオボタンが複数ある場合、それらは「ラジオボタングループ」(radio button group)を構成します。同一のラジオボタングループに属するラジオボタンのうち、チェック状態にできるのは1つだけです。チェックされていないラジオボタンをチェックすると、既にチェックされていたラジオボタンからはチェックが外れます。これはユーザーの操作に限らず、DOM操作などでチェック状態にした場合も同様です。

以下は性別を選択するラジオボタンの例です。

```html
性別：
<label><input type="radio" name="sex" value="1">男性</label>
<label><input type="radio" name="sex" value="2">女性</label>
<label><input type="radio" name="sex" value="9">その他</label>
<label><input type="radio" name="sex" value="0" checked>回答しない</label>
```

`checked`属性を指定すると、初期状態でチェックされている状態になります。`checked`属性はブール型属性です。上記の例では、「回答しない」が選択された状態で表示されます。

同一ラジオボタングループ内の複数のラジオボタンに`checked`属性を指定した場合は、ソースコード内で最後に現れた項目だけがチェック状態となり、他の項目はチェックが外れた状態になります。

<!-- 互換性メモ -->
古いHTML仕様では、ラジオボタングループの中でいずれか1つのラジオボタンを必ずチェック状態にしておく必要がありました。しかし、現在のHTML仕様にはそのような制限はなく、何も選択されていない状態を許しています。

ただし、一度でもラジオボタンがチェックされて選択されると、未選択状態に戻す手段がなくなるので注意が必要です。未選択に戻すことが必要な場合は、そのような機能をJavaScriptなどで実装するか、リセットボタンを用意する必要があります。リセットボタンは、フォームの他の項目もすべてリセットすることに注意してください。
<!-- /互換性メモ -->

チェックボックスと同様に、フォームを送信したときは、チェックされている項目の`value`属性の値が送られます。また、`value`属性が指定されていない場合は、"`on`"という値が送られます。

#### アクセシビリティ上の注意点

`type=radio`の場合、デフォルトのARIAロールは`radio`です。スクリーンリーダーは対応するラベルを読み上げたあと、「ラジオボタン」などと読み上げ、ラジオボタンがチェックされた状態であれば「チェックされています」などと読み上げて現在のチェック状態を伝えます。

### ファイルアップロードコントロール: `file`

`type=file`は、ファイルアップロードコントロールを表します。ユーザーは、このコントロールを操作してローカルのファイルを指定できます。指定されたファイルは、フォーム送信でサーバーにアップロードされたり、File API[^7]を通じてJavaScriptから読み取られたりします。

[^7]: MDNのWebアプリケーションからのファイルの使用が参考になります。<https://developer.mozilla.org/ja/docs/Web/API/File/Using_files_from_web_applications>

ファイルアップロードを行うフォームでは、`form`要素の`enctype`属性値を"`multipart/form-data`"とします。`enctype`属性の詳細は`form`要素を参照してください。最低限のファイルの送信フォームは次のようになります。

```html
<form enctype="multipart/form-data" method="post" action="/upload.php">
<label>アップロードするファイルを選択してください：
<input type="file" name="file">
</label>
<button>送信</button>
</form>
```

`multiple`属性を設定すると、複数ファイルの指定を可能にします。ブラウザーは、複数ファイルを選択可能なインターフェイスを表示します。多くの場合、ファイル選択インターフェイスの見た目に大きな変化はありませんが、<kbd>ctrl</kbd>キーを押しながら選択したり、ドラッグで範囲指定することで、複数のファイルを選択できるようになります。

`accept`属性を指定することで、ファイルの種類を絞り込むことができます。値として、以下の5種類の指定が可能です。

- 文字列"`audio/*`"を指定した場合：音声ファイルを指定できます。
- 文字列"`video/*`"を指定した場合：映像ファイルを指定できます。
- 文字列"`image/*`"を指定した場合：画像ファイルを指定できます。
- パラメーターのない妥当なMIMEタイプ文字列を指定した場合：`;`（セミコロン）を持たないMIMEタイプのファイルを指定できます。たとえば、`text/html`という指定はできますが、`text/html;charset=utf-8`という指定はできません。
- `.`（ピリオド）で始まる文字列を指定した場合：指定された拡張子のファイルを指定できます。

複数を組み合わせることも可能で、その場合はカンマで区切って列挙します。この場合、指定されたものすべてが受け入れ可能になります。たとえば、Microsoft Word文書をアップロードさせたい場合、以下のように指定できます。

<!-- 仕様の4.10.5.1.17 File Upload stateに掲載されているサンプルの引用-->
```html
<input type="file" accept=".doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">
```

ただし、この指定は厳密にファイルの種類を指定できるものではありません。拡張子".doc"を持つファイルであってもMicrosoft Wordファイルとは限らず、単なるテキストファイルかもしれません。また、ファイルの種類によっては、MIMEタイプが正式に登録されたものではないかもしれません。`accept`属性を指定しても、意図しない内容のファイルがアップロードされる可能性がありますので、この点は注意が必要です。

また、このコントロールにセキュリティ上の制約があることにも注意してください。このコントロールの`value`属性の値はファイル名となりますが、HTMLで`value`属性を指定したり、JavaScriptから`value`属性に値を指定しようとしても、意図したとおりには動作しません。JavaScriptからアップロードファイルを設定する場合は、`files`プロパティにファイルの内容を直接設定する必要があります。この制約は、ユーザーの操作を介さないローカルファイルの読み取りを防ぐためのものです。

#### アクセシビリティ上の注意点

`type=file`の場合、デフォルトのARIAロールはありません。

多くのブラウザーはボタンを表示するため、スクリーンリーダーは「ボタン」と読み上げることがあります。関連付けられたラベルが存在する場合は、そのラベルを読み上げてから「ボタン」と読み上げます。ラベルがない場合、現在指定されているファイルのパス名を読み上げることがあります。

多くの場合、`multiple`属性を使用しても、複数選択可能であることはユーザーに伝わりません。ユーザーに複数の値が許可されていることをテキストで明示するとよいでしょう。

### ボタン: `submit`、`reset`、`button`

`type=submit`、`type=reset`、`type=button`は、ボタンを表します。いずれも、同一の`type`属性を持つ`button`要素と同様の挙動となります。詳しくは`button`要素を参照してください。

`button`要素では要素の内容がボタンのラベルとなりますが、`input`要素の場合は`value`属性の値をラベルとして扱います。そのため、ボタンのラベルにマークアップを含められないという制約があります。特に理由がなければ、`button`要素を使ったほうがよいでしょう。

#### アクセシビリティ上の注意点

`type=submit`、`type=reset`、`type=button`の場合、デフォルトのARIAロールは`button`です。

スクリーンリーダーは`value`属性の値を読み上げたあと、「送信ボタン」、「ボタン」などと読み上げます。

`value`属性の値がラベルとして扱われるため、`label`要素でラベルを与える必要はありません。`label`要素を関連付けした場合はそのラベルが優先され、`value`属性の値は読み上げられなくなります。

### イメージボタン：`image`

`type=image`はイメージボタン、すなわち、画像によって表現された送信ボタンを表します。役割は`type=submit`とほぼ同じですが、ボタンとして画像を表示する点と、クリックした画像の座標を送信する点が異なります。

画像の指定は`img`要素と同じように、`src`属性で画像を指定し、`alt`属性で代替テキストを提供します。`width`属性、`height`属性で画像サイズのヒントを指定できることも`img`要素と同様です。ただし`srcset`属性は定義されませんし、`picture`要素と組み合わせることもできないため、複数の画像候補を指定できません。

#### コラム：イメージボタンと座標

以下は、フォームに2つのイメージボタンを配置した例です。

```html
<form>
    <input type="image" name="button1" src="button1.png" alt="送信ボタン1">
    <input type="image" name="button2" src="button2.png" alt="送信ボタン2">
</form>
```

このボタンをマウスなどのポインティングデバイスでクリックした場合、フォーム送信時にクリックした位置の座標が送信されます。座標は、画像の左上を`(0,0)`とし、左右位置をx座標、上下位置をy座標としたもので、単位はCSSピクセルです。送信される値は、ボタンの`name`属性の値と`.x=` あるいは`.y=`を連結し、その後に座標値を記述したものとなります。たとえば、上記の例で、`button1`の画像の左から100ピクセル、上から5ピクセルの位置をクリックした場合、以下の値が送信されます。

```text
?button1.x=100&button1.y=5
```

座標の値はCSSピクセルの整数であるため、小数点以下の数値になることはありません。ただし、負の値になることはあります。たとえば、CSSで`border`や`padding`プロパティが設定されている場合、ボタン画像の外側の領域をクリックできることがあり、画像より左や上の領域をクリックすると座標は負の値になります。なお、クリックを伴わないキーボード操作などでそのボタンを押した場合、座標の値は`(0,0)`となり、`x=0`、`y=0`が送信されます。

<!--
図であらわすとこんな感じ
https://www.tagindex.com/html5/form/image/image_coordinates.gif
-->

この座標を利用することで、サーバーサイドイメージマップと似た動作を実現できます。ただし、ポインティングデバイスで特定の箇所をクリックするという動作ができないユーザーもいるため、この操作にはアクセシビリティ上の問題があります。イメージマップを利用したい場合には、クライアントサイドイメージマップ（`area`要素）を使うほうが望ましいでしょう。

実務上、座標が必要になるケースはほぼないといえます。単にボタンを画像にしたい場合は、`button`要素内に`img`要素を入れた上で、細かいスタイル調整をするほうがよいでしょう。

#### アクセシビリティ上の注意点

`type=image`の場合、デフォルトのARIAロールは`button`です。

スクリーンリーダーは`alt`属性の値を読み上げてから「ボタン」と読み上げます。`alt`属性の値がラベルとして扱われるため、`label`要素でラベルを与える必要はありません。`label`要素を関連付けした場合はそのラベルが優先され、`alt`属性の値は読み上げられなくなります。

### 隠しコントロール: `hidden`

`type=hidden`は、ユーザーに値を提示しない、編集もできないコントロールを表します。システム側では値を受け取る必要があり、しかしユーザーに入力・編集させる必要がないような場合に利用します。以下は、ショッピングサイトで商品をカートに入れる際のフォームの例です。

```html
<form action="/cart.php" method="post">
  <input type="hidden" name="id" value="item42">
  <input type="hidden" name="price" value="9800">
  <button>この商品をカートに入れる</button>
</form>
```

この例では、ユーザーには「この商品をカートに入れる」というボタンだけが見えています。ユーザーがボタンを押すと、商品のIDと価格が送信され、システム側でカートに追加する処理が行われます。

このコントロールの値は秘匿されないことに注意してください。ユーザーはHTMLのソースを直接読んだり、ブラウザーの開発者ツールで調査することで、値を読み取れます。値を書き換えることも可能です。たとえば上記の例では、ユーザーは`price`の値を書き換え、商品を不正な価格で購入しようとするかもしれません。値を読み取られたり書き換えられたりすると問題がある場合は、このコントロールを利用すべきではありません。

#### アクセシビリティ上の注意点

`type=hidden`の場合、デフォルトのARIAロールはありません。視覚的にも隠されていますし、スクリーンリーダーにも読み上げられることはありません。ただし前述のように、内容を秘匿できるものではないことに注意してください。

### 内容モデル

`type`属性の値が何であれ、`input`要素の内容モデルはNothingで、内容を持つことはできません。また、終了タグを書くこともできません。

### 属性

<!--
4.10.5.3.1 The maxlength and minlength attributes
4.10.5.3.2 The size attribute
4.10.5.3.3 The readonly attribute
4.10.5.3.4 The required attribute
4.10.5.3.5 The multiple attribute
4.10.5.3.6 The pattern attribute
4.10.5.3.7 The min and max attributes
4.10.5.3.8 The step attribute
4.10.5.3.9 The list attribute
4.10.5.3.10 The placeholder attribute
-->

`input`要素は前述のように`type`属性を持ち、これによって大きく挙動が変わります。他の属性もありますが、ほとんどの属性は`type`属性が特定の値のときのみ使えるものであり、常に使用できるものではないことに注意してください。どの属性をどの`type`属性と組み合わせられるかの正確な情報は、仕様を参照してください。

また、後述するフォームコントロールの共通属性も利用可能です。

#### `type`属性

`type`属性は列挙型属性で、22種類の値が定義されています。属性値の種類とそれぞれの意味は、先に述べたとおりです。`type`属性を省略した場合や、ブラウザーにとって未知の値であった場合は、デフォルトの"`text`"になります。

#### `maxlength`および`minlength`属性

入力値として許容する文字列の長さを指定します。文字数そのものではなく、長さの指定であることに注意してください。`maxlength`属性は最大の長さを、`minlength`属性は最小の長さを指定します。

文字列の長さは、基本的には単に文字数と考えればよく、全角・半角は問わずに文字1つを長さ1と数えます。ただし、漢字の異体字や絵文字など、一部の文字は1文字で長さ2と数えることがあります[^8]。

[^8]: 一部の文字を長さ2と数えるのは、JavaScriptで文字列の長さを取得する際と同じ挙動です。JavaScriptの内部では、文字列の文字エンコーディングはUTF-16として扱われており、Unicodeスカラー値がU+10000以上の文字は「サロゲートペア」と呼ばれる2つの文字の組み合わせで表現しています。このため、U+10000以上の文字は2文字とカウントされます。たとえば、JavaScriptで`'🍣'.length`を実行すると`2`が返ります。

<!--
See also:
https://blog.jxck.io/entries/2017-03-02/unicode-in-javascript.html
https://jsprimer.net/basic/string-unicode/
-->

なお、次のChapterで紹介する`textarea`要素の場合は、改行も1文字としてカウントします。改行コードがCR+LFであったり、文字参照で`&#13;&#10;`と記述してあっても長さ1と数えられます。

`minlength`属性が指定されていても、それより短い値を入れること自体は可能です。ただし、フォーム送信をしようとするとエラーメッセージが表示され、送信できません。

```html
<label>パスワード<input type="password" minlength="8"></label>
```

この例では、パスワードを長さ8以上の文字列を入力しなければならないことになります。長さ8未満の状態でフォーム送信をするとエラーとなります。

![Chromeでエラーが表示された例。「このテキストは8文字以上で指定してください(現在は4文字です)」と表示。](../img/3-9-07.png)

`maxlength`属性も同様ですが、`maxlength`属性の場合、エラーを出す代わりに、入力を抑制してもよいことになっています。多くのブラウザーでは、`maxlength`属性の指定よりも長い値を入力しようとした場合、キーボードから入力を試みても何も入らない、文字列をペーストした場合は長さを超えた分が切り捨てられる、という挙動になります。
<!--
仕様ではこの挙動はmayとなっている。なおminlengthのほうには該当の記述はない。
https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#limiting-user-input-length:-the-maxlength-attribute
>User agents may prevent the user from causing the element's API value to be set to a value whose length is greater than the element's maximum allowed value length.
-->

特に、ユーザーが値をペーストした場合や、`type="password"`の入力欄を利用している場合、値の切り捨てに気づかない可能性があるため、注意が必要です。

#### `size`属性

`size`属性は、`input`要素の見た目の幅を指定します。指定する値は文字数で、デフォルト値は"`20`"です。以下の例では、4文字に相当する幅の入力欄が表示されます。

```html
<label>名前(姓):
  <input name="name" size="4">
</label>
```

ただし、ちょうど4文字分の幅になるとは限らないことに注意してください。この値はブラウザーによって解釈が異なることが知られており、CSSの`width`プロパティで単位`em`や`ex`で指定した幅とも異なります。<!-- MDNにはemっぽいことが書いてあるが実際試してみると明らかに異なる幅になる。 https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#htmlattrdefsize -->なお、スタイルシートで幅が指定されている場合は`size`属性の指定よりも優先されます。正確な幅を指定したい場合はスタイルシートで指定するとよいでしょう。

`size`属性で指定できるのは見た目の幅であり、実際に入力できる文字数とは関係ないことに注意してください。文字数の制限は`maxlength`属性や`minlength`属性で行います。

#### `readonly`属性

`readonly`属性は、コントロールが編集可能かどうかを表すブール型属性です。この属性が指定されている場合、コントロールは読み取り専用となり、ユーザーによる入力を受け付けません。

`disabled`属性とは異なり、単に入力ができないだけであることに注意してください。値が入力済みのコントロールに、JavaScriptで後から`readonly`属性を設定した場合、現在の値は編集できなくなりますが、無効になるわけではありません。フォーム送信時は現在の値がそのまま送信されます。

なお、コントロールの種類によっては`readonly`属性を適用できない場合があります。`type`属性が`hidden`、`range`、`color`、`radio`、`checkbox`、`file`、`image`、`submit`、`reset`、`button`の場合、`readonly`属性を指定しても無視されます。

#### `required`属性

`required`属性は、コントロールが入力必須かどうかを表すブール型属性です。この属性が指定されたコントロールは入力必須項目として扱われ、値が入力されていないとフォーム送信時にエラーとなります。以下はユーザー名を必須項目とする例です。

```html
<label>ユーザー名 (必須):
  <input name="username" required>
</label>
```

空欄のままフォーム送信すると、エラーになります。

![Chromeでエラーが表示された例。「このフィールドを入力してください」と表示。](../img/3-9-08.png)

値が空でなければ送信可能です。ユーザーが入力したものでも、`value`属性で最初から設定されているものでも構いません。また、値がASCII空白文字のみであってもエラーにならず、送信可能です。

なお、コントロールの種類によっては`required`を適用できないものがあります。`type`属性が`range`、`color`、`submit`、`reset`、`button`の場合、`required`属性を指定しても無視されます。

チェックボックスやラジオボタンにも`required`属性を指定できます。チェックボックスの場合、`required`属性を指定したチェックボックスにチェックを入れることが必須となります。ラジオボタンの場合、同一のラジオボタングループに属するラジオボタンのいずれかにチェックを入れることが必須となります。

以下は、3つの選択肢から選ぶラジオボタンの例です。

```html
<label><input type="radio" name="opt" value="1" required>1</label>
<label><input type="radio" name="opt" value="2">2</label>
<label><input type="radio" name="opt" value="3">3</label>
```

この例では最初の選択肢のみに`required`属性が指定されていますが、3つの選択肢のいずれかを選ぶことができます。何も選んでいない状態で送信した場合はエラーとなります。

#### `multiple`属性

`multiple`属性は、ユーザーに複数の値を指定することを許可するかどうかを表すブール型属性です。`type`属性が`email`または`file`の場合のみ利用できます。詳しくは`type=email`、`type=file`を参照してください。

#### `pattern`属性

`pattern`属性を指定すると、テキスト入力コントロールの値をチェックできます。指定する値は正規表現の文字列で、JavaScriptの正規表現アルゴリズムと同一の文法で記述します。

たとえば、`http://`または`https://`で始まるURLのみを受け付けたい場合、次のように書くことができます。

```html
<input type="url" pattern="^https?://.+" title="httpまたはhttpsで始まるURLを入力してください。">
```

`title`属性を指定しておくと、エラー時の説明文として表示されることが期待できます。`pattern`属性を指定している場合、どのような値を入力する必要があるのかユーザーに伝わりにくい場合が多いため、`title`属性を指定しておくべきです。上記の例では、たとえば以下の図のようにエラーが表示されます。

![Chromeでエラーが表示された例。「指定されている形式で入力してください。httpまたはhttpsで始まるURLを入力してください。」と表示。](../img/3-9-09.png)

なお、値が空の場合は`pattern`属性による検証が行われません。以下は3〜4文字の入力を期待している例です。

```html
<input pattern="[0-9]{3,4}" title="3〜4文字の数字を入力してください">
```

この場合、1〜2文字の入力や5文字以上の入力ではエラーになりますが、0文字、すなわち何も入力していない場合にはエラーになりません。未入力をエラーにしたい場合は`required`属性を使用します。

この属性が指定できるのは、テキスト入力のコントロールのみです。すなわち、`type`属性が`text`、`search`、`url`、`tel`、`email`、`password`の場合です。そうでない場合、`pattern`属性を指定しても無視されます。

<!-- security consideration -->
`pattern`属性による値の検証は、セキュリティ上の意味を持つものではないことに注意してください。ユーザーは開発者ツールを用いて`pattern`属性も削除できますし、ブラウザーを使わずに特殊なツールからサーバーに値を送ることもできます。`pattern`属性による検証は、あくまでユーザーの利便性のためのものに過ぎず、サーバー側での検証を不要にするものではありません。
<!-- /security consideration -->

#### `min`および`max`属性

`min`および`max`属性はそれぞれ、数値や日時の最小と最大の値を示します。
たとえば、日付コントロールで2021年7月23日から2021年8月8日までの範囲を指定する場合、次のようになります。<!-- なんとなく五輪期間中にしておきます -->

```html
<input type="date" min="2021-07-23" max="2021-08-08">
```

どちらか片方だけの指定もできます。以下は`min`属性を指定し、0以上の数値を入力させるようにした例です。

```html
<input type="number" min="0">
```

この例では`max`属性の指定がないため、入力できる値に上限はありません。

この属性が指定できるのは、値の範囲を制限できるコントロールのみです。すなわち、`type`属性が`date`、`month`、`week`、`time`、`datetime-local`、`number`、`range`の場合です。そうでない場合、この属性を指定しても無視されます。

`min`属性と`max`属性を同時に指定する場合、原則として、`min`属性よりも`max`属性のほうが大きくなくてはなりません。ただし、`type=time`のコントロールについては、「反転した範囲」(reversed range)を指定できます。次の例は、深夜・早朝の時間帯を指定させることを意図しています。

```html
<input type="time" min="22:00" max="06:00">
```

この例では、22:00〜23:59、および00:00〜06:00までの時刻が設定できます。`min`属性と`max`属性の値を入れ替えると、06:00〜22:00と指定することになり、意味が変化することに注意してください。

#### `step`属性

`step`属性は、値の刻み幅を制御します。文字列`any`または正の浮動小数点数を指定できます。属性値に数値を指定した場合、コントロールはstep値の倍数のみを受け入れます。

この属性が指定できるのは、値の範囲を制限できるコントロールのみです。すなわち、`type`属性が`date`、`month`、`week`、`time`、`datetime-local`、`number`、`range`の場合です。そうでない場合、この属性を指定しても無視されます。

`step`属性を省略した際のデフォルト値はコントロールによって異なります。`date`、`month`、`week`、`number`、`range`の場合、デフォルト値は"`1`"です。`time`、`datetime-local`の場合は"`60`"で、これは60秒を意味します。つまり、デフォルトでは1分刻みになります。`step=1`を指定すれば1秒刻みの値を指定できるようになりますし、`step=0.001`を指定すれば1ミリ秒単位で指定できるようになります。

`step=any`を指定すると、値の刻み幅に制限がない状態となり、いかなる細かい値も指定できるようになります。これはデフォルトの指定とは異なることに注意してください。"`any`"の指定は、そのコントロールで実現可能な最も小さな`step`を指定するのと同じ意味になります。

#### `list`属性

`list`属性は、ユーザーに提案する定義済み候補のリストを示します。値は、同一文書内の`datalist`要素のIDでなければなりません。詳細については、`datalist`要素を参照ください。

なお、コントロールの種類によっては定義済み候補のリストを利用できないものがあります。`type`属性が`hidden`、`password`、`radio`、`checkbox`、`file`、`image`、`submit`、`reset`、`button`の場合、`list`属性を指定しても無視されます。

#### `placeholder`属性

これは、ユーザー入力の支援をするためのヒント（単語や短いフレーズ）を表します。

`label`要素と似ていますが、`label`要素のラベルが常に表示されているのに対し、`placeholder`属性の値は入力欄に値が入力されていない時だけ表示されます。ユーザーが値の入力を始めたあとで、プレースホルダーのテキストを読み返すことはできません。`placeholder`属性で提供される入力支援のヒントは、入力前に読んで覚えておかなければならないのです。これはユーザーの記憶に負担を与えることになります。

フォームコントロールにあらかじめ空でない初期値が設定されている場合、`placeholder`属性の値は表示されません。ユーザーが入力内容を訂正するフォームでは、`placeholder`属性の値がまったく役に立たないことがあります。

##### アクセシビリティ上の注意点

`placeholder`属性にはアクセシビリティ上の注意点がいくつかあります。

多くのスクリーンリーダーは、入力欄の`placeholder`属性の値を読み上げます。しかし、`placeholder`属性を`label`要素の代替として使用すべきではありません。

プレースホルダーのテキストは、入力欄に値が入力されると表示されなくなります。この場合、スクリーンリーダーにも読み上げられなくなります。

一般に、プレースホルダーテキストはデフォルトで薄い文字色として表示されることがあります。この配色はWCAGで定めるコントラスト比を満たさないことがあり、一部のユーザーはこのテキストを読むことができない場合があります。

しかしコントラストを高めすぎると、プレースホルダーテキストが入力値であるように見えてしまいます。プレースホルダーテキストを見て、その入力欄が入力済みであると勘違いするユーザーが出てくることになるでしょう。

`placeholder`属性にはさまざまなデメリットがあり、扱いが難しいものです。`placeholder`属性を用いる場合には、これらに注意するようにしましょう。

## フォームコントロールの共通属性
<!--
4.10.18.1 Naming form controls: the name attribute
4.10.18.2 Submitting element directionality: the dirname attribute
4.10.18.3 Limiting user input length: the maxlength attribute
4.10.18.4 Setting minimum input length requirements: the minlength attribute
4.10.18.5 Enabling and disabling form controls: the disabled attribute
4.10.18.6 Form submission attributes
4.10.18.7 Autofill
4.10.18.7.1 Autofilling form controls: the autocomplete attribute
4.10.18.7.2 Processing model
-->
`input`要素には、フォームコントロールの共通属性を指定できます。HTML仕様では次の属性が定義されています。

`name`、`dirname`、`disabled`、`form`、`formaction`、`formenctype`、`formmethod`、`formnovalidate`、`formtarget`、`autocomplete`

### `name`属性

`name`属性は、フォームコントロールに名前を与えます。フォーム送信時には、有効なフォームコントロールの`name`属性の値が送信されます。`name`属性が指定されていないと、そのコントロールの値は送信されません。フォーム送信時の動作の詳細については、`form`要素も参照してください。

`name`属性では複数の要素に同じ名前を与えることができます。複数のチェックボックスやラジオボタンに同じ`name`属性を指定すると、それらは同一のグループに属するものとみなされます。詳しくは`radio`の項を参照してください。

フォーム送信時には、同名の`name`属性があってもまとめられることはなく、すべて個別に送信されます。以下はふたつのチェックボックスに同じ名前を指定した例です。

```html
<label><input type="checkbox" name="animal[]" value="cat">ねこ</label>
<label><input type="checkbox" name="animal[]" value="dog">いぬ</label>
```

このチェックボックスの両方にチェックして送信すると、以下のような値が送られます。`名前=値`のペアが複数送信されている点に注目してください。

```text
animal%5B%5D=cat&animal%5B%5D=dog
```

なお、フォーム送信を受け取る側の処理系によっては、同名の値をひとつにまとめて処理できることもあります。たとえばPHPでは、名前の末尾に`[]`がついた値を配列として扱うことができます。上記の例で送信された値は、`$_POST['animal']`として取得でき、その値は`["cat", "dog"]`という配列になります。

### `dirname`属性

テキスト入力を行うコントロールに`dirname`属性を指定すると、テキストの書字方向の情報を送信できます。詳細は仕様を参照してください。

### `disabled`属性

`disabled`属性を指定すると、そのフォームコントロールを無効にできます。`disabled`属性はブール型属性です。この属性をJavaScriptから制御することで、特定の条件を満たした場合にのみ入力可能な入力欄を実現できます。

フォームコントロールが無効の場合、入力や編集、ボタン操作といった動作が行えなくなります。フォーカスを当てることもできません。ブラウザーは多くの場合、フォームコントロールの見た目を薄い色に変更するなど、無効であることがわかるようにします。また、スクリーンリーダーでは「無効なコントロール」などと読み上げられることがあります。

無効になっているフォームコントロールの値は送信されません。ユーザーが値を入力したあとでJavaScriptによって`disabled`属性が設定された場合、ユーザーが入力した値が送られなくなることに注意してください。この点は`readonly`属性との大きな違いです。

### `form`属性

通常、フォームコントロールは祖先要素の`form`要素と関連付けられています。祖先となっている`form`要素内の送信ボタンが押されると、コントロールの値が送信されます。

しかし時には、`form`要素の外にある要素を関連付けしたい場合があります。`form`属性を利用すると、関連する`form`要素を明示的に指定できます。`form`要素に`id`属性を指定し、そのIDを`form`属性に指定します。

```html
<form id="form01">
  <!-- さまざまな入力欄 -->
  <button>送信する</button>
</form>
<!-- さまざまなコンテンツ　-->
<button form="form01">送信する</button>
```

この例では、2つ目の`button`要素が`form`要素の外にありますが、`form`属性でフォームと関連付けられているため、フォーム内に置かれているかのように機能します。このボタンを押すことでフォームを送信できます。

### フォーム送信を制御する属性

`button`要素や、ボタンとして機能する`input`要素に以下の属性を指定すると、フォーム送信時の挙動を制御できます。

- `formaction`
- `formenctype`
- `formmethod`
- `formnovalidate`
- `formtarget`

これらの属性が指定されたボタンを押して送信すると、`form`要素の対応する属性を上書きするように働きます。以下は`formaction`属性と`formnovalidate`属性を利用する例です。

```html
<form action="register.php" method="post">
  <!-- さまざまな入力欄 -->
  <label>メモ:
    <textarea required name="note"></textarea>
  </label>
  <button name="mode" value="register">登録</button>
  <button formnovalidate formaction="temp-save.php">下書き保存</button>
</form>
```

この例では`textarea`要素に`required`属性が指定されているため、未入力のまま「登録」ボタンを押すとエラーとなります。一方、「下書き保存」ボタンには`formnovalidate`が指定されているため、下書き保存時にはエラー検証が行われず、未入力のままで送信できます。その際、送信先も`temp-save.php`に変化します。

### `autocomplete`属性

`autocomplete`属性を指定すると、ユーザーエージェントに対して、フォームコントロールの入力補完に関するヒントを与えることができます。この属性は大きく分けて2種類あり、ひとつは自動補完の動作自体を制御するもの（autofill expectation mantle）、もうひとつは値の種類を指定するもの（autofill anchor mantle）です。
<!-- 表現至難。mantleは外套、マントのmantleでは原文はwear...mantleと「マントを羽織る」という表現。 -->

この属性は`form`要素にも指定でき、その場合はフォーム内のコントロールのデフォルトの挙動を指定します。個々のフォームコントロールに`autocomplete`属性が指定されている場合、そちらが優先されます。

#### 自動補完の動作を制御する

自動補完の動作自体を制御しようとする場合、属性値として"`on`"もしくは"`off`"を指定します。"`off`"を指定した場合、該当の入力欄がセンシティブな値か、再入力すべきでない値を扱うことを示唆します。<!-- 原文には for example the activation code for a nuclear weapon とある…… -->"`on`"の場合は、再入力してよい値であり、入力補完が許されるものであることを示唆します。

`input type=password`の入力欄では、`autocomplete=off`が特殊な扱いを受けることがあります。モダンなブラウザーではパスワードを一括管理する機能を持ちます。このパスワード管理機能はセキュリティの向上につながるため、モダンなブラウザーのほとんどは`autocomplete=off`の指定があってもユーザーにパスワードを保存するかどうかを尋ね、ユーザーが許可すればパスワードを保存する挙動を示します。企業によっては「ブラウザーにパスワードを記憶させないようにすること」という古いガイドラインを持つ場合がありますが、現在ではウェブコンテンツ側で実現することは事実上不可能です。

なお、新しいパスワードを設定するときは、そのことを示す値の種類"`new-password`"を指定することで、入力欄にパスワードを補完させるのを防ぐ効果が期待できます。

#### 値の種類を指定する

ブラウザーに対して値の種類を示唆することで、ブラウザーは適切な入力の補完ができます。

たとえば、ユーザーが「氏名」という入力欄に入力した後、別の場所で同様に「氏名」の入力を求められた場合、ブラウザーは先に入力した氏名のデータを記憶しておき、後の入力欄を補完することがあります。

このとき、ブラウザーは、その入力欄の値の種類が同一かどうかを判断する必要があります。ブラウザーは`input`要素の`name`属性の値をヒントにして同一性を判断しますが、`autocomplete`属性を利用すると、その種類を明示的に指定できます。氏名のほかにも、住所、性別、クレジットカード番号、URL、メールアドレスなどを明示できます。

属性値には、4種類のトークンを組み合わせた値を指定します。それぞれ以下のようになります。

- 配送先か、請求先か：配送情報であれば"`shipping`"、請求情報であれば"`billing`"を指定します。どちらでもなければ省略します。
- グループ名：値が何かのグループに属する場合、"`section-`"で始まるグループ名を指定できます。グループ名は任意に付けることができます。配送元と配送先の両方の住所を入力しなければならない場合など、同種の情報を区別する必要がある場合に利用します。省略可能です。
- 値の種類：値の種類を示すキーワードを指定します。キーワードは仕様で規定されており、"`name`"、"`nickname`"、"`country`"、"`photo`"など40種類以上が存在します。詳しくは仕様を参照してください[^1]。
- 追加の種類：電話番号やメールに対して、自宅や職場といった追加情報を指定できます。省略可能です。

[^1]: HTML §4.10.18.7.1 Autofilling form controls: the autocomplete attribute <https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#autofilling-form-controls:-the-autocomplete-attribute>

複数のトークンを指定する場合は、スペースで区切ります。たとえば、フォームで2つの配送先住所がある場合、次のようにマークアップできます。

<!--何かわかりやすい例を作成 以下はHTMLStdからの複写-->
```html
<fieldset>
  <legend>1つ目のギフトの配送先</legend>
  <p><label>郵便番号: <input name="bp" autocomplete="section-blue shipping postal-code"></label>
  <p><label>都道府県: <input name="bc" autocomplete="section-blue shipping address-level1"></label>
  <p><label>住所:     <textarea name="ba" autocomplete="section-blue shipping street-address"></textarea></label>
</fieldset>

<fieldset>
  <legend>2つ目のギフトの配送先</legend>
  <p><label>郵便番号: <input name="rp" autocomplete="section-red shipping postal-code"> </label>
  <p><label>都道府県: <input name="rc" autocomplete="section-red shipping address-level1"> </label>
  <p><label>住所:     <textarea name="ra" autocomplete="section-red shipping street-address"></textarea></label>
</fieldset>
```

#### アクセシビリティ上の注意点

ここまでで説明したように、`autocomplete`属性を用いることで、どのような入力欄であるかを伝えることができます。これはWCAG 2.1達成基準1.3.5入力目的の特定[^2]を満たす方法の1つとなっています[^3]。一部のブラウザーは、`autocomplete`属性を手がかりに、あるフォームで入力した値の記憶を試みます。そして別のフォームで対応する`autocomplete`属性値を持つ入力欄に対して、記憶に成功した値を自動補完します。これはアクセシビリティの向上だけでなく、ユーザビリティの向上にもつながりますので、積極的に利用するとよいでしょう。

[^2]: <https://www.w3.org/TR/WCAG21/#identify-input-purpose>

[^3]: H98: Using HTML 5.2 autocomplete attributes <https://www.w3.org/WAI/WCAG21/Techniques/html/H98> なお、本書で述べていますが、HTML 5.2は廃止された仕様です。
<!-- /a11y note -->
