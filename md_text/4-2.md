<!-- ch4-2.txt (8ページ、3000～4600字x2想定) -->

# WAI-ARIA

HTMLで利用できる属性の中には、HTML仕様とはべつの文書で定義されているものもあります。近年よく利用されるもののひとつに、WAI-ARIAがあります。ここでは、ウェブサイトやウェブアプリケーションのウェブアクセシビリティの向上に寄与するWAI-ARIAという技術と、そこで定義されている属性について説明します。

## WAI-ARIAとは何か

WAI-ARIA[^1]とは、W3Cによって発行されている仕様の名称で、単にARIAとも呼ばれます。WAI-ARIAのWAIとは、Web Accessibility Initiativeの略称であり[^2]、W3C内部に存在するウェブアクセシビリティを推進する組織です[^3]。ARIAとは、Accessible Rich Internet Applicationsの略称です。

[^1]: https://www.w3.org/TR/wai-aria/

[^2]: WAIの発音は「ワイ」であったり「ウェイ」であったりと、英語圏でも一定ではないようです。

[^3]: https://www.w3.org/WAI/

ここでの "Rich" は、表現が豊かであるという意味ですが、端的にはクライアント側で動的な処理を行うことを指します。かつてのウェブアプリケーションは、静的HTMLのフォームからデータを送信してサーバー側で処理することが一般的でした。その後、ブラウザーの表現力の向上に伴い、動的に変化するコンテンツや、複雑なユーザーインターフェイスを実現できるようになりました。これらは、従来のものより豊かな表現であるという意味で「リッチアプリケーション」と呼ばれました。

このようなリッチなアプリケーションは、しばしばアクセシビリティ上の問題を抱えることがあります。HTMLが元々用意しているフォームコントロールと異なり、リッチなインターフェイスは、スクリーンリーダーなどの支援技術を使っているユーザーに対して、十分な情報を提供できない場合があります。そのような場合に、HTMLと併用してWAI-ARIAを使うと、ユーザーの理解を助けることができるのです。

## WAI-ARIAの概要

WAI-ARIAは単独で使われるものではなく、別のマークアッブ言語と組み合わせ、それを補助する形で利用します。組み合わせるマークアップ言語のことを「ホスト言語」(host language)と呼びます。ホスト言語はHTML以外にもあり、たとえばSVGがホスト言語になることもあります。とはいえ、ウェブにおいては、HTMLがホスト言語になることがほとんどです。

WAI-ARIAは、ホスト言語の要素に追加で指定できる属性を定義しています。WAI-ARIAが定義する属性を「WAI-ARIA属性」(WAI-ARIA attribute)、もしくは単に「ARIA属性」(ARIA attribute)と呼びます。ARIA属性を利用すると、ホスト言語の要素に対して追加の情報を与えることができます。

ARIA属性の機能は、その性質によって「ロール」(role)、「プロパティ」(property)、「ステート」(state)の3種類に分類されます。

### ロール

ロールとは要素の役割を表すもので、この要素が何であるのか、何をするものかという情報を与えます。要素にロールを定義する際は、`role`属性を使用します。

たとえば、`div`要素に`role="navigation"`を指定すると、HTMLの`nav`要素と同じようなナビゲーションのセマンティクスを持つことを示せます。ロールの中には、`role="search"`のように、HTMLの要素だけでは表現できないものもあります。

### プロパティ

プロパティは、要素に対し、性質や特性などの情報を表現するものです。要素のプロパティを定義するARIA属性には、`aria-`で始まる名前がつけられています。

たとえば、`aria-required="true"`は、指定されたフォームの要素が必須であることを伝えます（HTMLの`required`属性と同じセマンティクスを持ちます）。`aria-label`属性のように、要素に対して追加の説明を与えるものや、`aria-controls`属性のように、他の要素との関連性を示すものもあります。

### ステート

ステートは、要素の現在の状態を表すものです。ステートを定義するARIA属性にも、`aria-`で始まる名前がつけられています。プロパティとステートの役割はほとんど同じですが、ステートは主に頻繁に変化することが想定されるものを表します。主にJavaScriptからの操作によって設定・変更され、現時点でのその要素の状態を表します。

たとえば、`aria-disabled="true"`は、指定された要素が現在無効になっていることを伝えますし、`aria-expanded`属性は、指定された要素と関連する要素が開・閉どちらの状態になっているのかを伝えます。

プロパティとステートの違いはそこまで厳密なものではありません。プロパティが頻繁に変更されたり、ステートが変更されずに使われることもあります。たとえば、`aria-valuenow`プロパティは範囲を示すコントロールの現在値を示すもので、頻繁に変化する可能性があります。`aria-hidden`ステートは要素を支援技術から隠すものですが、頻繁には変更されないような使われ方が主流です。

<!--プロパティとステートの中には特定のロールの要素に対してしか指定できないものがある、を書くか?最後まで見てから決める-->

### ホスト言語のセマンティクスの上書き

WAI-ARIAではホスト言語に性質などの情報を追加しますが、ホスト言語の要素が元々持っている性質と機能が重複する場合があります。たとえば、HTMLでは`h1`要素は見出し、`button`要素はボタンという役割を持ちますが、これらの役割は、WAI-ARIAの`role`属性で指定することもできます。

ARIA属性で明示的にロールを指定すると、ホスト言語の元のロールは上書きされ、変更されます。以下は、`button`要素のロールを"button"から"link"に変更する例です。

<!-- 適切な例 -->
```html
<button role="link">リンクとして機能するボタン</button>
```

このようにするとロールは上書きされ、支援技術にはこの要素がボタンではなく、リンクであると伝わるようになります。しかし、いかなるロールでも自由に上書きできるわけではありません。以下は適切でない例です。

<!-- 適切でない例 -->
```html
<button role="heading">見出し?</button>
```
<!--
Nu HTML Checkerは以下のようなエラーを出す
>Error: Bad value heading for attribute role on element button.
-->

`button`要素をボタンではなく見出しにしようとしています。この場合、この要素のボタンとしての機能はどうなるのでしょうか。少なくとも、支援技術の利用者には、これがボタンであるとは伝わらなくなります。このような指定をしてしまうと、要素の機能について混乱を招くことになります。
<!--
文法エラーになるのだが、現実のブラウザの挙動としては、普通にボタンの機能が残り、かつrole=headingも適用する。押せるのだが支援技術にはボタンではなく見出しと通知される要素が出来上がる。
Chrome/firefoxで確認。
-->

このように、ホスト言語の元のロールと矛盾するようなロールは指定できません。同様の理由で、プロパティ、ステートについても適用できるものとできないものがあります。

## WAI-ARIAと周辺仕様

先に述べたように、要素に対して指定できるARIA属性は限定されている場合があります。では、具体的にどの要素とどのARIA属性をを組み合わせることができるのでしょうか。

WAI-ARIA仕様自身は、基本的にはロール、プロパティ、ステートを定義するものであり、HTMLの要素との関係性までは規定していません。HTMLの要素との組み合わせは、ARIA in HTML[^4]という別の仕様で定義されています。3つの仕様の関係を図示すると次のようになります。

[^4]: https://www.w3.org/TR/html-aria/

![WAI-ARIA、ARIA in HTML、HTMLの関係図](../img/4-2-01.png)
図 4-2-1 WAI-ARIA、ARIA in HTML、HTMLの関係

ARIA in HTMLは雲合わせのルールを規定しているだけで、実際の使い方までは説明していません。使い方のガイドとしては、Using ARIA[^11]というW3Cのワーキンググループノートがあります。

[^11]: https://www.w3.org/TR/using-aria/

Using ARIAには使用例も出ていますが、コード例はあくまで簡単なものにとどまりますので、カルーセルやモーダルダイアログといった本格的なウィジェットをデザインするには不十分かもしれません。そういった本格的な使用例はまた別の文書にまとめられており、WAI-ARIA Authoring Practices[^5]というW3Cのワーキンググループノートとなっています。こちらではコード例はもちろん、実際に動作を見ることのできるサンプルも用意されています。

[^5]: https://www.w3.org/TR/wai-aria-practices/

その他、ブラウザーや支援技術の開発者向けの仕様として、Core Accessibility API Mappings[^6]やHTML Accessibility API Mappings[^7]というプラットフォームAPIとの対応を示した仕様や、Accessible Name and Description Computation[^8]というアクセシブルな名前や説明などの優先順位を決める仕様が、WAI-ARIAスイートとして位置づけられています。

[^6]: https://www.w3.org/TR/core-aam/

[^7]: https://www.w3.org/TR/html-aam/

[^8]: https://www.w3.org/TR/accname/

さらに、WAI-ARIA仕様の拡張として、EPUBのためのDPUB-ARIA[^9]、SVGのためのSVG Accessibility API Mappings[^10]というような仕様もあります。

[^9]: Digital Publishing WAI-ARIA Module https://www.w3.org/TR/dpub-aria/

[^10]: https://www.w3.org/TR/svg-aam/

なお、JavaScriptからアクセスする際に利用するIDLインターフェイスについては、WAI-ARIA 1.2以降、WAI-ARIA仕様本体で定義されるようになりました。

## ARIAの基本、5つのルール

具体的にどのような方針でARIAをHTMLで使用すればよいのでしょうか。前節で紹介したUsing ARIAでは、ARIAの利用方法の指針を示す5つのルールが挙げられています。この5つのルールについて、順を追って説明します。

<!-- 参考訳：Using WAI-ARIA in HTML（日本語訳）https://imagedrive.github.io/spec/using_wai-aria_in_html.xhtml -->

<!--1～5はままコピーあり-->
### ARIAルール1. HTML自身に備わっている機能を利用する

HTMLに元々備わっているネイティブな機能でARIAと同等の表現ができる場合、HTMLの機能を使用します。

たとえば、ARIAを用いて`div`要素などに見出しのロールを与えるのではなく、HTMLの見出し要素を使います。

<!-- 望ましくない例 -->
```html
<div role="heading" aria-level="1">見出し</div>
```

<!-- 望ましい例 -->
```html
<h1>見出し</h1>
```

プロパティやステートも同様です。たとえば、チェックボックスに対して「チェックされている」という状態を表現したい場合、ARIAの`aria-checked`ではなくHTMLの`checked`を使います。

<!-- 望ましくない例 -->
```html
<input type="checkbox" aria-checked="true">
```

<!-- 望ましい例 -->
```html
<input type="checkbox" checked>
```

### ARIAルール2. ネイティブのセマンティックスをむやみに変更しない

HTMLの要素に元々備わっているネイティブなセマンティックスがある場合、それをむやみに変更してはなりません。たとえば、見出しをボタンとして押せるようにしたいとき、次のようなマークアップをしてはなりません。<!-- h1 role=buttonはそもそも不許可でNuでは文法エラーとなる。例としてよくないかも。後半にエラーにはならないが望ましくない例を追加した -->

<!--不適切な例-->
```html
<h1 role="button">見出しボタン</h1>
<!-- 見出し要素をボタンのセマンティクスに変更している -->
```

これはARIA in HTMLで不可とされている組み合わせです。次のように、見出しの中にボタンを入れることが適切です。

<!-- 望ましい例 -->
```html
<h1><button>見出しボタン</button></h1>
<!-- 見出し要素の内部にボタン要素を設置している -->
```

ARIA in HTMLで許されている組み合わせでも、不用意なセマンティクスの変更は望ましくありません。以下の例は許されており、文法エラーにはなりません。

<!-- 望ましくない例 -->
```html
<div role="tablist">
<h2 role="tab">見出しタブ</h2>
</div>
```

しかし、`h2`要素のロールを変更しているため、見出しとしてのセマンティクスが失われてしまいます。であることが伝わらなくなります。以下のようにするとよいでしょう。

<!-- 望ましい例 -->
```html
<div role="tablist">
<div role="tab"><h2>見出しタブ</h2></div>
</div>
```

### ARIAルール3. インタラクティブなコントロールはキーボード操作可能にする

HTMLには、ユーザーが操作可能なコントロールが多数ありますが、それらでは要件が満たせないこともあります。そんなときコンテンツ製作者は、JavaScriptを駆使して、オリジナルのウィジェットを作りだし、ARIAを使ってロールを与えることがあります。

このようなインタラクティブなコントロールを作成した場合、キーボードでも操作できるようにしなければなりません。ユーザーがクリック、タップ、ドラッグ、ドロップ、スライド、スクロールといった各種の操作を行える時、キーボードのみの環境でも同等の操作を実現できるようにする必要があります。

たとえば、以下のように`div`要素に`role=button`を指定すると、この要素はボタンとしてのセマンティクスを持ち、支援技術にはボタンであると伝えられます。ボタンを押した際の動作は`onclick`属性に記述したJavaScriptで実現しています。

```html
<div role="button" onclick="pushed()">素敵なボタン</div>
<script>
const pushed = () =>{
    alert('押されました'); // ボタンを押された時の処理
}
</script>
```

この`div`ボタンはマウスでクリックすると動作し、一見すると問題ないように見えるかもしれませんが、以下のような機能がありません。

- キーボードの<kbd>Tab</kbd>キーでフォーカスを当てる
- キーボードの<kbd>Enter</kbd>キー、<kbd>Return</kbd>キー、<kbd>space</kbd>キーでボタンを押す

つまりキーボード操作をすることができません。このような場合には、キーボード操作に対応する機能を明示的に実装する必要があります (ルールその1に従ってHTMLの`button`要素を用いれば、これらの機能はネイティブの機能として提供されることになります)。

### ARIAルール4. フォーカス可能な要素を隠さない

要素に`aria-hidden="true"`を指定すると、支援技術からその要素を隠すことができます。その要素は、視覚環境では表示され、しかしスクリーンリーダーでは読まれなくなります。

フォーカス可能な要素に`aria-hidden="true"`を指定した場合、不都合が起きます。その要素は支援技術には「見えない」のですが、視覚環境では表示されており、フォーカスは当たります。支援技術の利用者の場合、見えない要素にフォーカスが当たり、フォーカスを見失ってしまいます。

<!-- 望ましくない例 -->
```html
<button aria-hidden="true">支援技術に「見えない」がフォーカスは当たるボタン</button>
```
<!--
Using ARIAでは `role="presentation"でも問題が起きるとなっているが、削除した。

ブラウザで実際に試してみると、どうもbuttonにrole="presentation"が指定できないようだ。指定してもComputed roleがbuttonのまま。
ARIA仕様では以下のように、フォーカス可能要素のpresentationロール指定を無視しなければならない (MUST) と規定されている。

https://w3c.github.io/aria/#conflict_resolution_presentation_none
>If an element is focusable, or otherwise interactive, user agents MUST ignore the presentation role and expose the element with its implicit role, in order to ensure that the element is operable.

仮に role="presentation" が有効になったとしても、支援技術からこの要素そのものが隠されるわけではなく、<span tabindex="0"> と同じような扱いになるだけで、どういう問題があるというのかよくわからなかった。
もしかすると、Using ARIAの著者は role="presentation" の効果を勘違いしているのではないか?
いったん role="presentation" に関する記述は削除して、このコメントを残しておく。
-->

なお、フォーカスが当たらなければ問題はおきません。視覚環境も含めた全ての環境から要素を隠したり、無効にするなどしてフォーカスが当たらないようにすれば問題を回避できます。以下はこの問題が起きない例です。

<!-- 問題のない例 -->
```html
<button hidden>全ての環境から隠されたボタン</button>
<button aria-hidden="true" disabled>無効のボタン</button>
<button aria-hidden="true" tabindex="-1">フォーカスの当たらないボタン</button>
```

### ARIAルール5. インタラクティブな要素にアクセシブルな名前を持たせる

インタラクティブな要素には、「アクセシブルな名前」（accessible name）をつけなければなりません（詳細は後述します）。以下は不適切な例です。

<!-- 不適切な例 -->
```html
<span>ユーザー名</span>
<input type="text">
```

入力欄の隣にテキストがあり、視覚環境であれば、この入力欄に「ユーザー名」を入れれば良いことがわかるかもしれません。しかし、このテキストは`input`要素と関連づけられておらず、アクセシブルな名前を持っているとは言えません。スクリーンリーダーの利用者が入力欄にフォーカスした場合、「テキスト入力」などと読まれるだけで、何を入力すれば良いのかわからないことがあります。

次のように`label`要素としてマークアップし、`input`要素に関連づけることで、この入力欄に「ユーザー名」というアクセシブルな名前を与えることができます。

<!-- 望ましい例 -->
```html
<label>ユーザー名
<input type="text"></label>

<label for="uname">ユーザー名</label>
<input type="text" id="uname">
```

このようにすると、入力欄にフォーカスした際に「ユーザー名 テキスト入力」のように読まれ、何を入力するのかがわかります。

アクセシブルな名前を与える方法はいくつかあり、`title`属性やARIAのプロパティを使用する方法もあります。

<!-- 問題ない例 -->
```html
<input type="text" title="検索">

<input type="text" aria-label="検索">

<span id="search-label">検索</span>
<input type="text" aria-labelledby="search-label">
```

ヘッダの検索フォームなど、可視のラベルを用意することが難しいケースでは、属性を利用しても良いでしょう。

## ARIAのロールと分類

執筆時点で最新のW3C勧告であるWAI-ARIA 1.1では、全部で81のロールが定義されています。ARIA仕様の"5.3 Categorization of Roles"[^1]では、ARIAロールを6つの観点から分類しています。

[^1]: <https://www.w3.org/TR/wai-aria-1.1/#roles_categorization>

### 抽象ロール

ARIAのロールには継承、派生の関係があります。これは、オブジェクト指向プログラミング言語におけるクラスの継承と同じ概念です。同様に「抽象」(abstract)の概念もあります。抽象ロールは、他のロールの上位概念を定義するためのロールで、実際にコンテンツ内で使うことはできないものです。

逆に、実際にコンテンツ内で使えるロールは「具象」(concrete)ロールと呼びます。[^1]

[^1]: もっとも、この呼称はマイナーで、ARIA仕様内では 7.1 Role Attribute で concrete WAI-ARIA role として使われている一度きりしか出てきません。

ARIAのロールの継承関係は、基底(base)ロールである`roletype`ロールから始まります。他のロールはすべて`roletype`から派生します。`roletype`ロールからは以下の3つのロールが派生します。

- structure
- widget
- window

この3つは全て抽象ロールです。他のARIAロールは、この3つのいずれかから派生します。つまり、全てのロールは上記3つのいずれかに分類できるということです。

これら3つからは、直接に具象ロールが派生することもありますし、さらに抽象ロールが派生することもあります。以下の8つは抽象ロールです。

- command
- composite
- input
- landmark
- range
- section
- sectionhead
- select

ARIA仕様の"5.3 Categorization of Roles"では、ロールの派生関係のすべてを図で見ることもできます。

### 文書構造ロール

`structure`抽象ロールから派生したロールのうち、特別な機能を持たないもの (後述するランドマークロール、ライブリージョンに該当しないもの) を「文書構造」(Document Structure)ロールと呼びます。これは主に、ページ内のコンテンツの構造を説明するものです。基本的には静的なものであり、ユーザーの操作に反応することはありません。

`structure`抽象ロールからは以下の8つのロールが派生します。

- application
- document
- presentation, none
- rowgroup
- separator
- section (抽象ロール)
- sectionhead (抽象ロール)

`section`抽象ロールからは`list`ロール、`table`ロールなどが派生し、`sectionhead`抽象ロールからは`heading`ロールなどが派生します。全部で26の具象ロールが文書構造ロールに属します。
<!--
application
article
cell
columnheader
definition
directory
document
feed
figure
group
heading
img
list
listitem
math
none
note
presentation
row
rowgroup
rowheader
separator (when not focusable)
table
term
toolbar
tooltip
-->
`section`が抽象ロールであることに注意してください。HTMLの`section`要素に相当するのは`region`ロールのほうです。`region`ロールは`structure`>`section`>`landmark`>`region`という派生関係にあり、後述のランドマークロールに属します。

### ウィジェットロール

`widget`抽象ロールから派生したロールをウィジェットロールと呼びます。ユーザーインターフェイスウィジェットとして機能するものであり、ユーザーの操作に反応するインタラクティブなものです。

`widget`抽象ロールからは以下の8つのロールが派生します。

- command (抽象ロール)
- composite (抽象ロール)
- gridcell
- input (抽象ロール)
- range (抽象ロール)
- row
- separator
- tab

`command`抽象ロールからは`button`などが、`input`抽象ロールからは`textbox`ロールなどが派生し、全部で29の具象ロールがウィジェットロールに属します。
<!--
button
checkbox
gridcell
link
menuitem
menuitemcheckbox
menuitemradio
option
progressbar
radio
scrollbar
searchbox
separator (when focusable)
slider
spinbutton
switch
tab
tabpanel
textbox
treeitem
-->
なお、`composite`抽象ロールから派生するものは、単独で機能するものではなく、他の要素を制御したり、他の要素のコンテナとなるものです。`combobox`や`tablist`などが該当します。

### ウィンドウロール

`window`抽象ロールから派生したロールをウィンドウロールと呼びます。ブラウザー内やアプリケーション内において、サブウィンドウやモーダルダイアログとして機能するものです。以下の2つが派生します。

- `alertdialog`
- `dialog`

これらはいずれも具象ロールです。

### ランドマークロール

`landmark`抽象ロールから派生するロールを、ランドマークロールと呼びます。ランドマークロールはその名の通り、ナビゲーションの際のランドマークとして機能するものです。支援技術の多くは、ランドマークを利用したナビゲーションの機能を持ちます。ユーザーの操作に大きく影響する重要なロールであると言えます。

以下の8つがランドマークロールです。

- banner
- complementary
- contentinfo
- form
- main
- navigation
- region
- search

`landmark`抽象ロールは、`structure`>`section`>`landmark`という派生関係にあり、これらは`structure`の派生ロールでもあります。分類の仕方によっては文書構造ロールに分類されることもあります。

### ライブリージョンロール

ライブリージョンとは、内容が更新された際にユーザーに通知される領域です。支援技術のユーザーが特定の場所を読んでいる際、他の場所がリアルタイムで更新されても、その更新に気づかないことがあります。更新される領域をライブリージョンとして定義しておくと、更新された際にユーザーに通知されるため、他の場所を読んでいても更新に気づくことができます。

リアルタイムに更新され、かつユーザーに気付いて欲しい箇所に使用します。たとえば、株価の表示、ゲームのスコア表示、緊急性の高いエラーメッセージなどに用いることが考えられます。

ライブリージョンロールは、以下の5つです。

- alert
- log
- marquee
- status
- timer

これらは`section`から派生しており、`structure`の派生ロールでもあります。分類の仕方によっては文書構造ロールに分類されることもあります。


## ネイティブセマンティクスについて

ここで、WAI-ARIAから少しだけ離れて、HTMLの話をしましょう。

本書でこれまでに説明してきたように、HTMLの要素はHTML仕様で定義されたセマンティクスを持ちます。これは例えば、`h1`要素であればランク1の見出しを表し、`main`要素であれば主要なコンテンツを表すというものです。このように、HTML自身がもつ要素の意味を、WAI-ARIAではホスト言語のセマンティクスやネイティブセマンティクスなどと呼びます[^14]。

[^14]: やや曖昧に書いているのは、明確に用語として定義されていない、という事情によります。

一方で、WAI-ARIAはロールでセマンティクスを表すことができます。例えば、`heading`ロールであれば見出しを、`main`ロールであれば文書の主要なコンテンツを表します。

言い換えると、`h1`要素と`heading`ロール、`main`要素と`main`ロールは、ホスト言語であるHTMLのネイティブセマンティクスと、WAI-ARIAのセマンティクスで同じ意味を示すことになります。

```
<div role="main">主要なコンテンツ…</div><!-- WAI-ARIAのセマンティクスによる表現 -->
<main>主要なコンテンツ...</div><!-- HTMLのネイティブセマンティクスによる表現 -->
```

ところで、ネイティブセマンティクスとWAI-ARIAのセマンティクスとを同時に使用することで、セマンティクスが冗長になるという状況が起こりえます。このような状況において、ホスト言語の機能が暗黙のWAI-ARIAセマンティクスを持つと呼びます。

ここで、ARIAの使い方で示した「ARIAルール1. HTML自身に備わっている機能を利用する」を思い出してください。これは、暗黙のWAI-ARIAセマンティクスを持ったHTMLについては、わざわざARIAを使うことなくHTMLネイティブの機能を使用するように求めている、と言い換えることができます。つまり、HTMLコードで説明すると次のようになります。

```
<div role="main">主要なコンテンツ…</div><!-- このようなWAI-ARIAのセマンティクスを使用すべきでなく -->
<main>主要なコンテンツ...</main><!-- HTMLのネイティブセマンティクスのみで表現すべき -->
<main role="main">主要なコンテンツ...</main><!-- これは冗長なだけ -->
```

これは、WAI-ARIAの用法が制限されるということになります。つまり、原則としてHTMLにネイティブセマンティクスが存在しない、または既存のウェブサイトでCSSやJavaScriptとの関係性のために要素を書き換えることができない場合に限って、ARIAロールでセマンティクスを表現すべき、ということになります。

このARIAセマンティクスとHTMLのネイティブセマンティクスの関係を規定しているのが、ARIA in HTML仕様になります。ARIA in HTMLを参照することで、利用しようとしているARIAセマンティクスが既にHTMLネイティブに存在するかどうかを確かめることができます。


### ロール`presentation`と`none`について

ほとんどのARIAロールはなんらかのセマンティクスを与えますが、ロール`presentation`と`none`は他のロールとは異なり、セマンティクスを打ち消す働きをします。

`presentation`と`none`は同じ働きをします。同じものが2つある理由としては、`role="presentation"`が`aria-hidden="true"`と同一の働きをすると誤解する人が多かったために[^15]、後からより意味が明確である`role="none"`が追加されたという経緯によります。`none`が十分にサポートされない間は、`role="none presentation"`と同時に使用するのが勧められます。

[^15]: `aria-hidden="true"`は、要素をアクセシビリティAPIから隠します。

さて、このロール`presentation`と`none`の使いどころですが、古いウェブページにおいて、純粋に装飾的な画像（いわゆるスペーサー画像）に対して、またはいわゆるテーブルレイアウト（CSSのブラウザーサポートが貧弱だった時代に、`table`要素を用いてページレイアウトを実現する手法）に対して利用するというシーンを挙げることができます。その要素が画像であったり、表であったりという意味を打ち消すことによって、単なる見栄えのための要素であることを明示できます。

```
<img alt="" src="spacer.png" role="presentation none"><!-- 純粋に装飾的であることをARIAロールで補強 -->
```

`img`要素にロール`presentation`と`none`を使用する場合、`alt`属性の値は空である必要があります。（代替テキストを持つ画像であれば、その画像に意味があることになりますから、`presentation`や`none`と意味が矛盾してしまうためです。）

テーブルに対して使用する場合、`table`要素に`role="none presentation"`を指定すれば、子孫の要素に継承されます。ただし、入れ子になった`table`には継承されません。

```
<table role="none presentation">
<tr>
<td><abbr>W3C</abbr> 
<tr>
</table>
```
<!--  https://www.w3.org/TR/using-aria/#ariapresentation にある画像と似たようなものを張って付けておく-->

## プロパティとステートについて

プロパティとステートは似た性質を持つこともあり、ARIA仕様では一括りにして扱われています。プロパティとステートは、ウィジェット属性、ライブ領域属性、ドラッグアンドドロップ属性、関係属性の4つに分類されています。

- ウィジェット属性。ユーザー入力などの動作を受け取るGUIシステム上や、リッチなインターネットアプリケーションに見られるユーザーインターフェイス要素に固有の属性が分類されます。ラベル付けのために使用される`aria-label`属性のような、HTMLのフォームに関連する24の属性が含まれます。
- ライブ領域属性。ライブ領域ロールでも説明したように、ライブ領域は、リアルタイムの株価更新や、チャットのログなどが例として挙げられるものです。要素が更新されることを示す`aria-live`属性などの4つの属性が含まれます。
- ドラッグアンドドロップ属性。ドラッグアンドドロップのインターフェイス要素に関する情報を示す属性です。`aria-dropeffect`属性と`aria-grabbed`属性の2つが含まれます。
- 関係属性。文書構造から単純に決定できない要素間の関係や関連性を示す属性です。列をカウントする`aria-colcount`属性などの16の属性が含まれます。

## アクセシブルな名前について

前述しているARIAの使い方のARIAルール5.にあるアクセシブルな名前（accessible name）について、少し掘り下げてみます。これは、Accessible Name and Description Computation仕様にも定義されているように、簡潔に言えばユーザーインターフェイスの名前です。


この名前はアクセシビリティAPIを通して公開されるものです。スクリーンリーダーなどの支援技術はアクセシビリティAPIを通してコンテンツにアクセスするため、適切なアクセシブルな名前を付ける必要があります。

ARIAルール5.の再掲になりますが、ある入力欄がユーザー名であることを支援技術に伝えるには、例えば次のようにラベル付けするだけで十分です。

```
<label>ユーザー名 <input type="text"></label>
```

言い換えるならば、HTML標準に定められた要素を用いる限りでは、アクセシブルな名前について特段意識する必要はありません。

### どのような要素やARIA属性がアクセシブルな名前を与えるのか

正確な名前の決定方法については、Accessible Name and Description Computation仕様に定義されていますが、大まかに言ってしまえば、

- `aria-labelledby`属性
- `aria-label`属性
- `title`属性、`alt`属性、`label`要素などのHTMLネイティブの要素・属性

で与えることできます。優先順位としては`aria-labelledby`属性が最も高く、次に`aria-label`属性、その次にHTMLネイティブの要素・属性の順になります。

`aria-labelledby`属性と`aria-label`属性が同時に指定される場合、`aria-labelledby`属性が優先され`aria-label`属性は無視されます。

`aria-label`属性と`aria-labelledby`属性はどちらもアクセシブルな名前を与えますが、どのようなものなかについては、次に説明します。

#### `aria-labelledby`属性

`aria-labelledby`属性は、現在の要素のラベル付けする要素を特定するものです。HTMLの`label`要素に似た働きをしますが、`label`要素とは逆方向のラベル付けをします。

属性値は別の要素に付けられた`id`属性の値（複数の場合はスペース区切り）です。つまり、次のコード例のように2つ以上の要素を連結させることもできます。

```
<div id="billing">請求書</div>

<div>
    <div id="name">名前</div>
    <input type="text" aria-labelledby="billing name"/>
</div>
<div>
    <div id="address">住所</div>
    <input type="text" aria-labelledby="billing address"/>
</div>
```

1つ目の`input`要素は「請求書 名前」、2つ目の`input`要素は「請求書 住所」とラベル付けされます。

#### `aria-label`属性

`aria-label`属性は、現在の要素のラベル付けする文字列を定義するものです。HTMLの`title`属性に似たコンセプトを持ちます。

使用例としては、次のコード例のような、単に「X」とだけ記載されているようなボタンが挙げられます。「ダイアログを閉じる」というボタンの目的を示すものは何もないので、`aria-label`属性が支援技術にラベルを知らせる目的で使用されます。

```
<button aria-label="閉じる" onclick="myDialog.close()">X</button>
```

WAI-ARIA仕様に記述されているように、画面上で可視のテキストとして表現できるラベルである場合、`aria-label`属性を使用すべきではありません。属性値であるため、画面上に何も表示されないことに注意します。あくまで、可視のラベルや可視のツールチップが望ましくないケースでこの属性の使用を検討します。



<!-- 真偽値属性の使い方について書く -->