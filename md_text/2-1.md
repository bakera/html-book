<!--
知識編 2章 HTMLマークアップのルール
2-1. 開始タグと終了タグ
4p
-->

# HTMLの要素とタグの基本

Chapter1では、HTMLがマークアップ言語であることを説明しました。ここでは、HTMLの基本的な構文について説明していきます。

## 要素とタグ

マークアップとは、テキストにマークを付けて意味や構造を明確にすることです。HTMLは、テキストデータと、それに対するマークから成り立っています。

Chapter1-2では以下のようなテキストの例を示しました。

```text
これは見出しのテキストのかたまりです
これは本文です。このキーワードはこの文章で重要なものを表します。
```

このテキストには、見出し、本文、そしてキーワードが含まれています。別の言い方をすれば、「見出し」、「本文」、「キーワード」という一連の意味を持ったまとまりが存在することになります。Chapter1で触れたように、HTMLでは、こういったまとまりを「要素」(element)と呼んでいます。

マークアップ言語の役割は、要素を明示することです。要素を明示するには、以下の2つの情報が必要になります。

- 要素の種類。それがどのような要素なのか
- 要素の範囲。どこからどこまでがその要素になるのか

HTMLでは、この情報を「タグ」(tag)と呼ばれるマークを使って表現します。先ほどの例にHTMLのタグを付け加えると、以下のようになります。

```html
<h1>これは見出しのテキストのかたまりです</h1>
<p>これは本文です。</p>
<p>この<mark>キーワード</mark>はこの文章で重要なものを表します。</p>
```

`<`と`>`で囲まれた部分がHTMLのタグです。最初の行は見出しですが、先頭に`<h1>`のタグを、末尾に`</h1>`のタグを入れています。このように、要素の開始位置と終了位置にタグを入れることで、要素の種類とその範囲を明らかにします。

### 開始タグと終了タグ

要素の開始位置を表わすタグを「開始タグ」(start tag)と呼びます。開始タグは`<`（U+003C、不等号より小）で始まり、`>`（U+003E、不等号より大）で終わります。`h1`と書かれている部分は「タグ名」(tag name)と呼ばれ、要素の名前である「要素名」(element name)を表わしています。

要素の終了位置を表わすタグを「終了タグ」(end tag)と呼びます。終了タグは、開始タグと区別するために`</`で始まります。`</`の後にタグ名が続き、`>`で終わる点は開始タグと同様です。

また、タグを除いた要素の中身の部分を、要素の「内容」(content)[^1]と呼びます。

[^1]: 日本語に訳さず、コンテントやコンテンツと呼ばれることもあります。

もう一度、さきほどのマークアップを見てみましょう。

```html
<h1>これは見出しのテキストのかたまりです</h1>
<p>これは本文です。</p>
<p>この<mark>キーワード</mark>はこの文章で重要なものを表します。</p>
```

1行目には、開始タグ`<h1>`と終了タグ`</h1>`があります。この部分全体が要素名`h1`の要素となります。この`h1`要素の内容は、「これは見出しのテキストのかたまりです」というテキストです。

2行目は開始タグ`<p>`と終了タグ`</p>`でマークアップされ、`p`要素であることを表わしています。要素の内容は「これは本文です。」というテキストです。

3行目は少し複雑です。2行目と同じように`p`要素としてマークアップされていますが、要素の内容は単純なテキストではありません。この要素の中にはさらに`<mark>`と`</mark>`というタグがあります。

`p`要素の内容には、テキストだけでなく、`mark`要素も入っている形になります。

### 終了タグの省略

原則として、開始タグと終了タグは対で存在しますが、終了タグは省略できる場合があります。

終了タグの省略の可否は要素によって異なります。何度か出てきた`p`要素は、特定の条件下で終了タグが省略できます。先の例は以下のように書くこともできます。

```html
<p>ある<mark>長いキーワード</mark>
<p><mark>キーワードの続き</mark>はこの文章で重要なものを表します。
```

`</p>`が書かれていませんが、これは、以下のようにブラウザーに補われて解釈されます。

```html
<p>ある<mark>長いキーワード</mark></p>
<p><mark>キーワードの続き</mark>はこの文章で重要なものを表します。</p>
```

ある要素の終了タグが省略できるかどうか、省略できるのはどのような場合かは、仕様書の各要素の説明に書かれています。たとえば、`mark`要素[^2]の場合は、以下のように書かれています。

[^2]: 4.5.23 The mark element <https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-mark-element>

> Tag omission in text/html:
> Neither tag is omissible.

これは、開始タグも終了タグも省略できないという意味です。一方、`p`要素[^3]の場合は、以下のような記述があります。

[^3]: 4.4.1 The p element <https://html.spec.whatwg.org/multipage/grouping-content.html#the-p-element>

> Tag omission in text/html:
> A p element's end tag can be omitted if the p element is immediately followed by an address, article, aside, blockquote, details, div, dl, fieldset, figcaption, figure, footer, form, h1, h2, h3, h4, h5, h6, header, hgroup, hr, main, menu, nav, ol, p, pre, section, table, or ul element, or if there is no more content in the parent element and the parent element is an HTML element that is not an a, audio, del, ins, map, noscript, or video element, or an autonomous custom element.
<!-- > p要素がaddress、article、aside、blockquote、details、div、dl、fieldset、figcaption、figure、footer、form、h1、h2、h3、h4、h5、h6、header、hgroup、hr、main、menu、nav、ol、p、pre、section、table、ul要素の直後に存在する場合、または親要素で追加のコンテンツが存在せずかつ親要素がa、audio、del、ins、map、noscript、video要素、または自律カスタム要素でないHTML要素である場合、p要素の終了タグは省略することができる。-->

こちらは一定の場合に終了タグを省略できることがわかります。他には、`li`要素、`dt`要素、`dd`要素、`tr`要素、`th`要素、`td`要素、`caption`要素、`thead`要素、`tbody`要素、`tfoot`要素、`option`要素、`rp`要素、`rt`要素などの終了タグが省略可能とされています。

このように終了タグは省略することができますが、本書のコード例では終了タグを省略せずに記載しています。また、HTMLコードのメンテナンス性からも、終了タグを省略せずに記載することが望ましいと考えます。

### 終了タグを持たない要素

終了タグの省略について説明しましたが、そもそも終了タグを持たない要素もあります。HTMLの要素の多くは、テキストもしくは子要素を含んでいますが、中には内容を全く含まない要素もあります。

たとえば、`br`要素は改行を指定する要素で、その位置で改行されることが期待されます。以下は、`br`要素を使った例です。

```html
<p>詩などの<br>文章では<br>改行位置が<br>重要になることもあります。</p>
```

`br`要素はその性質上、その中にテキストや他の要素を含むことはありません。このように、内容を一切持つことのない要素を「空要素」(void element)と呼びます。

空要素には終了タグを書いてはなりません。以下は正しくない例です。

```html
<p>詩などの<br></br>文章では<br></br>改行位置が<br></br>重要になることもあります。</p>
```

このように書いた場合、`</br>`は不正なマークアップとしてエラーになります。そしてエラー処理の結果、そこに`<br>`が書かれているものとして扱われます。つまり、`<br></br>`と書くと`<br>`を2つ書いた場合と同じ動作になります。

なお、どの要素が空要素なのかは決まっています。空要素ではない要素について、内容が結果的に空になることがありますが、その場合は終了タグを書く必要があります。詳しくは2-4「要素の入れ子と内容モデル」で説明します。

### 開始タグの省略

要素によっては、終了タグだけでなく、開始タグも省略できる場合があります。具体的には、`html`要素、`head`要素、`body`要素、`tbody`要素が該当します。以下はタグを省略して書いた例です。

```html
<!DOCTYPE html>
<title>test</title>
<table>
<tr><th>見出し1<td>データ1
<tr><th>見出し2<td>データ2
</table>
```

`html`要素、`head`要素、`body`要素、`tbody`要素の開始タグが書かれていません。しかしこのマークアップはエラーではなく、以下のように解釈されます。

```html
<!DOCTYPE html>
<html>
<head>
    <title>test</title>
</head>
<body>
<table>
    <tbody>
        <tr>
            <th>見出し1</th>
            <td>データ1</td>
        </tr>
        <tr>
            <th>見出し2</th>
            <td>データ2</td>
        </tr>
    </tbody>
</table>
</body>
</html>
```

このように、タグを一切書かなくても要素が存在する場合があります。とはいえ、HTMLのソースコードを読んだ際に分かりにくく、挙動が予想しにくくなることがあるため、ほとんどの場合において開始タグの省略はしません。

### 要素の入れ子

ところで、ある要素の内部に別の要素が入っていることを「入れ子」(nest)と言います。ある要素の内部に別の要素を入れることを「入れ子にする」または「ネストする」と言います。

入れ子は多重にすることもできます。以下の例では、`body`要素の中に`p`要素が入れ子になり、その中にさらに`mark`要素が入れ子になっています。

```html
<body>
<p>この<mark>キーワード</mark>はこの文章で重要なものを表します。</p>
</body>
```

ある要素の中に入っている要素のことを、その要素の「子孫」(descendant)と言います。また、ある要素の直下にある要素を「子」(child, children)と言います。

逆に、ある要素のすぐ外側の要素を「親」(parent)、親の親なども含む外側の要素全般を「祖先」(ancestor)と言います。

上記の例では、`mark`要素は、`p`要素の子要素であり、子孫要素です。`mark`要素は、`body`要素の子要素ではありませんが、`body`要素の子孫要素です。

なお、ある要素の子要素になれる要素は決まっています。たとえば、`p`要素の中に`mark`要素を入れることはできますが、`mark`要素の中に`p`要素を入れることはできません。詳しくはChapter2-4の「要素の入れ子と内容モデル」で説明します。

#### 誤った入れ子とエラー処理

要素は、複数の要素にまたがることはできません。たとえば、以下のようにマークアップしたとします。

```html
<p>ある<mark>長いキーワード</p>
<p>キーワードの続き</mark>はこの文章で重要なものを表します。</p>
```

このようなマークアップは、誤った入れ子であるため、不正なものとしてエラーになります。実際には、ブラウザーはこのようなエラーに出会うと、マークアップを以下のように修正して解釈します。

```html
<p>ある<mark>長いキーワード</mark></p>
<p>キーワードの続きはこの文章で重要なものを表します。</p>
```

このようなエラー処理は要素によって異なります。上記の例で`mark`要素のかわりに`b`要素を使った場合、エラー処理により、以下のようになります。

```html
<p>ある<b>長いキーワード</b></p>
<p><b>キーワードの続き</b>はこの文章で重要なものを表します。</p>
```

## HTML文書とDOCTYPE

HTMLを扱う際は、1つの文書に含まれるテキスト全てをマークアップして扱うことが一般的です。このように、文書全体をHTMLとしてマークアップしたものを「HTML文書」(HTML document) と呼びます。

HTMLを文書全体としてではなく、一部分だけ切り出して扱うこともあります。たとえば、HTMLの部品を他の文書に埋め込むような想定のとき、部品の側はHTML文書全体ではなく、一部だけを含むものになります。このように切り出した一部分を「HTML断片」(HTML fragment) と呼びます。本書におけるHTMLの例示のほとんどは、HTML断片になります。

ここまで、タグを使って要素をマークアップする方法を説明してきましたが、HTML文書を完成させるためにはまだ必要なものがあります。

HTML文書の冒頭には、以下のようなマークを書く必要があります。これを「DOCTYPE」と呼びます。

```html
<!DOCTYPE html>
```

大文字・小文字は区別しないため、小文字で書くこともできます。

```html
<!doctype html>
```

DOCTYPEは、文書がHTML5で記述されていることを識別するためのものです。DOCTYPEが存在しない場合、HTML5ではない可能性が高いと判断され、quirks mode[^4]で処理されます。

[^4]: 日本語では互換モードや奇癖モードなどと呼ばれます。詳細はMDNの後方互換モードと標準準拠モードに譲ります。 <https://developer.mozilla.org/ja/docs/Web/HTML/Quirks_Mode_and_Standards_Mode>

### コラム：DOCTYPEの互換性と文書型宣言

DOCTYPEは「文書型宣言」(Document type declaration)と呼ばれることもあります。文書型宣言はSGMLの概念です。古いHTMLはSGMLのルールに従っていたため、文書型宣言が必須でした。HTML5はSGMLではなくなり、文書型宣言も不要となったのですが、ブラウザーの互換性のために、文書型宣言と似た形のDOCTYPEを書くことになっています。

現在のDOCTYPEの記述は、SGMLの文書型宣言として正当な形式ではありません。しかし、SGMLやXMLを出力するプログラム（XSLTプロセッサーなど）でHTMLを生成する際に、文書型宣言を省略したり変形したりできないこともあります。そのような場合に、SGMLの文書型宣言として正当な形式となる、以下のような記述も許されています。

```html
<!DOCTYPE html system "about:legacy-compat">
```

## 最低限のHTML文書

ここまでの説明で、ひとまずHTML文書を作成する準備が整いました。以下は、タグを一切省略していない最低限のHTML文書のサンプルです。

```html
<!DOCTYPE html>
<html>
<head>
<title>最低限のHTML</title>
</head>
<body>
<h1>最低限のHTML</h1>
<p>これはHTML文書です!</p>
</body>
</html>
```
