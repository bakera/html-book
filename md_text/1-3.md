<!-- ch1-3_test.txt.md (8ページ、6200～9400字想定) -->

# 適切なマークアップ
<!-- リード文 -->
実際にマークアップをするとき、どのようにマークアップすればよいのか迷う場面がしばしばあります。ここでは、適切なマークアップとは何かということと、その意義、メリットについて見ていきます。

## 適切なマークアップとは何か

「適切な」あるいは「正しい」マークアップとはどのようなものでしょうか。本書ではわかりやすさのために、3つの観点から説明します。その3つとは、字句的ルール、語彙的ルール、意味論的ルールです。

### 字句的ルール

先に説明した通り、HTMLは、テキストを機械にも理解しやすいようにしたものです。HTMLが利用される際は、プログラムがHTMLを読み取ることになります。HTMLを読み取って解析することを「パース」(parse)と言い、解析するプログラムを「パーサー」(parser)と言います。

パーサーがHTMLをパースするにあたり、HTMLがマークアップ言語のルールと照らし合わせて、文字単位で従っていることを求めるのが、字句的ルールとなります。

字句的ルールの主だったものを挙げますと、

- DOCTYPE宣言が“先頭に”記述されている
- タグのルールに従って要素と属性が記述されている
- 開始タグと終了タグは正しい入れ子構造になっている
- コメント（およびCDATAセクション）がルールに従って記述されている

といったものになります。Chapter1-2のマークアップ例をもとにした、字句的ルールの違反例を以下に挙げてみます。

```html
<h1>これは見出しの<strong>テキストのかたまりです</h1>
<p>これは本文です。このキーワード</strong>はこの文章で重要なものを表します。</p>
```

これは、`<strong>`のタグによる入れ子の構造が正しいものではありません。詳しいルールの説明については、Chapter2に譲ります。

### 語彙的ルール

マークアップ言語としての要件は字句的ルールで満たすことができますが、この状態ではHTMLとしての要件を満たしているとは言えません。HTMLであるためには、要素名や属性名、属性値がHTML仕様で定められたルールに語彙単位で形式的に従っていることが求められます。

これは言い換えると、パーサーが妥当なDOMツリーを生成するために必要な制約とも捉えることができます。

語彙的ルールの主だったものを挙げますと、

- 要素は、仕様に定められた要素名を持つものである
- ルート要素が`html`要素である
- 内容モデルの制約に従って、適切な親要素の中に入れられている
- 属性は、仕様に定められた属性名を持つものである
- 属性値が仕様によって限定される場合、その限定された属性値を用いている
- 要素と属性の組み合わせは、形式的に仕様に違反しない組み合わせになっている
- 仕様で定められた形式に従った要素の内容（コンテンツ）の記述が求められる場合、その形式に従っている

といったものになります。語彙的ルールの違反例としては、Chapter1-2で取り上げた`<見出し>`です。この名前はHTMLの仕様に沿ったものではないことは先に説明したとおりです。詳しいルールの説明については、主にChapter3で説明していきます。

### 意味論的ルール

HTMLが形式的に仕様に従っているだけでは、今日のHTML仕様を満たしているとは言えません。機械で判別できる語彙的ルールを超えて、人間が読んでも意味のあるマークアップになっていること、言い換えると文として意味をなす、矛盾がない状態であることが求められます。これが意味論的ルールです。

これは、マークアップする内容が人間が読んで意味があり、内容の構造としてマークアップできるものになっていることが暗黙の前提条件となります。逆説的ではありますが、そもそも内容がマークアップできないものであるならば、適切なマークアップは不可能である、とも言えます。

意味論的ルールの主だったものを挙げますと、

- 内容に基づいた、適切な意味づけとなっている要素を選択している
- 要素の出現順序は、機械および人間が読んで意味に矛盾がないものになっている
- 属性値が自由記述である場合、機械および人間が読んで意味のある、矛盾しない属性値が記述されている
- 要素と属性の組み合わせは意味のあるものになっている

といったものになります。詳しくは語彙的ルールとあわせて、主にChapter3で説明していきますが、例を次に示します。

#### ルールに従ったマークアップ例

Chapter1-2では、以下のようなマークアップの例を紹介しました。

```html
<h1>これは見出しのテキストのかたまりです</h1>
<p>これは本文です。この<strong>キーワード</strong>はこの文章で重要なものを表します。</p>
```

字句的にも語彙的にも当然問題ありません。この例では見出しを`h1`、本文を`p`というタグでマークアップしており、意味論的にも問題ありません。ここで、試しに要素を入れ替えるとどうなるでしょうか。

<!--(よくない例)-->
```html
<p>これは見出しのテキストのかたまりです</p>
<h1>これは本文です。この<strong>キーワード</strong>はこの文章で重要なものを表します。</h1>
```

このマークアップは、後で述べるHTMLのチェッカーでエラーにはなりません。しかし、適切だとは言えません。なぜなら、見出しを本文として、本文を見出しとしてマークアップしており、本来の意味が伝わらなくなっているためです。

マークアップ言語は、文書をマークアップして構造を明確にするものでした。言い換えると、マークアップによって、その部分の構造がどのような意味を持つものかを明確にするということです。

こうして表現される意味のことを「セマンティクス」（semantics）と呼びます。先ほど挙げた見出しや本文だけでなく、箇条書き、段落、ヘッダーやフッターといったさまざまな構成要素に対し、HTMLのマークアップを適切に当てはめることで、意味づけをして、セマンティクスが最終的な情報の受け手である人間に伝わるようにしていくのです。

#### コラム：メタデータを加える

マークアップでは、テキストの個々の部分のセマンティクスを表現します。それに加えて、ウェブページ全体に対してセマンティクスの情報を付け加えることもできます。

たとえば、書籍にタイトルがつけられているように、HTMLにもタイトルをつけることができます。ウェブは膨大な量の情報であふれかえっていますが、こういった追加の情報があれば、ページを探し出す際の手がかりになります。

ウェブページのコンテンツは、それ自体がデータです。タイトルは、そのデータが何であるか説明するデータです。あるデータを説明するデータ、すなわち、データのデータであると言えます。このようなものを「メタデータ」(meta data)と呼びます。情報の情報ととらえて「メタ情報」(meta information)と呼ぶこともあります。

メタデータはタイトル以外にもあります。たとえば、SNSでサムネイル画像を表示させるために使われる `<og:image>` というタグも、OGP (Open Graph Protocol)と呼ばれるメタデータを扱う仕組みの一つです。メタデータを記述する方法としては、他にも、JSON-LD (JSON for Linking Data) などがよく用いられています。このように、特定のフォーマットに基づいて構造化して記述したメタデータを「構造化データ」(structured data)と呼びます。

こういったメタデータによって、検索エンジンの検索結果に特別な情報を伝えたり、SNSサービスでそのページのURLを投稿した際にページの情報を補強したりすることが可能になります。

#### コラム：機械をだますセマンティクス

ときには、あえて不適切な意味付けを行い、機械をだますことも考えられます。

かつては、本来は見出しではないものを見出しとしてマークアップすることで、検索エンジンによるそのキーワードの評価を高め、検索上位表示を狙う、といったことが行われていたこともありました。

しかし、このようなHTMLのセマンティクスを濫用することは、いたずらにソフトウェアを混乱させることになります。これは結果としてウェプページの閲覧者の不利益になるだけです。現在では検索エンジン側の対策がなされ、そのようなマークアップに対してペナルティを与えることがあります。

### 適切なマークアップまとめ

3つのルールにわけて、正しい・適切なマークアップがどのようなものなのかについて述べてきました。字句的ルールや語彙的ルールは適切なマークアップの土台であり、その土台の上に意味論的ルールがあると言えるでしょう。また、メタデータを与えることで、より詳細に情報を伝えることも可能です。

## HTMLチェッカー

それでは、HTMLがルールに従ってマークアップされているかどうかを確かめるためには、どのようにチェックすればよいのでしょうか。

幸いなことに、HTMLをチェックするツールが存在します。古くからあるサービスとしては、W3CのMarkup Validation Service[^1]が有名です。これは現在でも利用できますが、このサービスに取って代わる新しいHTMLチェッカーとしてNu Html Checker[^2]が現在開発されています。

HTMLをNu Html Checkerでチェックすると、エラーとは別に警告(Warning)が報告されることがあります。品質を向上させる観点で理想的には警告をすべて修正することが望ましいですが、必ずしもゼロにすることに固執する必要はありません。警告の表示内容を理解した上で、必要なものについて対応するとよいでしょう。

チェッカーは便利なツールではありますが、HTMLのルールのすべてをチェックするものではないことに注意が必要です。機械的にチェックできる範囲は字句的ルールや語彙的ルールが主であり、意味論的ルールの大多数はその性質上、現在の技術ではチェックすることができません。

[^1]: https://validator.w3.org/

[^2]: <https://validator.w3.org/nu/> nuとnewは同じ発音ですから、そういった意味が込められているのでしょう。

## コラム: 仕様のアップデート

基本的には仕様に従ってマークアップを行えばよいわけですが、1つ注意すべきポイントがあります。それは、HTML Living Standardの議論が非常に活発だという点です。

ほぼ毎日のように、仕様のどこかに対して変更が提案されています。中には新しい要素や属性を追加する提案もあり、技術の進化にあわせて、ルールは少しずつ、ときにはドラスティックに変化しています。

ですから、HTMLにある様々なルールに変更がないかどうかについて、読者の皆さんが持っている知識を不定期的にアップデートする必要があります。そうすることで、最新のHTMLのルールに従ったマークアップをし続けることが可能になります。

## 適切なマークアップで得られるメリット

ここまで、適切なマークアップをする必要性について見てきました。最後に、適切なマークアップをすることで得られるメリットについて見てみましょう。

### 相互運用性の向上

適切にマークアップをすることで、コンテンツ制作者の意図するHTMLをルールに則ったマークアップで表現することができます。その結果、ある特定のブラウザーの、特定のバージョンでしか意図したとおりに動作しないようなウェブページを避けることができます。

言い換えると、ユーザーエージェントのベンダーやバージョンに依存しないウェブページを作成できるということです。現在のみならず、将来登場するかもしれないユーザーエージェントにも、正しく解釈してもらえることが期待できるでしょう。

### パフォーマンスの向上

適切なマークアップは、エラーのないHTMLと言えます。エラーがないということは、HTMLを解釈するユーザーエージェントがエラーに出くわしたときに行う必要のある処理をすることなく、HTMLを処理することができるということです。つまり、エラーを処理するためのリソースを節約することができます。

また、適切なマークアップは不必要に煩雑なマークアップを回避することにもなります。その結果としてマークアップを簡潔にすることにつながるため、HTMLファイルの容量の肥大化を防ぐことができます。

### メンテナンス性の向上

HTML仕様に従って作成されている適切なマークアップは、HTMLコードの見通しを良くし、将来への互換性を担保することができます。

見方を変えると、一定以上のHTMLコーディングスキルがあれば、どのような意図でマークアップしたのかが見えるようになる、ということができます。本書ではそのようなコーディングスキルを養うことも目標にしています。

### ウェブアクセシビリティの向上

適切なマークアップは、HTMLのもつポテンシャルを最大限に発揮することができます。ウェブアクセシビリティもHTMLのもつポテンシャルの1つです。ウェブアクセシビリティとは大雑把に言えば、ウェブ上の情報へのアクセスのしやすさです[^5]。適切にマークアップを行うことで、コンテンツに存在する情報がどのようなものかを環境に依存しない形で伝えることができます。

例えば、画像に対して適切な代替テキストを設定することで、画面を読み上げるスクリーンリーダーを使用した環境でも、コンテンツ制作者の意図した情報を伝えることができます。また、そのような画像の代替テキストがあれば、速度の遅いモバイルネットワークのような通信環境の悪い状況でも、画像が表示されない代わりに代替テキストが表示されることでどのような画像なのかを認識することができます。

[^5]: ウェブアクセシビリティに関するより詳しい説明については、『デザイニングWebアクセシビリティ』が参考になります。

### マシンリーダビリティの向上

適切なマークアップは、意味のあるマークアップであり、ユーザーエージェントが適切に解釈できるものでもあります。とりわけ、マシン（機械）であるサーチエンジンのクローラーに対しても有意義であると言えるでしょう。

前述のアクセシビリティと重なる面がありますが、画像と紐付いた代替テキストでもって、その画像がどのような画像なのかを機械も読むことができるということです。さらに、クローラーがページタイトルやリンクテキスト、あるいは構造化データなどと言ったマークアップの意味を通じて、コンテンツを解釈してくれるということにもつながります。

これはいわゆるSEO（サーチエンジン最適化）とも重なる部分があると言えます。適切にマークアップすることにより、サーチエンジンに対してより検索しやすいウェブページを提供することができるのです。

## コラム: 人に優しく、自分に厳しく

インターネットの世界では、“送信するものに関しては厳密に、受信するものに関しては寛容に”という原則があります。これは「ポステルの法則」(Postel's law)と呼ばれています。

ウェブからは離れますが、1つの例として、他人に葉書を郵送することを想像してみてください。葉書を届けてもらうためには、葉書の表面に宛先の郵便番号、住所、氏名を正確に書く必要があります。これらを正しく書かなければ、葉書が宛先に届くことはありません。しかし郵便局では、細かい番地や漢字の表記が多少間違っていても、なんとか届ける努力をしてくれるでしょう。

情報の送り手は正確に書く必要がある一方で、受け手側は、正確でなくても寛容に受け入れる努力をします。

HTMLにもこの法則が適用されます。受信側であるユーザーエージェントは、壊れたHTMLでもおおらかに解析してくれます。しかし、受信側が寛容だからといって、送信側が厳密にデータを送信しなくてもよいということになりません。情報の送信側となるコンテンツ制作者には、できるだけ厳密に仕様に従うことが求められるのです。そうすることで、情報を受信する人に、意図する情報が伝わるようになるのです。
