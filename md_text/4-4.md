# WAI-ARIAの実践と活用
<!-- class="hidden" のかわりに aria-hiden="true" を使ったらどうかという話。4ページも書くことがあるのかは謎。-->

4-2節ではWAI-ARIAと関連仕様についてとりあげました。この節では、WAI-ARIAを利用してアクセシビリティを向上する具体的な実践例について、WAI-ARIA Authoring Practices[^1]で紹介されている例をいくつか引きながら、実践で利用できるマークアップ例や、その注意点について説明します。

[^1]: <https://www.w3.org/TR/wai-aria-practices/>

## メニューボタン (ハンバーガーメニュー)

ボタンを押すとメニューが開く、というのはよくあるウィジェットです。特にモバイル用のページでは、メニューボタンに三本の横棒のアイコンがよく利用され、その形状から「ハンバーガーメニュー」と呼ばれます。一般的なハンバーガーメニューは、以下のような機能を持ちます。

- ユーザーがボタンを押すと、メニューが出現する
- メニューにはサイト内の主要なコンテンツへのリンクが含まれる
- メニューはコンテンツに覆いかぶさるような形で現れ、メニューが開いている間はメニューの外のコンテンツは利用できない
- メニューが出現した際、ハンバーガーボタン自体はメニューを閉じるボタンに変化する
- 閉じるボタンを押すとメニューは消え、元の状態に戻る

<!-- サイトから借りてきたが、実際にはポンチ絵の想定 -->
![ハンバーガーメニューの例。左側は初期状態、右側はボタンを押してメニューが開いている状態。](../img/4-4-01.png)

ウェブ制作者にとってはおなじみのパーツですが、アクセシビリティ上の留意点がいくつかあります。深く考えずに作成した場合、たとえば以下のようなマークアップになるかもしれません。

```html
<div class="hamburgerMenu">
    <div class="button">
        <span class="menu-icon"></span>
        <span class="close-icon"></span>
    </div>
    <ul>
        <li><a href="/">ホーム</a></li>
        <!-- メニュー -->
    </ul>
</div>
```

`<div class="button">`がボタンに相当します。中に入っている2つの`span`要素は、それぞれハンバーガーアイコンと閉じるアイコンに相当し、CSSでアイコン画像を適用します。これにJavaScriptでイベントをつけて動くようにします。

```JavaScript
const hamburgerMenu = document.querySelector('.hamburgerMenu');
const hamburgerMenuButton = hamburgerMenu.querySelector('.button');
hamburgerMenuButton.addEventListener('click', event => {
    hamburgerMenu.classList.toggle('js-opened');
});
```

JavaScriptの実装方法はいろいろありますが、ここでは単純に、外側の`div`要素に`js-opend`クラスをつけたり外したりするようにしました。あとは、CSSでスタイルを定義して、`js-opened`クラスがあるときだけ`ul`が表示されるようにすれば、ひとまずは完成です。

これでメニューボタンは動作しますが、残念なことに、このメニューにはアクセシビリティ上の問題点が多数あります。





基本方針としては、メニューが展開しているのか、それとも折りたたまれているのかをユーザーに伝える必要があります。

なお、ここでは詳しく触れませんが、折りたたみのあるアコーディオンについても基本的には考え方は同じになります。

図4-4-01 ハンバーガーメニューの例。左が折りたたまれている状態、右が展開している状態。

ハンバーガーメニューのアイコンが画像で提供される場合に、対応するマークアップ例は次のようになります。

```html
<button type="button" aria-controls="hamburger-menu" aria-expanded="false">
  <img src="open.png" alt="開く"><!-- ハンバーガーメニューのアイコン -->
</button>
<div id="hamburger-menu">
  <!-- メニューの内容 -->
</div>
```

`aria-controls`属性は、属性を指定した要素が制御する要素を特定するものです。制御する要素は、`id`属性で紐付けます。この例ではメニューの内容が記述されている`div`要素に紐付けています。

`aria-expanded`属性は、制御する対象が展開されているのか、それとも折りたたまれているのかどうか、その状態を示す属性です。


#### アクセシビリティ上の留意点 <!-- 後ろでまとめるべきか -->

ハンバーガーメニューに限らず、独自UIすべてに言えることですが、マウスだけでなくキーボードでも操作できるようにする必要があります。これはウェブアクセシビリティ上の要請[^2]であり、ウェブサイトが最低限備える必要のある機能です。

また、<kbd>Tab</kbd>キーを用いてキーボード操作をするとありがちですが、展開したメニューの背後に隠れていて見えない状態にある、本文のリンク等にキーボードフォーカスが当たってしまうという実装がよく見られます。ウェブアクセシビリティの観点からは、フォーカスの順序[^3]の問題になります。展開したメニューの中でキーボードフォーカスをループさせたり、メニュー末尾からフォーカスを移動するときにメニューを自動的に閉じるなどして、キーボードユーザーが使えるページにする必要があります。

[^2]: WCAG 2.1 Success Criterion 2.1.1 Keyboard <https://www.w3.org/TR/WCAG21/#keyboard>

[^3]: WCAG 2.1 Success Criterion 2.4.3 Focus Order <https://www.w3.org/TR/WCAG21/#focus-order>


### カルーセル

「カルーセル」（Carousel）は、メリーゴーランドのように、画像やテキストのスライドを循環させるスライドショーのコンポーネントです。

カルーセルにはさまざまなパターンが見られますが、多くの場合、WAI-ARIAが必要になることはありません。しかし、図4-4-02のように、スライドが見切れているものがある場合、その見切れたスライドは装飾的なパーツと考えることができます。

```
--+ +---+ +--
1 | | 2 | | 3
--+ +---+ +--

```

図4-4-02 左右のスライドが見切れているカルーセルの例

そのため、1と3のスライドを支援技術から隠す必要があります。そのような場合には、`aria-hidden`属性を見切れているスライドに適用して、支援技術に無視されるようにします。


#### 失敗例：ライブリージョンを誤って指定している

カルーセルは多くの場合WAI-ARIAの設定が不要と延べましたが、1つの誤った使用例として、自動再生されるカルーセルにライブリージョンを設定した例を取り上げてみます。

ライブリージョンは、支援技術に対して更新内容を伝えることのできるものです。

このライブリージョンをカルーセルに対して設定することで、スライドが切り替わるたびに更新内容が支援技術に通知されることになります。

そのため、音声読み上げではスライドが切り替わるたびに更新内容が読まれてしまいます。スライドの切り替わりが一定以上の間隔であれば、常にカルーセルの更新内容が読まれ続けることになり、カルーセルの更新通知以外のページの内容を理解することが困難になります。

`aria-live`属性や`alert`などのライブリージョンロールが本当に必要となる状況はあまり多くありません。ライブリージョンを設定した方がよいか、慎重に検討するのがよいでしょう。


#### アクセシビリティ上の注意点

WAI-ARIAからは離れますが、多くのカルーセルは自動でスライドが切り替わり続けます。その一方で、スライドを「停止」するボタンが提供されないことがあります。

WCAG 2.1の達成基準2.2.2 Pause, Stop, Hide[^4]では、動き続けるコンテンツが停止できることを求めています。スライドショーにかかわらず、自動的に動き続けるコンテンツは、停止できる機能を提供するようにしましょう。

[^4]: <https://www.w3.org/TR/WCAG21/#pause-stop-hide>

### タブパネル

タブメニューとも呼ばれる、サイトのトップページなどで見かけることのある、タブ切り替え機能です。典型的には、タブの一覧になっているタブリストがパーツ一式の上側にあり、下側にタブに関連付けられたタブパネルがあります。

<!-- 

イメージはここから適当に持ってくればよいか

デザインの参考に！おしゃれなタブメニューを導入しているサイトまとめ
https://www.hiroseyonaka.com/entry/2017/04/06/120610 

素材は https://www.takushoku-u.ac.jp/ よりお借り。ポンチ絵想定 -->


![](../img/4-4-03.png)

図4-4-03 タブパネルのイメージ例


```html
<div class="tabs">
  <div role="tablist">
    <button role="tab" aria-selected="true" aria-controls="topics-tab" id="topics">
      トピック
    </button>
    <button role="tab" aria-selected="false" aria-controls="release-tab" id="release" tabindex="-1">
      プレスリリース
    </button>
  </div>
  <div tabindex="0" role="tabpanel" id="topics-tab" aria-labelledby="topics">
    <ul>
      <li>広報紙最新号を発行しました。</li>
    </ul>
  </div>
  <div tabindex="0" role="tabpanel" id="release-tab" aria-labelledby="release" hidden>
    <ul>
        <li>○○報告会を開催します。</li>
    </ul>
  </div>
</div>
```

タブに`tab`ロールを付与し、複数のタブを`tablist`ロールを持つ要素でグループ化します。選択しているアクティブなタブは`aria-selected="true"`とし、選択していないタブについては属性値`false`を与えます。

アクティブでないタブに`tabindex="-1"`を与え、各タブパネルに`tabindex="0"`を与えることで、<kbd>Tab</kbd>キーでの移動はアクティブなタブから関連付けられたタブパネル間となります。これにより、タブ間の移動は左右の矢印キーを用いることになります。

タブとタブパネルの関連付けは`aria-controls`属性と`id`属性を用いています。また、`aria-labelledby`でタブパネルに対する名前を提供します。アクティブでないタブパネルについては`hidden`属性で非表示にしています。


### モーダルダイアログ

モーダルダイアログは、メインコンテンツの上に重ねられて表示されるダイアログです。ダイアログが表示されている間、言い換えるとダイアログを閉じるまで、メインコンテンツは無効になります。

<!--
https://www.w3.org/TR/wai-aria-practices/#dialog_modal
https://www.w3.org/TR/wai-aria-practices/examples/dialog-modal/dialog.html
https://qiita.com/ishimasar/items/47f29b958946a2c53e93

http://www.tohoho-web.com/bootstrap/modal.html
-->

![](../img/4-4-04.png)

図4-4-04 モーダルダイアログのイメージ図


```html
<div role="dialog" aria-labelledby="modal-label" aria-modal="true">
  <div class="modal-header">
    <h5 id="modal-label">Modal title</h5>
    <button type="button" aria-label="Close">
      <span aria-hidden="true">×</span>
    </button>
  </div>
  <div class="modal-body">
    Modal body
  </div>
  <div class="modal-footer">
    <button type="button">Close</button>
    <button type="button">OK</button>
  </div>
</div>
```

`dialog`ロールは、ダイアログコンテナ要素に対して付与し、ダイアログであることを表します。`aria-modal="true"`により、モーダルであることを表します。

このモーダルの名前は、`aria-labelledby`属性により、見出しで提供されます。

モーダルダイアログの右上にある「Close」ボタンは、テキストの「×」として提供されています。そのため、「×」自身は`aria-hidden`属性で無視させ、`aria-label`属性でボタンのラベルを提供しています。


### 画像をインラインSVGで表す

HTMLに直接インラインでSVGを記述したい、という場面も珍しくないでしょう。その場合、WAI-ARIAを付与する必要が出てきます。

`svg`要素はSVG 2仕様によれば`graphics-document`というロール[^5]を持っていることになります。これは端的に言えば、文書である`document`ロールの性質も持っているという位置付けになります。そのため、通常の画像として扱いたい場合は`img`ロールを付与します。

[^5]: <https://www.w3.org/TR/SVG2/struct.html#implicit-aria-semantics>

意味のある画像については、代替テキストを（SVGの）`title`要素で与えます。

```html
<svg role="img">
  <title>代替テキスト</title>
  ...
</svg>
```

`aria-describedby`で明示的に`svg`要素と`title`要素を結びつける方法がありますが、仕様上[^6]はそのようにする必要はありません。

[^6] <https://www.w3.org/TR/svg-aam-1.0/#mapping_additional>

```html
<!-- 冗長な例 -->
<svg role="img" aria-describedby="svgdesc">
  <title id="svgdesc">代替テキスト</title>
  ...
</svg>
```

画像が意味を持たない純粋に装飾的な画像である場合は、支援技術に無視させればよく、`aria-hidden`属性を用います。この場合、支援技術に何も伝えないため、`role`属性を指定する必要はありません。

```html
<svg aria-hidden="true">
  <!-- 純粋に装飾的な画像 -->
  ...
</svg>
```

#### 画像にありがちなアクセシビリティの問題

画像を`img`要素で表す場合は、代替テキストについては単に`alt`を考えるだけでよいのですが、前述のインラインSVGのように`img`要素でない方法で画像を表す場合、代替テキストを用意することを考える必要があります。

`alt`による代替テキストは、何らかの原因で画像が読み込めなかったときに、ブラウザー上で画像の代わりに表示されるという特性があります。代替テキストを提供する場合は、この特性と同等の挙動を実現する必要があります。

<!-- 4-3に移動すべきか？ -->

例えば、font awesomeのようなフォントアイコンで、`aria-label`属性で代替テキストの代わりにする実装を見かけることがありますが、`aria-label`はラベルであって代替テキストではありません。画面上に見えないラベルであるため、`alt`と同じ挙動にはなりません。

```html
<!-- 好ましくない実装例 -->
<i class="..." aria-label="開く"></i>
```

このような手法は既存サイトの緊急避難的な改修の場合に留め、新規にサイトを構築する際は避けることが望ましいです。