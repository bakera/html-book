# コメント

HTMLにはコメントを書くこともできます。コメントは、ソースコード中では読むことができますが、原則として表示などには影響しません。


## コメントの基本書式

コメントは、基本的に以下のような形式になります。

```html
<!--コメント-->
```

`<!--`がコメントの開始、`-->`がコメントの終了を表すマークです。これらに囲まれた部分がコメントの内容となります。コメントはブラウザに無視されるため、表示されません。

コメントは主に、HTMLのソースコードを読みやすくするために利用されます。ソースコード内のパーツの区切りを示したり、div要素などの終了タグがどの開始タグに対応したりするのかを書いたりすることができます。

```html
<!-- ヘッダー開始 -->
<div class="header">
...
<!--/header--></div>
<!-- ヘッダー終了 -->
```

コメントは要素ではありません。コメントの中に含まれるテキストはテキストノードではなく、コメントノードという独自のノードとして扱われます。コメントはノードですので、DOMを通じてコメントノードの内容にアクセスできます。

## コメントの構文ルール

コメントにはさまざまな内容を入れることができます。コメントには改行を含むことが許されるので、複数行のテキストを書くことができます。

```html
<!--
複数行にわたる
コメントも可能
-->
```

コメントは空でも構いません。以下は有効なコメントで、内容が空のコメントノードができます。

```html
<!---->
```

コメントの中に`<`を書くこともできます。コメントの中でタグを記述した場合はタグとはみなされず、そのままコメントノードの内容となります。よくあるパターンとして、既存のマークアップを一時的に除外するコメントアウトに使われます。

```html
<!--
<h1>見出し</h1>
<p>テキスト</p>
-->
```

上記の通り、`>`を書くこともできるのですが、`>`はコメントの内容の先頭に書くことができないという制限があります。コメントの内容の先頭を`->`で始めることもできません。
以下は誤った例です。

```html
<!-->コメント-->
<!--->コメント-->
```

これはエラー[^1]となり、空のコメントノードが追加されます。上記はいずれも、エラー処理によって、以下のようなマークアップと同じものとみなされます。

[^1]: abrupt-closing-of-empty-comment parse errorというエラーとして扱われます。

```html
<!---->コメント-->
```

`コメント-->`部分がコメントにならないことに注意してください。

## コメントは入れ子にできない

要素とは異なり、コメントの中に他のコメントを入れ子にすることはできません。以下はエラーとなる例です。

```html
<!-- 前 <!--内側--> 後 -->
```

コメントの中に`<!--`を書くとエラー[^2]となりますが、単に`<!--`もコメントの一部とみなされます。また、`-->`をコメントの中に入れようとすると、そこでコメントが終了したものとみなされます。上記の例は結果として、`前<!--内側`というコメントノードと、`後-->`というテキストノードになります。

[^2]: nested-comment parse errorというエラーとして扱われます。

また、コメントの内容の末尾に`<!-`を書くこともできません。以下は誤った例です。

```html
<!-- <!--->
```

これもコメントの中で別のコメントを入れ子にしようとしたものと解釈され、エラー[^2]となります。

## コメントの前後にスペースを挟む

コメントの内容の先頭に `>` `->` を書いたり、末尾に　`<!-` を書くとエラーになりますが、スペースを挟めば問題ありません。以下はいずれも正当なコメントです。

```html
<!-- >コメント -->
<!-- ->コメント -->
<!-- コメント<!- -->
```

コメントの前後にスペースを入れる習慣をつけておくと、エラーを避けやすくなるでしょう。ただし、いずれにしても入れ子のコメントは書けませんので、以下の例はスペースがあってもエラーになってしまいます。

```html
<!-- <!-- -->
```

コメントの前後にスペースを入れるとよい、ただし入れ子のコメントは書けない、と覚えておくとよいでしょう。

## Bogus Comment

過去のHTMLには、現在では使われていないマークが入っていることがあります。多くの場合、それらはコメントとみなすようになっています。このように、かつて使われていたマークで、現在はコメントとみなされるものを"Bogus Comment"[^3]と呼んでいます。Bogus Commentには以下のようなものがあります。

[^3]: Bogusは“偽物の”という意味です。

### マーク宣言

SGMLには`<!`ではじまる「マーク宣言」(Markup Declaration)と呼ばれるマークがあります。HTMLのコメントも、歴史的にはマーク宣言の一種であり、「注釈宣言」と呼ばれていました。先に紹介したDOCTYPEも、元は「文書型宣言」と呼ばれるマーク宣言の一種でした。

現在のHTMLでは、マーク宣言は全てコメントとして扱われます。以下の記述は、XMLやSGMLにおける“実体宣言”の例です。

```xml
<!ENTITY external-file SYSTEM "external.xml">
```

現在のHTML構文では、これは単なるコメントとみなされ、以下のようなマークアップと同じ意味になります。

```html
<!--ENTITY external-file SYSTEM "external.xml"-->
```

### 処理命令

SGMLやXMLには`<?` で始まる「処理命令」(Proccessing Instrument) と呼ばれるマークが存在します。XMLの先頭に書かれる“XML宣言”や、XMLのスタイルシートを指定する“xml-stylesheet処理命令”も処理命令の一種です。

```xml
<?xml version="1.0" encoding="UTF-8" ?> <!-- XML宣言 -->
<?xml-stylesheet type="text/xsl" href="basic.xsl" ?> <!-- xml-stylesheet処理命令  -->
```

これらは、XML構文では意味を持ちますが、HTML構文では単にコメントとみなされます。以下のようなコメントが書かれているものと解釈されます。

```html
<!--xml version="1.0" encoding="UTF-8" -->
<!--xml-stylesheet type="text/xsl" href="basic.xsl" -->
```

### CDATA区間

SGMLやXMLには「CDATA区間」(CDATA Section)と呼ばれるマークがあります。XHTMLでは、`script`要素と併用されるケースがよく見られました。

```xml
<script>
<!CDATA[[
 // JavaScriptのコード
]]>
</script>
```

これは、`script`要素内に出現した場合には、そのままスクリプトエンジンに送られます (そしてスクリプトエンジンの側で無視されます)。HTMLではないコンテキスト (`svg`要素の中など) で出現した場合は、本来のCDATA区間として解釈されます。そうでない場合、単にコメントとみなされます。

```html
<![CDATA[テキスト]]>
```

HTMLのコンテキストで上記のCDATA区間が現れた場合、以下のようなコメントと同じ意味になります。

```html
<!--[CDATA[テキスト]]-->
```

### 不正な終了タグ

タグ名はASCII英字(ASCII alpha)で始まらなければなりません。このルールは開始タグ、終了タグ両方に適用されます。

面白いことに、これに違反した場合のエラー処理は開始タグと終了タグとで異なり、開始タグがテキストとみなされるのに対し、終了タグはBogus Commentとみなされます。

たとえば、以下のようなマークアップがあったとします。

```html
<42></42>
```

これはエラーとなりますが、エラー処理の結果、開始タグの方はそのままテキストとなり、終了タグのほうは中身部分がコメントとなります。つまり、以下のマークアップと同じように扱われることになります。

```html
&lt;42><!--42-->
```
