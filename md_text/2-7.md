# コメント

HTMLにはコメントを書くこともできます。コメントは、ソースコード中では読むことができますが、原則として表示などには影響しません。

## コメントの基本書式

コメントは、基本的に以下のような形式になります。

```html
<!--コメント-->
```

`<!--`がコメントの開始、`-->`がコメントの終了を表すマークです。これらに囲まれた部分がコメントの内容となります。

コメントは表示に影響しませんので、コンテンツ制作者が好きな内容を書いておくことができます。主に、HTMLのソースコードを読みやすくするために利用されます。ソースコード内のパーツの区切りを示したり、`div`要素などの終了タグがどの開始タグに対応したりするのかを書いたりすることができます。

```html
<!-- ヘッダー開始 -->
<div class="header">
...
<!--/header--></div>
<!-- ヘッダー終了 -->
```

コメントは要素ではありません。コメントの中に含まれるテキストはテキストノードではなく、コメントノードという独自のノードとして扱われます。コメントはノードですので、DOMを通じてコメントノードの内容にアクセスできます。

## コメントの構文ルール

コメントにはさまざまな内容を入れることができます。コメントには改行を含むことが許されるので、複数行のテキストを書くことができます。

```html
<!--
複数行にわたる
コメントも可能
-->
```

コメントは空でも構いません。以下は有効なコメントで、内容が空のコメントノードができます。

```html
<!---->
```

コメントの中に`<`を書くこともできます。コメントの中でタグを記述した場合はタグとはみなされず、そのままコメントノードの内容となります。よくあるパターンとしては、既存のマークアップを一時的に除外するコメントアウトに使われます。

```html
<!--
<h1>見出し</h1>
<p>テキスト</p>
-->
```

上記の通り、`>`を書くこともできるのですが、`>`はコメントの内容の先頭に書くことができないという制限があります。コメントの内容の先頭を`->`で始めることもできません。
以下は誤った例です。

```html
<!-->コメント-->
<!--->コメント-->
```

これはエラー[^1]となり、空のコメントノードが追加されます。上記はいずれも、エラー処理によって、以下のようなマークアップと同じものとみなされます。

[^1]: abrupt-closing-of-empty-comment parse errorというエラーとして扱われます。

```html
<!---->コメント-->
```

`コメント-->`部分がコメントにならないことに注意してください。

## コメントは入れ子にできない

要素とは異なり、コメントの中に他のコメントを入れ子にすることはできません。以下はエラーとなる例です。

```html
<!-- 前 <!--内側--> 後 -->
```

コメントの中に`<!--`を書くとエラー[^2]となりますが、単に`<!--`もコメントの一部とみなされます。また、`-->`をコメントの中に入れようとすると、そこでコメントが終了したものとみなされます。上記の例は結果として、`前<!--内側`というコメントノードと、`後-->`というテキストノードになります。

[^2]: nested-comment parse errorというエラーとして扱われます。

また、コメントの内容の末尾に`<!-`を書くこともできません。以下は誤った例です。

```html
<!-- <!--->
```

これもコメントの中で別のコメントを入れ子にしようとしたものと解釈され、エラー[^2]となります。

## コメントの前後にスペースを挟む

コメントの内容の先頭に`>`や`->`を書いたり、末尾に`<!-`を書くとエラーになりますが、スペースを挟めば問題ありません。以下はいずれも正当なコメントです。

```html
<!-- >コメント -->
<!-- ->コメント -->
<!-- コメント<!- -->
```

コメントの前後にスペースを入れる習慣をつけておくと、エラーを避けやすくなるでしょう。ただし、いずれにしても入れ子のコメントは書けませんので、以下の例はスペースがあってもエラーになってしまいます。

```html
<!-- <!-- -->
```

コメントの前後にスペースを入れるとよい、ただし入れ子のコメントは書けない、と覚えておくとよいでしょう。

## Bogus Comment

過去のHTMLには、現在では使われていないマークが入っていることがあります。多くの場合、それらはコメントとみなすようになっています。このように、かつて使われていたマークで、現在はコメントとみなされるものを"Bogus Comment"[^3]と呼んでいます。Bogus Commentには以下のようなものがあります。

[^3]: Bogusは「偽物の」という意味です。

### マーク宣言

SGMLには`<!`で始まる「マーク宣言」(Markup Declaration)と呼ばれるマークがあります。HTMLのコメントも、歴史的にはマーク宣言の一種であり、「注釈宣言」と呼ばれていました。先に紹介したDOCTYPEも、元は「文書型宣言」と呼ばれるマーク宣言の一種でした。

現在のHTMLでは、マーク宣言はすべてコメントとして扱われます。以下の記述は、XMLやSGMLにおける「実体宣言」の例です。

```xml
<!ENTITY external-file SYSTEM "external.xml">
```

現在のHTML構文では、これは単なるコメントとみなされ、以下のようなマークアップと同じ意味になります。

```html
<!--ENTITY external-file SYSTEM "external.xml"-->
```

### 処理命令

SGMLやXMLには`<?`で始まる「処理命令」(Processing Instrument)と呼ばれるマークが存在します。XMLの先頭に書かれる「XML宣言」や、XMLのスタイルシートを指定する「xml-stylesheet処理命令」も処理命令の一種です。

```xml
<?xml version="1.0" encoding="UTF-8" ?> <!-- XML宣言 -->
<?xml-stylesheet type="text/xsl" href="basic.xsl" ?> <!-- xml-stylesheet処理命令  -->
```

これらは、XML構文では意味を持ちますが、HTML構文では単にコメントとみなされます。以下のようなコメントが書かれているものと解釈されます。

```html
<!--xml version="1.0" encoding="UTF-8" -->
<!--xml-stylesheet type="text/xsl" href="basic.xsl" -->
```

### CDATA区間

SGMLやXMLには「CDATA区間」(CDATA Section)と呼ばれるマークがあります。たとえば以下のように書きます。

```xml
<![CDATA[
<h1>CDATAのサンプル</h1>
<p>タグは無視され、すべてテキストとみなされます</p>
]]>
```

CDATA区間の内容は純粋なテキストとみなされ、CDATA区間の終了を意味する`]]>`という文字列をのぞいて、一切のマークを解釈しません。タグは無視され、すべてテキストとみなされます。また、コメントも無効で、テキストとして表示されます。さらに、`&amp;`などの文字参照も展開されません。

古いXHTMLでは、`script`要素の中に`<`などの文字を書くためにCDATA区間を使うケースがありました。

```xml
<script>
<!CDATA[[
  // JavaScriptのコード
  // CDATA の中なら < をそのまま書いてもエラーになりません
]]>
</script>
```

現在のHTMLでは、このCDATA区間の記述が`script`要素内に出現した場合、そのままスクリプトエンジンに送られます（そしてスクリプトエンジンの側で無視されます）。

`svg`要素や`math`要素の中など、HTMLの要素ではない、XMLを記述するコンテキストで出現した場合は、XMLのCDATA区間として解釈されます。つまり、CDATA区間の内容はテキストとみなされ、マークが解釈されません。

これらに該当しない一般的なHTMLの要素の中では、CDATA区間は使えません。CDATA区間が出現した場合はエラーとなり[^4]、Bogus Commentとして処理されます。以下は、HTMLの`pre`要素の中にCDATA区間を書こうとした例です。

<!-- 誤った例 -->
```html
<pre>
<!CDATA[[
<h1>HTMLのタグを無視してほしい</h1>
]]>
</pre>
```

このようなCDATA区間は使用できません。この場合、CDATA区間内の最初の`>`までがコメントとみなされます。つまり、以下のようなマークアップと等価になります。

```html
<pre>
<!--CDATA[[
<h1-->HTMLのタグを無視してほしい
]]>
</pre>
```

[^4]: cdata-in-html-content errorというエラーになります。

### 不正な終了タグ

タグ名は「ASCII英字」（ASCII alpha）[^5]で始めなければなりません。このルールは開始タグ、終了タグ両方に適用されます。

[^5]: https://infra.spec.whatwg.org/#ascii-alpha

興味深いことに、これに違反した場合のエラー処理は開始タグと終了タグとで異なり、開始タグがテキストとみなされるのに対し、終了タグはBogus Commentとみなされます。

たとえば、以下のようなマークアップがあったとします。

```html
<42></42>
```

これはエラーとなりますが、エラー処理の結果、開始タグはそのままテキストとなり、終了タグは中身部分がコメントとなります。つまり、以下のマークアップと同じように扱われることになります。

```html
&lt;42><!--42-->
```
