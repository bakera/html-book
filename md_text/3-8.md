# テーブル
この節では、テーブル (表) を表現する`table`要素と、関連の要素について説明します。

## テーブルとは

要素の説明に入る前に、テーブルについて確認しておきましょう。ここで言うテーブルとは、複数のデータを縦横に並べて、表の形式にまとめたものを指します。データが入っている1つ1つの項目を「セル」(cell)、テーブルを水平方向に切ったときのまとまりを「行」(row)、垂直方向に切ったときのまとまりを「列」(column)と呼びます。

![](../img/3-8-01.png)

図 3-8-01　テーブルの構成部品

テーブルにはタイトル (見出し、表題) が付けられることもあります。また、行や列にもラベルをつけることがあり、一般的に、行や列の先頭のセルにラベルを入れることで表現します。このようなラベルとなっているセルを「見出しセル」(header cell)と呼びます。

行や列はグループ化されることもあります。


## テーブル全体: `table`要素
HTMLでは、このようなテーブル構造となったデータを`table`要素で表現できます。`table`要素でテーブル全体を表現し、その中にテーブル中の行を表す`tr`要素を入れ、さらにその中にセルを表す`td`要素を入れるのが基本となります。以下は、2行3列のテーブルをマークアップした例です。

```html
<table>
  <tr>
    <td>日本</td>
    <td>東京</td>
    <td>アジア</td>
  </tr>
  <tr>
    <td>フランス</td>
    <td>パリ</td>
    <td>ヨーロッパ</td>
  </tr>
</table>
```

<!-- 内容モデル -->
`table`要素の内容モデルは複雑です。`caption`要素(0〜1)、`colgroup`要素、`thead`要素、`tbody`要素、`tfoot`要素が子要素となり得ます。それぞれの要素については、この後の節で説明します。要素の省略可否や入れられる個数についても各要素の項を参照してください。

`table`要素の中には最低でも`tbody`要素が1つ以上必要です。しかし、`tbody`要素は開始タグ終了タグ共に省略可能であるため、何も書かなくても`tbody`要素が補われます。そのため、`table`要素の内容に何も書かない場合でも文法違反にはなりません。また、上記で示した例のように、`tr`要素を`table`要素の直接の子要素であるかのように記述することも可能です (ただしこの場合、`tr`は`tbody`の子要素になります。詳しくは本書の`tbody`要素の項を参照してください)。

`table`要素直下には、これらのほか`script`要素と`template`要素、コメント、空白類を入れることができますが、他の要素は入れられません。本来入れられない要素が`teble`要素の直下に出現した場合、"foster parenting"と呼ばれる特殊なエラー処理が行われ、該当の要素が`table`要素の前に挿入されます。空白類でないテキストノードが出現した場合も同様です。

以下は、一見すると普通のマークアップですが、誤って全角スペースでインデントを行ってしまっている例です。

```html
<p>以下の表をご覧ください。</p>
<table>
<tr>
[　]<td>日本</td>
</tr>
</table>
```

`[　]`の部分は全角スペースです。これは`table`要素直下に出現できないテキストノードであるため、"foster parenting"によって`table`要素の前に移動されます。

```html
<p>以下の表をご覧ください。</p>
[　]
<table>
<tr>
<td>日本</td>
</tr>
</table>
```

この結果、`p`要素と`table`要素の間に全角スペースのテキストノードが挿入され、空間ができることになります。このように、`table`直下に余計なものがあると、予想外の挙動になることがあります。
<!-- /内容モデル -->

<!-- a11y note -->
`table`要素のデフォルトのARIAロールは"table"です。

スクリーンリーダーはほとんど場合、テーブル読み上げの専用モードを持ちます。テーブルの利点は、データの比較がしやすい点です。たとえば価格表であれば、製品の価格だけを追うことで、どの製品が安いのか、どの製品が高いのかを簡単に比べられます。テーブルでは、同じ項目は同じ列に並ぶため、目で追うことで簡単に比較検討ができるのです。

スクリーンリーダーの場合、基本的にはデータを先頭から順に読み上げていくことになります。これだけでは、テーブルの利点であるデータの比較が難しくなります。そこで、多くのスクリーンリーダーは、テーブルを読む専用のモードを用意して、データの比較が行いやすいようにしています。

テーブルを`table`要素としてマークアップすることで、スクリーンリーダーではテーブル読み上げのために豊富な機能を利用できるようになります。次のテーブルに飛ぶ、先頭から順に読むだけでなくセルを上下左右に移動しながら読む、行や列の見出しを読む、現在のセルが何行目何列目かを読む、などです。`table`関連の要素を利用せず、単にレイアウト調整で項目を表のように並べても、このような機能は利用できません。なお、CSSで`table`要素の`display`プロパティを`display: table`以外のものに変更した場合、適切に読めなくなるスクリーンリーダーも存在しますので注意が必要です。

`table`要素に`role="presentation"`を付与して"table"ロールを削除すると、この`table`要素が意味のある表ではなく、レイアウトのために利用されているものであることを支援技術に伝えることができます。ただし原則として、`table`要素をレイアウト目的に用いるべきではありません。

かつては`table`要素を駆使して無理やりレイアウトを整えることがありましたが、レイアウトはスタイルシートで実現すべきです。現在では、かなり複雑なレイアウトでも、CSS FlexboxやCSS Gridなどのスタイルシート技術で実現できるようになっています。何らかの事情でやむを得ずテーブルでレイアウトを表現せざるを得ない場合のみ、`role="presentation"`を指定するようにしてください。
<!--テーブルレイアウトとは何なのか、というのは整理した方がいいかも？ -->

`teble`要素に`role="grid"`を付与してロールを上書きすると、この`table`要素がウィジェット (操作可能なUI部品) であることを伝えられます。表のような形式で表現され、かつ個々のセルに対して選択などの操作ができるもの、たとえばカレンダー状のデートピッカーや、座席の予約に使用する座席表などに使用します。

<!-- 互換性メモ -->
HTML4の仕様では、`table`要素に`summary`属性が定義されており、主にスクリーンリーダーに向けた要約を書くことができました。しかし、今日のHTML仕様ではこの属性は廃止されています。テーブルについて説明したい場合は、地の文で普通に説明し、必要に応じてWAI-ARIAの`aria-describedby`属性などを用いるとよいでしょう。

また、古いHTML仕様では、テーブルの枠線の制御する`border`属性、`frame`属性、`rules`属性、セル間隔の調整を行う`cellspacing`属性、`cellpadding`属性も定義されていましたが、これらはいずれもテーブルの見た目を制御する属性であり、現在のHTML仕様では廃止されています。テーブルの見た目の制御はCSSで行いましょう。
<!-- /互換性メモ -->

<!-- /a11y note -->

## テーブルの行: `tr`要素

`tr`要素はテーブルの行を表します。

<!-- 内容モデル -->
`tr`要素の内容モデルは`td`要素,`th`要素です。それぞれの役割は後述します。なお、内容モデルとしては`th`も`td`も0個以上となっており、`tr`要素の内容を完全に空にできるように見えますが、空の行が存在するとテーブル構造が不正となるため "table model error" となります。基本的には`th`か`td`のいずれかが1つ以上必要だと考えてください。
<!--
4.9.12.1 Forming a table
>If there exists a row or column in the table containing only slots that do not have a cell anchored to them, then this is a table model error.
-->
<!-- /内容モデル -->

<!-- タグ省略 -->
`tr`要素は終了タグを省略可能です。直後に`tr`要素が出現する場合、もしくは親要素の末尾の要素である場合に終了タグを省略できます。
<!-- /タグ省略 -->

<!-- a11y note -->
`tr`要素のデフォルトのARIAロールは"row"です。`table`要素の項で説明したように、スクリーンリーダーはテーブルの行と列を認識して特別な読み上げを行うことがあります。現在のセルが何行目かを読む機能を持つものもあります。
<!-- /a11y note -->

## テーブルのセル: `td`要素と`th`要素
`td`要素はテーブルのデータセルを表します。通常のデータセルは`td`要素でマークアップしますが、見出しに相当するセルは`td`に代えて`th`要素で表現します。`th`要素はテーブルの見出しセルを表します。

前述のテーブルのコード例に列見出しを付けると、次のようになります。

```html
<table>
  <tr>
    <th>国名</th>
    <th>首都</th>
    <th>五大州</th>
  </tr>
  <tr>
    <td>日本</td>
    <td>東京</td>
    <td>アジア</td>
  </tr>
  <tr>
    <td>フランス</td>
    <td>パリ</td>
    <td>ヨーロッパ</td>
  </tr>
</table>
```

<!-- 内容モデル -->
`td`要素、`th`要素の内容モデルはいずれも"Flow"です。ただし、`th`要素の子孫には`header`要素、`footer`要素、セクショニングコンテンツ、見出し要素を入れることはできません。`th`要素の内容はそれ自体が見出しとなるため、子孫にさらに見出しを含むことはできないようになっています。`td`要素にはそのような制限はなく、見出しなども入れることが可能です。

ひとつセルに複数のデータが含まれるような場合、`ul`などのリストで表現することも可能です。`table`要素を入れることもでき、テーブルを入れ子にすることも可能です。もっとも、入れ子のテーブルは理解が難しくなるため、基本的には避けた方が良いでしょう。
<!-- /内容モデル -->

<!-- タグ省略 -->
`td`要素、`th`要素はいずれも終了タグを省略可能です。直後に`th`要素か`td`要素が出現する場合、もしくは親要素の末尾の要素である場合に終了タグを省略できます。
<!-- /タグ省略 -->

<!-- a11y note -->
`td`要素のデフォルトのARIAロールは"cell"です。ただし、祖先の`table`要素が"grid"ロールを持っている場合は"gridcell"がデフォルトになります。

`th`要素のデフォルトのARIAロールは、その`th`が列見出しであれば"columnheader"、行見出しであれば"rowheader"、いずれでもなければ"cell"となります (`td`同様、祖先の`table`要素が"grid"ロールを持っていれば"gridcell"になります)。

アクセシビリティ上、行や列に見出しがついていることは重要です。スクリーンリーダーがテーブルを読み上げる際、セルを読むときに対応する見出しを読み上げることができます。たとえば先の例では、2行目を読む際に「国名:フランス」「首都:パリ」「五大州:ヨーロッパ」のように読まれ、あるデータがどの列に属するのかわかります。

`th`要素の`scope`属性で見出しの範囲を指定することができます。`scope`属性は列挙属性で、`row`、`col`、`rowgroup`、`colgroup`、`auto`のいずれかを指定します。`row`は行（水平方向）の見出しであることを、`col`は列（垂直方向）の見出しであることを表します。`rowgroup`や`colgroup`は、それぞれ行グループや列グループの見出しであることを示します（行グループと列グループについては後述します）。デフォルトではコンテキストに基づく`auto`で、この場合はセルの配置場所などから推測を行います。

先に挙げた例では`th`要素に`scope`属性がつけられていませんでしたが、列の先頭にあることから列見出しであると推測されます。明示的に`scope`属性をつけると以下のようになります。

```html
<table>
  <tr>
    <th scope="col">国名</th>
    <th scope="col">首都</th>
    <th scope="col">五大州</th>
  </tr>
  <tr>
<!-- (以下略) -->
```

行と列の両方が見出しを持つような場合、ある見出しセルが行、列どちらの見出しなのか自明でない場合があります。そのような場合は`scope`属性で明示的に関連づけると良いでしょう。さらに複雑なテーブルについては、`th`要素に`id`属性をつけ、`td`要素の`headers`属性でそのIDを指定することで関連づけることも可能です。詳しくは、Web Accessibility Tutorials の Tables Concepts[^1]を参照してください。

[^1]: https://www.w3.org/WAI/tutorials/tables/

<!-- 互換性メモ -->
なお、HTML4では、`th`要素の`axis`属性によって見出しを関連づける機能もありましたが、今日のHTML仕様では`axis`属性は廃止されています。
<!-- /互換性メモ -->

`abbr`属性を用いると、見出しセルに略称をつけることができます。データセルを読むたびに見出しセルの内容が読まれることがあるため、見出しが長い場合は読み上げが非常に煩雑になねります。このような場合、`abbr`属性で見出しの略称を指定できます。

```html
<tr>
  <th scope="row" abbr="割合">全体に占める割合 (小数点以下を切り捨てているため、合計が100%にならない場合があります)</th>
  <td>59%</td>
  <td>15%</td>
  <td>25%</td>
</tr>
```

この例では、見出しセルそのものにフォーカスするとセルの内容全てが読まれますが、その列のデータを読んでいく際には「割合 59%」のような簡潔な読み上げになることが期待できます。
<!-- /a11y note -->

## テーブルのキャプション: `caption`要素
<!-- table要素にはtitle属性を指定することも可能で、「タイトル」とすると紛らわしいのでHTML4の翻訳では「表題」という訳語を採用していた。ここではひとまずカタカナでキャプションとする -->
`caption`要素は`table`のキャプション (タイトル、表題) を表します。前述のテーブルのコード例にキャプションを付けると、次のようになります。

```html
<table>
  <caption>国の首都と所属する州</caption>
  <tr>
    <th>国名</th>
    <th>首都</th>
    <th>五大州</th>
  </tr>
  <tr>
    <td>日本</td>
    <td>東京</td>
    <td>アジア</td>
  </tr>
  <tr>
    <td>フランス</td>
    <td>パリ</td>
    <td>ヨーロッパ</td>
  </tr>
</table>
```

`caption`要素は`table`要素の冒頭、`tr`などが出現する前に記述します。省略は可能ですが、複数置くことはできません。

`caption`要素の機能は`figcaption`要素と似ています。`caption`要素と`figcaption`要素の役割が完全にかぶるような場合、すなわち、`table`要素が`figure`要素の子要素であり、兄弟要素が`figcaption`要素しかない場合には、`figcaption`要素を利用しましょう。

<!-- 内容モデル -->
`caption`要素の内容モデルは"Flow"です。ただし、子孫要素として`table`要素を含むことはできません。`caption`要素の内容にはマークアップを入れることができますし、"Flow"ですから`p`要素なども入れられます。複数の段落からなる長い文章を入れることも可能です。
<!--テーブルのタイトルを表すといいつつ、仕様はテーブルの説明も一緒に表してるように思われ、これでいいのかという。-->
<!-- いいんじゃないでしょうか。凡例など入れたりするのに他に適切な要素もないですし……。-->
多くの場合、単に表のタイトルとなるテキストを入れますが、凡例や説明文などを入れることも可能です。
<!-- /内容モデル -->

<!-- タグ省略 -->
`caption`要素は終了タグを省略可能です。ただし、直後に空白類文字やコメントが出現する場合は終了タグを省略できません (その状況で終了タグを省略した場合、空白やコメントも`caption`要素の内容とみなされます)。
<!-- /タグ省略 -->

<!-- a11y note -->
`caption`要素にデフォルトのARIAロールはありません。テーブル読み上げ機能を持つスクリーンリーダーのほとんどは`caption`要素を認識し、テーブルに差し掛かった時にキャプションとして読み上げます。
<!-- /a11y note -->


## テーブルの行グループ
テーブルの行や列はグループ化することができます。行は`tr`要素で表現されますが、`thead`要素,`tbody`要素,`tfoot`要素を親要素とすることでグループ化できます。`thead`要素はヘッダー行のグループ、`tbody`要素はテーブルの本体を構成する行のグループ、`tfoot`要素はフッター行のグループを表現します。前述のテーブルのコード例に行グループを追加すると、次のようになります。

```html
<table>
  <caption>国の首都と所属する州</caption>
  <thead>
  <tr>
    <th>国名</th>
    <th>首都</th>
    <th>五大州</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>日本</td>
    <td>東京</td>
    <td>アジア</td>
  </tr>
  <tr>
    <td>フランス</td>
    <td>パリ</td>
    <td>ヨーロッパ</td>
  </tr>
  </tbody>
　<!-- tfoot要素を加えるなら、この位置になる -->
</table>
```
<!-- 互換性メモ -->
HTML4では、`tfoot`要素は`tbody`要素よりも前に記述するものとしており、`thead`,`tfoot`,`tbody`の順で書くことになっていました。現在のHTMLでは、実際に表示される順番の通り、`thead`,`tbody`,`tfoot`の順に記述します。
<!-- /互換性メモ -->

`thead`要素と`tfoot`要素はなくても構いませんが、それぞれ1つずつしか置くことができません。`tbody`要素は最低1つ必要で、複数持つこともできます。本体にあたる行を複数のグループに分けることができます。

ここで気づいた方もいるかもしれませんが、最初の単純なテーブルで挙げたマークアップ例では、テーブル本体があるにもかかわらず、`<tbody>`タグを書いていませんでした。これは、特定の場合に`tbody`要素のタグを省略できることによります（正確な省略可能な条件は、仕様を参照してください）。言い換えると、`tbody`要素のタグを書かなくても、自動的に補われて`tbody`要素が挿入されることになります。

`<tbody>`タグがないにもかかわらず`tbody`要素が存在することになるため、CSSのセレクターを利用する際などに注意が必要です。`<tbody>`タグを持たない単純なテーブルのコード例に対し、CSSの子セレクターを用いて、以下のように指定したとしましょう。

```css
table > tr {color: red;}
```

しかし、これは何も起きません。以下のようにするとスタイルが反映されます。

```css
table > tbody > tr {color: red;}
```

これは、`tbody`要素が補われ、`tr`要素が`table`の直接の子ではなく、`tbody`要素の子要素になっているためです。

<!-- 内容モデル -->
`thead`要素、`tfoot`要素、`tbody`要素の内容モデルは、いずれも`tr`です。`tr`は0個以上とされており、空でも構いません。このほか、スクリプト関連の要素(`script`要素と`template`要素)を置くことができます。他の要素を入れることはできません。
<!-- /内容モデル -->

## テーブルの列グループ

`col`要素はテーブルの列を表します。`colgroup`要素は列のグループを表します。`tbody`と`tr`に対応するものと考えるとわかりやすいかもしれません。ただし、`tr`要素と異なり、`th`要素や`td`要素を子に持ちません。

前述のテーブルのコード例に列グループを追加すると、次のようになります。

```html
<table>
  <caption>国の首都と所属する州</caption>
  <colgroup>
    <col span="2" style="background-color: #ccc;">
  </colgroup>
  <colgroup>
  </colgroup>  
  <thead>
  <tr>
    <th>国名</th>
    <th>首都</th>
    <th>五大州</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>日本</td>
    <td>東京</td>
    <td>アジア</td>
  </tr>
  <tr>
    <td>フランス</td>
    <td>パリ</td>
    <td>ヨーロッパ</td>
  </tr>
  </tbody>
</table>
```

`span`属性は、グループ化する列の数を表し、1～1000の整数を指定できます。上記の例では、最初の2列をひとつのグループにしています。

`colgoup`


## 複雑なテーブル

`rowspan`属性でセル（`th`および`td`要素）を行に対して拡げることができます。同様に、`colspan`属性でセルを列に対して拡げることができます。どちらもデフォルトの値は1ですが、`colspan`の属性値は1以上1000以下の整数を、`rowspan`の属性値は0以上65535以下の整数を指定できます。`rowspan`属性値に0を指定すると、セルが行グループですべての残りの行に拡がります。

例えば次のようになります。

<!-- https://www.kanzaki.com/docs/html/htminfo16.html#S24からそのままお借り。もう少し例を煮詰める -->
```
<table>
  <caption>身近な食べ物と珍しい食べ物</caption>
  <tr>
    <th>大分類</th>
    <th>名称</th>
    <th>味の特徴</th>
    <th>色</th>
  </tr>
  <tr>
    <th rowspan="2">果物類</th>
    <td>りんご</td>
    <td>甘酸っぱい</td>
    <td>おおむね赤</td>
  </tr>
  <tr>
    <!-- 上のセルで拡げられるため、ここのthはない -->
    <td>なつみかん</td>
    <td>かなり酸っぱいと思う</td>
    <td>たいてい黄色</td>
  </tr>
  <tr>
    <th>宇宙食</th>
    <td>何でしょう</td>
    <td colspan="2">見たことも食べたこともないので不明</td>
    <!-- 左のセルで拡げられるため、ここのtdはない -->
  </tr>
</table>
```

![](../img/3-8-02.png)

図 3-8-02 `rowspan`と`colspan`属性を指定したテーブルコード例のレンダリング結果。わかりやすさのためにCSSでボーダーを付けています。

`rowspan`属性や`colspan`属性を用いることにより、視覚的に複雑なテーブルを作成することができます。しかし、ウェブアクセシビリティの観点からは、見出しとセルの関係性を上手く解釈できない場合があるため、勧められません[^1]。可能であれば、セルを拡げることのない、シンプルなテーブルで表現することを勧めます。

[^1]: `id`属性と`headers`属性を用いて、関係性を仕様上はマークアップで表現できることになっていますが、支援技術のサポート状況は必ずしも芳しいものではないとされています。
