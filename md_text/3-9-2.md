# フォーム (続き)

HTMLには「フォーム」を表示する機能があり、利用者はフォームにデータを入力し、それをウェブサーバーに情報を送信することができます。この節では、フォームとそれを構成する入力欄に関連する要素について説明します。

## `button`要素

`button`要素は、ボタンを表します。`input`要素でもボタンを表現できますが、`input`要素ではボタンのラベルを`value`属性で指定するのに対し、`button`では要素の内容がラベルとなる点が異なります。「送信」というボタンを`input`要素と`button`要素で実装すると、以下のようになります。

```html
<!-- inputとbutton要素の比較 -->
<input type="submit" value="送信">
<button type="submit">送信</button>
```

`type`属性で、ボタンが押された際の振る舞いを制御します。この属性は列挙属性であり、次の表の値を取ります。

- `submit`: フォーム送信を行う
- `reset`: フォームをリセットする
- `button`: 何もしない (主にスクリプトと組み合わせて使用します)

`type`属性のデフォルト値は`submit`です。`type`属性を指定しない場合、送信ボタンになることに注意してください。フォーム送信を意図しない場合、明示的に`type=button`を指定する必要があります。

`type=reset`を指定するとリセットボタンとなります。リセットボタンが押されると、ボタンに対応するフォームに含まれる全てのフォームコントロールが初期化されます。誤って押すと、入力内容全てが消えてしまい、取り返しがつかない場合があります。リセットボタン自体には、押された際に警告を出すような機能は備わっていません。必要に応じてスクリプト等で動作を制御し、本当にリセットするかどうか確認するようにしても良いでしょう。そもそも、必要のないリセットボタンは配置しない方が良いでしょう。

<!-- 内容モデル -->
`button`要素の内側モデルは"Phrasing"です。ただし、子孫要素にインタラクティブコンテンツを入れることはできません。また、`tabindex`属性が指定されている要素を子孫要素にすることもできません。

`button`要素の内側はボタンのラベルとなります。単純なテキストを入れるだけでなく、マークアップを行うこともできます。`img`要素を入れることもできるので、画像を入れたり、さまざまな装飾をすることが可能です。`input`要素でボタンを表現する場合、ラベルにマークアップを含めることができませんので、`button`要素のほうが表現力に優れていると言えるでしょう。
<!-- /内容モデル -->

<!-- a11y note -->
`button`要素のデフォルトのARIAロールは"button"です。スクリーンリーダーでは、ボタンのラベルとともに、ボタンであることが読み上げられます。逆に、ボタンに適切なラベルが与えられていない場合、単に「ボタン」としか読まれず、何をするボタンなのかわからなくなってしまいます。特にボタンにアイコン画像を入れている場合などは、画像に代替テキストを指定するなどして、適切なラベルテキストが設定されるようにしてください。

`type=button`のボタンには、スクリプトによってさまざまな機能を与えられることがあります。ボタンの機能によっては、WAI-ARIAの状態(ステート)を付与することによって理解がしやすくなる場合があります。たとえば、トグルボタンのようなものであれば`aria-pressed`を、ボタンがメニューを開閉するようなものであれば`aria-expanded`を使用することを検討すると良いでしょう。
<!-- /a11y note -->

## `select`要素

`select`要素は、オプションから選択するためのコンボボックス、あるいはリストボックスのコントロールを表します。子要素として、`option`要素で選択肢を記述します。以下は選択肢からペットの種類を選択させる例です。

```html
<label>ペットを選びます:
<select name="pet" required>
    <option value="" selected>--ペットの選択肢--</option>
    <option value="dog">いぬ</option>
    <option value="cat">ねこ</option>
    <option value="parakeet">インコ</option>
</select>
</label>
```

`size`属性を指定すると、ユーザーに一度に見せる選択肢の数を指定できます。属性を指定しない場合のデフォルト値は"1"で、この場合にはコンボボックスとして表現されます。多くのブラウザではプルダウン式のリストとして表現されますが、モバイル端末ではドラムロール型のUIで表現されることもあります。UIの表現方法は仕様で規定されていないため、他の表現方法になる可能性もあります。

![スクリーンショット: Chromeでコード例を表示したところ。展開前は省スペースで表示されている](../img/3-9-2-01.png)
![スクリーンショット: Chromeでコード例を表示したところ。クリックするとリストが展開される](../img/3-9-2-02.png)
<!-- モバイルデバイスの表示例も載せる? -->

`size`属性に"2"以上の値を指定すると、リストボックスとして表現されます。多くのブラウザでは高さが広がり、複数の選択肢が一度に見えるようになります。

![スクリーンショット: Chromeでsize=5の例を表示したところ。リストが縦に展開されている](../img/3-9-2-03.png)

`select`要素のコントロールは、提示した選択肢から選ばせる機能を提供しますが、ラジオボタンでも同じ機能を実現できます。見た目や操作方法が異なるので、利用者にとって使いやすいと思われる方を選択すると良いでしょう。

`multiple`属性を指定すると、複数選択ができるようになります。多くのブラウザでは、`size`属性の値が"1"であっても、選択肢すべてが展開された状態で表示されます。複数選択を行う場合、`ctrl`もしくは`cmd`キーを押しながらリスト項目を選択するといった独自の操作が必要になりますが、この操作に慣れていない利用者も多いでしょう。この複数選択のコントロールはあまり使われません<!--個人的には一発太郎 ( https://www.ippatsu.net/ ) でしか見たことがない-->。複数選択が必要な場合は、チェックボックスで表現したほうがよい場合が多いでしょう。

![スクリーンショット: Chromeでmultipleを指定した例を表示したところ。最初からリストが展開されている](../img/3-9-2-04.png)

選択肢の初期値は、初期値となる`option`要素に`selected`属性を指定することで設定します。`select`要素に`multiple`属性がついていない場合、`selected`を指定できる`option`は一つだけです。フォーム送信を行うと、選択されている`option`要素の`value`属性の値がサーバーに送信されます。詳しくは`option`要素の項を参照してください。

`select`要素に`multiple`属性がない場合において、最初に登場する`option`要素の`value`属性の値が空文字列であるなら、その`option`は「プレースホルダラベル」(placeholder label)として扱われます。これが選択されていると、その`select`は何も選択していない初期状態になっているとみなされます。`select`要素に`required`属性を指定している場合、プレースホルダラベルが選択されている状態で送信を行うとエラーになります。

`value`属性の値が空文字列でも、`option`が先頭にないとプレースホルダラベルとはみなされません。以下の例は、先の例とほぼ同じですが、選択肢の順番だけを入れ替えています。この場合、初期状態の「--ペットの選択肢--」のまま送信しようとしてもエラーになりません。

```html
<select name="pet" required>
    <option value="dog">いぬ</option>
    <option value="cat">ねこ</option>
    <option value="parakeet">インコ</option>
    <option value="" selected>--ペットの選択肢--</option>
</select>
```

<!-- 内容モデル -->
`select`要素の内容モデルは`option`もしくは`optgroup`です。`optgroup`要素を使用すると、選択肢をグループ化してグループのラベルを表示することができます。詳しくは`optgroup`要素の項を参照してください。
<!-- /内容モデル -->

<!-- a11y note -->
`select`要素のデフォルトのARIAロールは、`size`属性と`multiple`属性の内容によって変化します。どちらの属性もないか、あるいは`size=1`の場合、ロールは"combobox"です。スクリーンリーダーは、`select`要素に関連づけされたラベルを読み、さらに「コンボボックス」などと読み上げることがあります。

`size`属性が2以上か、`multiple`属性がある場合は"listbox"となります。スクリーンリーダーは、`select`要素に関連づけされたラベルを読み、さらに「リストボックス」などと読み上げることがあります。

いずれの場合も、ラベルが関連づけされていないと何を選択するのか伝わらないことがあるため、`label`要素を適切に使用して関連づけておくと良いでしょう。
<!-- /a11y note -->

### `option`要素

`option`要素は`select`要素や`datalist`要素とセットで扱い、個々の選択肢を表現します。用例は`select`要素、`datalist`要素の項を参照してください。

`value`属性で、フォーム送信時に送信される値を指定します。この属性を省略した場合は、要素の内容となっているテキストが値として送信されます。

`label`属性を指定すると、選択肢として表示されるラベルを指定できます。この属性を省略した場合は、要素の内容となっているテキストがラベルとして表示されます。通常はこの属性を使わず、要素の内容をそのままラベルとすることが多いでしょう。

`selected`属性が指定されていると、その`option`要素がデフォルトで選択されている状態になります。`selected`属性は真偽値属性です。

<!-- 内容モデル -->
`option`要素の内容はテキストです。ただし、`label`属性と`value`属性の両方が指定されている場合には、`option`要素の内容モデルは"Nothing"となり、内容を含めることはできません。
<!-- /内容モデル -->

<!-- a11y note -->
`option`要素のデフォルトのARIAロールは、文脈によって異なります。祖先が`select`要素であり、そのロールが"listitem"である場合、もしくは祖先が`satalist`要素である場合は、"option"ロールとなります。祖先が`select`要素であり、ロールが"combobox"である場合、特定のロールは持たず、コンボボックスの一部として扱われます。この場合、ブラウザーは内部的に"menuitem"ロールとして扱うことがあります。
<!-- /a11y note -->

### `optgroup`要素

`select`要素の中で`optgroup`要素を使用すると、`option`要素をグループ化することができます。`label`属性が必須で、これがグループの名前となります。

```html
<select>
  <optgroup label="ほ乳類">
    <option>いぬ</option>
    <option>ねこ</option>
  </optgroup> 
  <optgroup label="鳥類">
    <option>インコ</option>
  </optgroup>
</select>
```

これはたとえば以下のように表示されます。

![スクリーンショット: Chromeでoptgroupの例を表示したところ。optgroupのラベルが選択できない形で表示されている](../img/3-9-2-03.png)

`optgroup`要素は、あくまでグループのラベルを表現するものです。`optgroup`自体を選択することはできません。そのため、`selected`属性や`value`属性はありません。

全ての`option`を`optgroup`に入れなければならないわけではなく、`optgroup`に属さない`option`を混在させることもできます。

```html
<select>
  <optgroup label="ほ乳類">
    <option>いぬ</option>
    <option>ねこ</option>
  </optgroup> 
  <option>その他</option>
</select>
```

<!-- 内容モデル -->
`optgroup`要素の内容モデルは0個以上の`option`です。`option`以外のものを入れることはできません。`optgroup`を入れ子にすることもできません。なお、`option`要素は0個でも良いので、空の`optgroup`要素を使うことも可能です (意味があるかはともかく)。
<!-- 内容モデル -->

<!-- a11y note -->
`optgroup`要素のデフォルトのARIAロールは"group"です。スクリーンリーダーでは、ラベルを読み上げた後「クループ」などと読んで、選択肢のグループの名前であることがわかるように伝えてくれることが期待されます。
<!--
 しかしスクリーンリーダーの実際の対応状況は厳しいかも。
 最新のMacOS VoiceOverはoptgroupを特にそれらしくは読まず「淡色表示 {ラベル}」などと読む (見た目が淡色表示になっているのでそのまま読んでいる模様。とてもわかりにくい)。
 2014年時点ではNVDAも対応していなかった模様。https://waic.jp/docs/as/info/201406/H85-2.html
 最新の状況は要確認。
-->
<!-- /a11y note -->


## `datalist`要素

`datalist`要素は、ユーザーに提案する定義済み候補のリストを示します。`input`要素と組み合わせて使用し、対応する`input`要素の入力時に入力補完の候補を示します。`datalist`要素の子孫要素である`option`要素が候補として提示されます。

`datalist`要素に`id`属性を指定し、`input`要素の`list`属性でそのIDを指定することにより、候補を結び付けます。以下は、テキスト入力欄に対して入力補完候補を提示する例です。

```html
<label for="ice-cream-choice">アイスクリームのフレーバー:</label>
<input list="ice-cream-flavors" id="ice-cream-choice" name="ice-cream-choice">

<datalist id="ice-cream-flavors">
    <option value="Chocolate">
    <option value="Coconut">
    <option value="Mint">
    <option value="Strawberry">
    <option value="Vanilla">
</datalist>
```

これはたとえば以下のように表示されます。

![スクリーンショット: Chromeでサンプルを表示した例。入力欄にフォーカスすると、プルダウンメニューが出現して補完候補が表示される](../img/3-9-2-05.png)

この例では、ユーザーは選択肢から選ぶこともできますし、選択肢を無視して任意のテキストを入力することもできます。

テキスト入力以外にも、日付の入力、範囲の入力、カラーピッカーのコントロールなどに対して候補を提示することができます。`datalist`要素による補完候補を利用できるのは、`type`属性が"text"、"search"、"url"、"tel"、"email"、"date"、"month"、
"week"、"time"、"datetime-local"、"number"、"range"、"color"の場合です。

`type=range`に適用すると、候補リストを表示するのではなく、提示された場所に目盛りが表示され、そこにスナップするような動作になります。具体的な使用例は`type=range`の項を参照してください。

<!-- 内容モデル -->
`datalist`要素の内容モデルは、`option`要素もしくは"Phrasing"です。通常は`option`要素を入れますが、`datalist`要素に対応していないブラウザーに対して入力欄を提示できるようになっています。以下はその一例です。

```html
<label>
動物の名前を入力してください:
<input name="animal" list="animals">
</label>
<datalist id="animals">
 <label>
  もしくは、以下から選択してください:
  <select name="animal">
   <option value="">--選んでください--</option>
   <option>猫</option>
   <option>犬</option>
  </select>
 </label>
```

こうすると、`datalist`要素を理解しないブラウザーでは、内容である`label`要素および`select`要素が表示され、`option`は`select`要素の選択肢となります。

`datalist`要素に対応したブラウザーの場合、`datalist`要素の内容は表示されず、子孫の`option`要素が`input`要素の入力補完候補として利用されることになります。
<!-- /内容モデル -->

<!-- a11y note -->
`datalist`要素のデフォルトのARIAロールは"listbox"です。`datalist`要素と結び付けられたコントロールにフォーカスすると、スクリーンリーダーは、「候補リストが表示されました」のように読み上げ、補完候補があることをユーザーに伝えます。
<!-- a11y note -->


## `textarea`要素

`textarea`要素は、複数行のテキストを入力・編集するフォームコントロールを表します。`type=text`の`input`要素と異なり、改行を入力することが可能です。コメント欄やお問い合わせフォームの本文入力欄など、ユーザーが自由記述のテキストを入力するときに利用します。

以下は`textarea`要素を使用した例です。

```html
<label for="advanced">高度な例:
  <textarea id="advanced" name="advanced"
            rows="3" cols="33" maxlength="200">
rows属性とcols属性でサイズが指定されたtextarea要素。最大文字数は、maxlengthによって200に制限されています。
  </textarea>
</label>
```

`type=text`の`input`要素ではテキストの初期値を`value`属性で指定していましたが、`textarea`要素では要素の内容が初期値となります。

`rows`属性で入力欄に表示する行数を指定します。指定がない場合の初期値は"2"で、2行分の高さが確保されます。入力欄の高さを指定するものと考えても差し支えありませんが、スタイルシートによって高さが指定されている場合、そちらの方が優先されます。

同様に、`cols`属性で1行あたりの文字数を指定できます。指定がない場合の初期値は"20"で、20文字分の幅が確保されます。後述の`wrap`属性を使用して`wrap=hard`を指定した場合、折り返しの文字数としても利用されます。詳しくは`wrap`属性を参照してください。

`cols`属性で指定した文字数が必ずしも入るわけではないことに注意してください。文字の幅は文字によって異なるため、使用しているフォントの文字幅の平均によって幅を計算します。なお、スタイルシートによる幅指定がある場合はそちらが優先されます。
<!--
https://html.spec.whatwg.org/multipage/rendering.html#textarea-effective-width
The textarea effective width of a textarea element is size×avg + sbw, where size is the element's character width, avg is the average character width of the primary font of the element, in CSS pixels, and sbw is the width of a scrollbar, in CSS pixels. (The element's 'letter-spacing' property does not affect the result.)
-->

<!-- wrap属性は実務でほぼ使わないけれど面白いので説明してしまう。コラム扱いでも可 -->
`wrap`属性を指定すると、フォーム送信時の長い行の折り返し処理を制御できます。`wrap`属性は列挙型属性で、"soft"または"hard"のいずれかを指定します。"hard"を指定すると、フォーム送信時に、入力欄の端で自動的に折り返した部分に改行 (CR+LF, %0d%0a) が挿入されます。指定がない場合のデフォルトは"soft"です。この場合、長い行が入力欄の端で自動的に折り返しても、その部分に改行は挿入されません。

以下は`wrap=hard`を指定した例です。

```html
<textarea name="wrapped" wrap="hard" cols="10">
this is a textarea element
</textarea>
```

内容のテキストに改行は含まれていませんが、`wrap="hard" cols="10"`が指定されているため、10文字ごとに折り返されて改行が挿入されます。GET メソッドで送信すると以下のようになります。

```text
wrapped=this+is+a+%0D%0Atextarea+%0D%0Aelement%0D%0A
```

なお、`wrap=hard`を指定した場合は`cols`属性が必須です。
<!--
https://html.spec.whatwg.org/multipage/form-elements.html#attr-textarea-wrap
>If the element's wrap attribute is in the Hard state, the cols attribute must be specified.
`cols`属性の省略時のデフォルト値は"20"なのだから省略してもcols=20として扱えば問題なさそうに思えるし、実際にChromeもcols=20として動作する。とはいえ、仕様には必須と書いてあるから必須なのだしか言いようがない。Nu Html Checkerでもしっかりエラーになる。
-->

また、`type=text`の`input`要素と同様に、以下の属性を使用することができます。詳しくは`input`要素の項を参照してください。

- `maxlength`
- `minlength`
- `required`
- `placeholder`

なお、`textarea`要素では`pattern`属性を使用することはできません。

<!-- 互換性メモ -->
HTML4では`texrarea`要素に`maxlength`属性がありそうでなかったのですが、HTML5からは`textarea`要素にも指定できるようになりました。
<!-- /互換性メモ -->

<!-- 内容モデル -->
`texrarea`要素の内容モデルはテキストです。内容として指定されたテキストが入力欄の初期値となります。改行を含めておくことも可能です。
<!-- /内容モデル -->


<!-- a11y note -->
`texrarea`要素のデフォルトのARIAロールは"textbox"です。多くのスクリーンリーダーは、ラベルを読み上げたのち、「テキストを編集」「複数行テキスト入力」などと読み上げ、その後に入力されている内容を読み上げます。

ラベルが指定されていないと何を入力すべきかわからなくなることが多いため、`label`要素と組み合わせて確実にラベルを指定するようにするべきです。
<!-- /内容モデル -->

## `output`要素

`output`要素は、アプリケーションによって実行された計算の結果やユーザー操作の結果を表します。

次のように、簡単な電卓の出力部分に`output`要素を使用できます。

```html
<form onsubmit="return false" oninput="o.value = a.valueAsNumber + b.valueAsNumber">
 <input id=a type=number step=any> +
 <input id=b type=number step=any> =
 <output id=o for="a b"></output>
</form>
```


## `progress`要素

`progress`要素は、タスクの進捗状況を表します。これは通常、プログレスバーとしてレンダリングされます。

```html
<progress id=p max="100" value="50"><span>50</span>%</progress>
<script>
  var progressBar = document.getElementById('p');
  function updateProgress(newValue) {
    progressBar.value = newValue;
    progressBar.getElementsByTagName('span')[0].textContent = newValue;
  }
 </script>
```

このように`updateProgress()`メソッドを外部から呼び出すことで、`progress`要素の値を更新することができます。


## `meter`要素

`meter`要素は既知の範囲のスカラー量、または小数の値を表します。たとえば、ディスク使用量、投票人口の割合などです。
<!-- std -->

次の例は、すべて3/4で満たされる3つのゲージを示します。

```html
ストレージ容量の使用状況: <meter value=6 max=8>6ブロック使用済み (合計8個中)</meter>
投票率: <meter value=0.75><img alt="75%" src="graph75.png"></meter>
チケット販売数: <meter min="0" max="100" value="75"></meter>
```
<!-- https://www.tagindex.com/html5/form/meter.html ここに色の挙動が書かれているのでこれをごにょごにょ  -->


## `fieldset`要素

`fieldset`要素は、関連するコントロールのセットをグループ化するために使用されます。

```html
<fieldset>
 <legend>ディスプレイ表示</legend>
 <p><label><input type=radio name=c value=0 checked>黒地に白字</label>
 <p><label><input type=radio name=c value=1>白地に黒字</label>
 <p><label><input type=checkbox name=g>グレースケールを使用する</label>
 <p><label>コントラストを強調する <input type=range name=e list=contrast min=0 max=100 value=0 step=1></label>
 <datalist id=contrast>
  <option label=Normal value=0>
  <option label=Maximum value=100>
 </datalist>
</fieldset>
```

## `legend`要素

`legend`要素は、`fieldset`要素のキャプションを表します。


## フォームコントロールの共通属性
### 名前フォームコントロール：`name`属性
<!--もうちょっと説明を深化したほうがよさげ-->
フォームコントロールで用いる`name`属性は、フォームコントロールの名前を与えます。`a`要素に付与する`name`属性（`id`属性のように使用されていました）とは役割が異なることに注意してください（これは廃止されました）。

処理系によっては、`name`属性の後に`[]`を付与することによって、配列のようにデータを扱うことができます。

```html
<input type=checkbox name="animal[]" value="cat"> ねこ
<input type=checkbox name="animal[]" value="dog"> いぬ
```

### 入力長さの制限：`maxlength`属性と`minlength`属性

`maxlength`属性は入力できる最大の文字数を、`minlength`属性は入力に必要な最小の文字数をそれぞれ指定します。両方が指定される場合、`minlength`属性の値は`maxlength`属性の値以下でなければなりません。

文字数は、Infra標準で説明される、JavaScript長さで数えられます<!--U+xxxxとかで説明した方がよいのか？-->。`textarea`要素にこれらの属性が指定される場合、改行は、1文字として数えられます。

### フォームコントロールの有効化および無効化：`disabled`属性
<!--もうちょっと説明が必要？-->
`disabled`属性が設定される場合、そのフォームコントロールは無効にされます。無効な要素は、アクティブにできませんし、フォーカスを当てることもできません。

### フォームコントロールを自動フォーカスする：`autofocus`属性

`autofocus`属性は、ページ読み込み時にフォーカスを持つことを指定するものです。1つのフォーム要素に複数設定してはなりません。

自動的にフォーカスを奪うため、利用者の混乱をかえって招く可能性があることに注意すべきでしょう。

### オートフィルフォームコントロール：`autocomplete`属性

`autocomplete`属性は、フォームコントロールがどのような目的で提供されるかを示唆すると同時に、ユーザーエージェントへのヒントの手段に使用できるものです。

例えば、氏名や住所、URLやメールアドレス、性別やクレジットカードの番号などと言った意味をフォームコントロールに付与することができます。完全な属性の値と組み合わせについては、仕様を参照してください。

たとえば、フォームで2つの配送先住所がある場合、次のようにマークアップできます。

<!--何かわかりやすい例を作成 以下はHTMLStdからの複写-->
```html
<fieldset>
 <legend>1つ目のギフトの配送先</legend>
 <p> <label>郵便番号: <input name=bp autocomplete="section-blue shipping postal-code"> </label>
 <p> <label>都道府県: <input name=bc autocomplete="section-blue shipping address-level1"> </label>
 <p> <label>住所:     <textarea name=ba autocomplete="section-blue shipping street-address"></textarea> </label>


</fieldset>
<fieldset>
 <legend>2つ目のギフトの配送先</legend>
 <p> <label>郵便番号: <input name=rp autocomplete="section-red shipping postal-code"> </label>
 <p> <label>都道府県: <input name=rc autocomplete="section-red shipping address-level1"> </label>
 <p> <label>住所:     <textarea name=ra autocomplete="section-red shipping street-address"></textarea> </label>
</fieldset>
```


`type=password`の入力欄では、`autocomplete`属性が特殊な働きをします。

https://developer.mozilla.org/ja/docs/Web/Security/Securing_your_site/Turning_off_form_autocompletion#the_autocomplete_attribute_and_login_fields
