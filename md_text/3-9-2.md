# フォーム（2）

前のChapterでは、フォームの基本となる`from`要素と`input`要素を紹介しました。ここでは、フォームを構成するその他の要素を紹介します。

## `button`要素

`button`要素は、ボタンを表します。`input`要素でもボタンを表現できますが、ラベルの指定の仕方が異なります。「送信」というボタンを`input`要素と`button`要素で実装すると、それぞれ以下のようになります。

```html
<!-- inputとbutton要素の比較 -->
<input type="submit" value="送信">
<button type="submit">送信</button>
```

ボタンについては、`input`要素のほかに、`a`要素や`div`要素などを用いて表現するケースもありますが、基本的には`button`要素で作成するようにします。ボタンを他の要素で作成した場合との比較については、Chapter4-4の事例1.で詳しく扱っていますので、そちらを参照してください。

### 内容モデル

`button`要素の内容モデルはPhrasingです。ただし、子孫要素にinteractiveの内容を入れることはできません。また、`tabindex`属性が指定されている要素も子孫要素にできません。

`button`要素の内容はボタンのラベルとなります。単純なテキストを入れるだけでなく、たとえば`img`要素を入れることもできるので、画像を用いた装飾が可能です。`input`要素によるボタンの表現はラベルに`img`要素のようなマークアップを含めることができないので、`button`要素のほうが表現力に優れていると言えます。
<!-- /内容モデル -->

### 属性

<!--
disabled — 共通
form — ? output要素のところで話に出てくるが説明なし、共通に入れるべき
formaction - 
formenctype
formmethod
formnovalidate
formtarget
name — 共通
type — 説明あり
value — 説明を追加
-->
`button`要素には後述するフォームコントロールの共通属性を指定できるほか、ボタンを押した際のフォーム送信の挙動に関連する属性があります。

#### `type`属性

`type`属性は、ボタンが押されたときの振る舞いを指定します。この属性は列挙型属性であり、次の表の値を取ります。

|値|挙動|
|--|--|
|`submit`|フォームを送信する|
|`reset`|フォームをリセットする|
|`button`|何もしない(*)|

(*) 主にJavaScriptと組み合わせて使用します

`type`属性のデフォルト値は`submit`です。`type`属性を指定しない場合、送信ボタンとなることに注意してください。フォーム送信を意図しない場合には、明示的に`type=button`を指定する必要があります。

`type=reset`を指定するとリセットボタンとなります。リセットボタンが押されると、対応するフォームに含まれるすべてのフォームコントロールが初期化されます。誤ってリセットボタンを押すと、入力内容のすべてが消えてしまい、取り返しが付かなくなります。リセットボタン自体には、押されたときに警告を出すような機能は備わっていません。必要に応じてJavaScriptなどで動作を制御し、本当にリセットするかどうかを確認するのも1つの方法です。そもそも、必要のないリセットボタンは配置しないのが賢明と言えます。

`type=button`を指定すると、ボタンを押しても何も起こりません。JavaScriptで独自の挙動を実装する際に利用します。先に述べた通り、デフォルトは`button`ではなく`submit`であることに注意してください。

#### `value`属性

`button`要素に`name`属性と`value`属性を指定すると、ボタンを押した際、その名前と値のペアがフォーム送信されるようになります。複数のボタンがあるフォームでは、どのボタンが押されたのかを識別するために利用することがあります。

`input`要素のボタンとは異なり、この`value`属性はボタンのラベルには利用されません。

### アクセシビリティ上の注意点

`button`要素のデフォルトのARIAロールは`button`です。スクリーンリーダーでは、ボタンのラベルとともに、ボタンであることが読み上げられます。逆に、ボタンに適切なラベルが与えられていない場合、単に「ボタン」としか読み上げられず、何をするボタンなのか伝わりません。特に、アイコンボタンなど、ボタンに画像しか入っていない場合は、画像に代替テキストを指定して適切なラベルテキストを設定する必要があります。

`type=button`のボタンには、JavaScriptによってさまざまな機能を与えることができます。ボタンの機能によっては、WAI-ARIAのステート（状態）を付与することによってセマンティクスを強化できる場合があります。たとえば、トグルボタンであれば`aria-pressed`属性を、ボタンがメニューを開閉するものであれば`aria-expanded`属性の利用を検討するとよいでしょう。WAI-ARIAの詳細はChapter4-2を参照してください。
<!-- /a11y note -->

## `select`要素

`select`要素は、選択肢から選択するためのコンボボックス、あるいはリストボックスのコントロールを表します。子要素として、`option`要素で選択肢を記述します。以下は選択肢からペットの種類を選択させる例です。

```html
<label>ペットを選びます:
  <select name="pet" required>
    <option value="" selected>--ペットの選択肢--</option>
    <option value="dog">いぬ</option>
    <option value="cat">ねこ</option>
    <option value="parakeet">インコ</option>
  </select>
</label>
```

選択肢の設定には、初期値となる`option`要素に`selected`属性を指定します。フォームを送信すると、選択されている`option`要素の`value`属性の値がサーバーに送信されます。詳しくは`option`要素を参照してください。

### 内容モデル

`select`要素の内容モデルは`option`要素または`optgroup`要素です。`optgroup`要素を使用すると、選択肢をグループ化してグループのラベルを表示できます。詳しくは`optgroup`要素を参照してください。
<!-- /内容モデル -->

### 属性

<!--
autocomplete — 共通、後述
disabled — 共通、後述
form — 共通、後述(新規追加)
multiple — 説明あり
name — 共通、後述
required - input要素を参照
size — 説明あり
-->
`select`要素には後述するフォームコントロールの共通属性を指定できるほか、`size`属性、`multiple`属性を指定できます。また、`input`要素と同様に`required`属性を指定できます。

#### `size`属性

`size`属性は、ユーザーに一度に見せる選択肢の数を指定します。属性を指定しない場合のデフォルト値は"`1`"で、この場合はコンボボックスとして表現されます。多くのブラウザーではプルダウン式のリストとして表現されますが、モバイル端末ではドラムロール型のUIで表現されることもあります。UIの表現方法は仕様で規定されていないため、別の表現方法になる可能性もあります。

![スクリーンショット: Chromeでコード例を表示したところ。展開前は省スペースで表示されている](../img/3-9-2-01.png)
![スクリーンショット: Chromeでコード例を表示したところ。クリックするとリストが展開される](../img/3-9-2-02.png)
<!-- モバイルデバイスの表示例も載せる? -->
<!-- キャプションによる説明が必要では -->

`size`属性に"`2`"以上の値を指定すると、リストボックスとして表現されます。多くのブラウザーではリストボックスの高さが広がり、複数の選択肢が一度に見えるようになります。

![スクリーンショット: Chromeでsize=5の例を表示したところ。リストが縦に展開されている](../img/3-9-2-03.png)

`select`要素のコントロールは提示した選択肢から選ばせる機能を提供しますが、ラジオボタンでも同じ機能を実現できます。見た目や操作方法が異なるので、ユーザーにとって使いやすいと思われるほうを選択するとよいでしょう。

#### `multiple`属性

`multiple`属性を指定すると、選択肢の複数選択が可能になります。`multiple`属性はブール型属性です。

`multiple`属性が指定されている場合、多くのブラウザーでは、`size`属性の値が"`1`"であっても選択肢のすべてを展開して表示します。

複数選択をする場合、<kbd>ctrl</kbd>もしくは<kbd>cmd</kbd>キーを押しながらリスト項目を選択するといった独自の操作が必要になります。この操作に慣れているユーザーは少なく、複数選択が可能なコントロールはあまり使われません。<!--個人的には一発太郎 ( https://www.ippatsu.net/ ) でしか見たことがない-->複数選択が必要な場合は、チェックボックスによる提供を検討するとよいでしょう。

![スクリーンショット: Chromeでmultipleを指定した例を表示したところ。最初からリストが展開されている](../img/3-9-2-03.png)

#### `required`属性

`required`属性は`input`要素と同様に指定できますが、`select`要素で利用する場合、以下の条件をすべて満たす必要があります。

- `multiple`属性が指定されていない
- `size`属性の値が1である（`size`属性が省略されている場合を含む）
- 最初に登場する`option`要素の親が`select`要素である（`optgroup`要素ではない）
- 最初に登場する`option`要素の`value`属性の値が空文字列である

このとき、最初に登場する`option`要素を「プレースホルダーラベルオプション」(placeholder label option)と呼びます。`required`属性を指定した場合、プレースホルダーラベルオプションを選択している状態は未入力状態とみなされ、この状態で送信するとエラーになります。

`selected`属性は無関係であることに注意してください。また、プレースホルダーラベルオプションは、`value`属性の値が空文字列であり、かつ先頭になければなりません。以下は不適切な例です。

```html
<select name="pet" required>
  <option value="dog">いぬ</option>
  <option value="cat">ねこ</option>
  <option value="parakeet">インコ</option>
  <option value="" selected>その他・無回答</option>
</select>
```

この例では、初期状態で「その他・無回答」が選ばれ、かつ`value`属性の値が空文字列です。しかし、この`option`要素は先頭にはないため、プレースホルダーラベルオプションとはみなされません。そのため、どの選択肢を選んで送信してもエラーになりません。

### アクセシビリティ上の注意点

`select`要素のデフォルトのARIAロールは、`size`属性と`multiple`属性によって変化します。どちらの属性もないか、または`size=1`の場合、ロールは`combobox`です。スクリーンリーダーは、`select`要素に関連付けされたラベルを読み上げ、さらに「コンボボックス」などと読み上げることがあります。

`size`属性が2以上、または`multiple`属性がある場合は`listbox`ロールとなります。スクリーンリーダーは、`select`要素に関連付けられたラベルを読み上げ、さらに「リストボックス」などと読み上げることがあります。

いずれの場合も、ラベルが関連付けされていないと何を選択するのか伝わらないため、`label`要素を適切に使用して関連付けておくべきです。
<!-- /a11y note -->

## `option`要素

`option`要素は`select`要素や`datalist`要素とセットで扱い、個々の選択肢を表現します。用例は`select`要素、`datalist`要素を参照してください。

### 内容モデル

`option`要素の内容はテキストです。ただし、`label`属性と`value`属性の両方が指定されている場合には、`option`要素の内容モデルはNothingとなり、内容を含めることはできません。
<!-- /内容モデル -->

### 属性

<!--
disabled — 共通、後述
label — 説明あり
selected — 説明あり
value — 説明あり
-->
`option`要素には、後述するフォームコントロールの共通属性のうち`disabled`属性を指定できます。また、`value`属性、`label`属性、`selected`属性を指定できます。

#### `value`属性

`value`属性は、フォーム送信時に送信される値を指定します。この属性を省略した場合は、要素の内容となっているテキストが値として送信されます。

#### `label`属性

`label`属性を指定すると、選択肢として表示されるラベルを指定できます。この属性を省略した場合は、要素の内容となっているテキストがラベルとなります。通常はこの属性を使用する必要はありません。

#### `selected`属性

`selected`属性を指定すると、その`option`要素がデフォルトで選択されている状態になります。`selected`属性はブール型属性です。

### アクセシビリティ上の注意点

`option`要素のデフォルトのARIAロールは、要素のコンテキストによって異なります。`listitem`ロールである`select`要素が祖先の場合、または祖先が`datalist`要素である場合は、`option`ロールとなります。`combobox`ロールである`select`要素が祖先の場合、特定のロールは持たず、コンボボックスの一部として扱われます。この場合、ブラウザーによっては内部的に`menuitem`ロールとして扱うことがあります。
<!-- /a11y note -->

## `optgroup`要素

`select`要素の中で`optgroup`要素を使用すると、`option`要素をグループ化できます。`label`属性が必須であり、これがグループの名前となります。

```html
<select>
  <optgroup label="ほ乳類">
    <option>いぬ</option>
    <option>ねこ</option>
  </optgroup> 
  <optgroup label="鳥類">
    <option>インコ</option>
  </optgroup>
</select>
```

これはたとえば以下のように表示されます。

![スクリーンショット: Chromeでoptgroupの例を表示したところ。optgroupのラベルが選択できない形で表示されている](../img/3-9-2-04.png)

すべての`option`要素を`optgroup`要素に入れる必要はなく、`optgroup`要素に属さない`option`要素を混在させることもできます。

```html
<select>
  <optgroup label="ほ乳類">
    <option>いぬ</option>
    <option>ねこ</option>
  </optgroup> 
  <option>その他</option>
</select>
```

### 内容モデル

`optgroup`要素の内容モデルは0個以上の`option`要素です。`option`要素以外のものを入れることはできません。また、`optgroup`要素を入れ子にできません。なお、`option`要素は0個でもよいため、意味があるかはともかく、空の`optgroup`要素を使うことも可能です。
<!-- /内容モデル -->

### 属性

<!--
disabled — 共通、後述
label — 説明あり
-->
`optgroup`要素には、`label`属性と`disabled`属性を指定できます。`optgroup`要素はあくまでグループのラベルを表現するもので、この要素自体の選択はできません。そのため、`selected`属性や`value`属性はありません。

#### `label`属性

`label`属性でグループの名前を指定します。この属性は必須で、省略できません。

#### `disabled`属性

`disabled`属性については、「フォームコントロールの共通属性」を参照してください。`optgroup`要素の場合、この要素自身はもともと選択できませんが、`disabled`属性を指定すると、子の`option`要素すべてが無効の状態になります。

### アクセシビリティ上の注意点

`optgroup`要素のデフォルトのARIAロールは`group`です。スクリーンリーダーでは、ラベルを読み上げたあとに「グループ」などと読み上げ、選択肢のグループの名前がわかるように伝えるでしょう。
<!--
 しかしスクリーンリーダーの実際の対応状況は厳しいかも。
 最新のMacOS VoiceOverはoptgroupを特にそれらしくは読まず「淡色表示 {ラベル}」などと読む (見た目が淡色表示になっているのでそのまま読んでいる模様。とてもわかりにくい)。
 2014年時点ではNVDAも対応していなかった模様。https://waic.jp/docs/as/info/201406/H85-2.html
 最新の状況は要確認。
-->
<!-- /a11y note -->

## `datalist`要素

`datalist`要素は、ユーザーに提案する定義済み候補のリストを示します。`input`要素と組み合わせて使用し、対応する`input`要素の入力時に入力補完の候補を示します。`datalist`要素の子孫要素である`option`要素が候補として提示されます。

`datalist`要素に`id`属性を指定し、`input`要素の`list`属性でそのIDを指定することにより、候補と結び付けます。以下は、テキスト入力欄に対して入力補完候補を提示する例です。

```html
<label for="ice-cream-choice">アイスクリームのフレーバー:</label>
<input list="ice-cream-flavors" id="ice-cream-choice" name="ice-cream-choice">

<datalist id="ice-cream-flavors">
  <option value="Chocolate">
  <option value="Coconut">
  <option value="Mint">
  <option value="Strawberry">
  <option value="Vanilla">
</datalist>
```

これはたとえば以下のように表示されます。

![スクリーンショット: Chromeでサンプルを表示した例。入力欄にフォーカスすると、プルダウンメニューが出現して補完候補が表示される](../img/3-9-2-05.png)

この例では、ユーザーは選択肢から選ぶこともできますし、選択肢を無視した任意のテキストの入力もできます。

テキスト入力以外にも、日付の入力、範囲の入力、カラーピッカーのコントロールなどに対して候補を提示できます。`datalist`要素による補完候補を利用できるのは、`type`属性が`text`、`search`、`url`、`tel`、`email`、`date`、`month`、`week`、`time`、`datetime-local`、`number`、`range`、`color`の場合です。

`type=range`に適用すると、候補リストを表示するのではなく、提示された場所に目盛りが表示され、そこへスナップするような動作になります。具体的な使用例は、Chpter3-9の`type=range`を参照してください。

### 内容モデル

`datalist`要素の内容モデルは、`option`要素もしくはPhrasingです。通常は`option`要素を入れますが、`datalist`要素に対応していないブラウザーに対するフォールバックコンテンツを入れることもできます。以下はその一例です。

```html
<label>
  動物の名前を入力してください:
  <input name="animal" list="animals">
</label>
<datalist id="animals">
  <label>
    もしくは、以下から選択してください:
    <select name="animal">
      <option value="">--選んでください--</option>
      <option>猫</option>
      <option>犬</option>
    </select>
  </label>
</datalist>
```

`datalist`要素に対応していないブラウザーの場合、内容である`label`要素および`select`要素が表示され、`option`要素は`select`要素の選択肢となります。

`datalist`要素に対応したブラウザーの場合、`datalist`要素の内容は表示されず、子孫の`option`要素が`input`要素の入力補完候補として利用されることになります。
<!-- /内容モデル -->

<!-- datalist要素の属性はglobalのみ　-->

### アクセシビリティ上の注意点

`datalist`要素のデフォルトのARIAロールは`listbox`です。`datalist`要素と結び付けられたコントロールにフォーカスすると、スクリーンリーダーは「候補リストが表示されました」などと読み上げ、補完候補があることをユーザーに伝えます。
<!-- /a11y note -->

## `textarea`要素

`textarea`要素は、複数行のテキストを入力・編集するフォームコントロールを表します。`type=text`を持つ`input`要素と異なり、改行が入力可能です。コメント欄やお問い合わせフォームの本文入力欄など、ユーザーが自由記述のテキストを入力するときに利用します。

以下は`textarea`要素を使用した例です。

```html
<label for="advanced">高度な例:
  <textarea id="advanced" name="advanced"
            rows="3" cols="33" maxlength="200">
  rows属性とcols属性でサイズが指定されたtextarea要素。最大文字数は、maxlengthによって200に制限されています。
  </textarea>
</label>
```

### 内容モデル

`textarea`要素の内容モデルはテキストです。`type=text`の`input`要素ではテキストの初期値を`value`属性で指定しますが、`textarea`要素では要素の内容が初期値となります。改行を含めることも可能です。
<!-- /内容モデル -->

### 属性

<!--
autocomplete — 共通
name — 共通
disabled — 共通
form — 共通
dirname — 共通
maxlength — `input`要素を参照
minlength — `input`要素を参照
placeholder `input`要素を参照
readonly — `input`要素を参照
required — `input`要素を参照

cols — 後述
rows — 後述
wrap — 後述
-->
`textarea`要素にはフォームコントロールの共通属性を指定できるほか、`type=text`の`input`要素と同様に、以下の属性を指定できます。詳しくは`input`要素を参照してください。

- `maxlength`属性
- `minlength`属性
- `required`属性
- `placeholder`属性
- `dirname`属性

古いHTML4では`textarea`要素に`maxlength`属性が存在しませんでしたが、現在のHTMLでは指定できるようになりました。なお、`textarea`要素では`pattern`属性を使用できないことに注意してください。

この他に、`textarea`要素の挙動を制御する`rows`属性、`cols`属性、`wrap`属性が利用できます。

#### `rows`属性と`cols`属性

`rows`属性を用いて、入力欄を表示する行数を指定できます。指定がない場合のデフォルト値は"`2`"で、2行分が確保されます。この属性の指定は、入力可能な行数を制限するものではなく、指定した行数を超えた入力ができます。

同様に、`cols`属性で1行あたりの文字数を指定できます。指定がない場合のデフォルト値は"`20`"で、20文字分の幅が確保されます。後述の`wrap`属性を使用して`wrap=hard`を指定した場合、折り返しの文字数としても利用されます。詳しくは`wrap`属性を参照してください。

`input`要素の`size`属性と同様、`cols`属性で指定した文字数が必ずしも入るわけではないことに注意してください。文字の幅は文字によって異なるため、使用しているフォントの文字幅の平均によって幅が計算されます。

なお、`textarea`要素の幅や高さは、スタイルシートによる設定も可能であり、設置した場合、`rows`属性や`cols`属性による指定を上書きします。

多くの場合、幅や高さはブラウザー上で変更可能です。文字数と幅や高さによっては、スクロールバーを表示することがあります。
<!--
https://html.spec.whatwg.org/multipage/rendering.html#textarea-effective-width
The textarea effective width of a textarea element is size×avg + sbw, where size is the element's character width, avg is the average character width of the primary font of the element, in CSS pixels, and sbw is the width of a scrollbar, in CSS pixels. (The element's 'letter-spacing' property does not affect the result.)
-->

#### `wrap`属性
<!-- wrap属性は実務でほぼ使わないけれど面白いので説明してしまう。コラム扱いでも可 -->
`wrap`属性を指定すると、フォーム送信時の長い行の折り返し処理を制御できます。`wrap`属性は列挙型属性で、"`soft`"または"`hard`"のいずれかを指定します。"`hard`"を指定すると、フォーム送信時に、入力欄の端で自動的に折り返した部分に改行（CRLF, %0d%0a）が挿入されます。指定がない場合のデフォルト値は"`soft`"です。この場合、長い行が入力欄の端で自動的に折り返しても、その部分に改行は挿入されません。

以下は`wrap=hard`を指定した例です。

```html
<textarea name="wrapped" wrap="hard" cols="10">
this is a textarea element
</textarea>
```

内容のテキストに改行は含まれていませんが、`wrap="hard"`と`cols="10"`が指定されているため、10文字ごとに折り返されて改行が挿入されます。GETメソッドで送信すると以下のようになります。

```text
wrapped=this+is+a+%0D%0Atextarea+%0D%0Aelement%0D%0A
```

なお、`wrap=hard`を指定した場合は`cols`属性が必須です。
<!--
https://html.spec.whatwg.org/multipage/form-elements.html#attr-textarea-wrap
>If the element's wrap attribute is in the Hard state, the cols attribute must be specified.
`cols`属性の省略時のデフォルト値は"20"なのだから省略してもcols=20として扱えば問題なさそうに思えるし、実際にChromeもcols=20として動作する。とはいえ、仕様には必須と書いてあるから必須なのだとしか言いようがない。Nu Html Checkerでもしっかりエラーになる。
-->

### アクセシビリティ上の注意点

`textarea`要素のデフォルトのARIAロールは`textbox`です。多くのスクリーンリーダーは、ラベルを読み上げたのち、「テキストを編集」「複数行テキスト入力」などと読み上げ、そのあとに入力されている内容を読み上げます。

ラベルが指定されていないと何を入力すべきかわからなくなってしまいます。`label`要素と組み合わせて確実にラベルを指定することを奨めます。
<!-- /a11y note -->

## `output`要素

`output`要素は、アプリケーションによって実行された処理の結果や、ユーザー操作によって得られた結果を表します。主にJavaScriptの実行結果の出力先として利用します。実行結果を表すものとしては`samp`要素もありますが、`samp`要素は実行済みのサンプルを静的に表現するものです。`output`要素は、動的な実行結果の出力先のプレースホルダーとして利用します。

実行結果の出力先には`span`要素など他の要素も利用できますが、`output`要素には、JavaScriptによる動的処理に適した以下のような機能があります。

- `value`プロパティを通じて値の読み書きができる（ただし、HTMLを書くときに`value`属性の指定はできません）
- `id`属性だけでなく、`name`属性でも名前を付けることができる
- デフォルトのARIAロールが`status`であり、値が変化した際に支援技術に対して通知する機能を持つ
- フォーム内に配置した場合、同一フォーム内のリセットボタンで値を初期値に戻すことができる

次は、簡単な足し算を行う電卓アプリケーションの例です。

```html
<form onsubmit="return false" oninput="o.value = a.valueAsNumber + b.valueAsNumber">
  <input id="a" type="number" step="any"> +
  <input id="b" type="number" step="any"> =
  <output id="o" for="a b"></output>
</form>
```

### 内容モデル

`output`要素の内容モデルはPhrasingです。出力結果に強調などのマークアップを含めることもできます。ただし、`output`要素の`value`プロパティでは内容のテキストしか取得・設定できません。マークアップを含む内容を扱う場合には、`value`プロパティを使わずにDOM操作によって処理する必要があります。
<!-- /内容モデル -->

### 属性

<!--
for — 説明あり、見出し立てる
form — 共通
name — 共通
-->
`output`要素には`for`属性、`form`属性、`name`属性を指定できます。`form`属性、`name`属性については、フォームコントールの共通属性を参照してください。

#### `for`属性

`for`属性を利用すると、この`output`要素に関連する入力欄を示すことができます。`for`属性の属性値には、対応する要素のIDをスペース区切りで記述します。

### アクセシビリティ上の注意点

`output`要素のデフォルトのARIAロールは`status`です。`status`ロールはライブリージョンであり、内容が変化すると支援技術に通知されます。

先に挙げた例では、ボタンを押すと数値が増加し、その数値が読み上げられます。ボタンからフォーカスを移動しなくても結果を知ることができるため、ユーザーはボタンを連打しながら数値を確認できます。

デフォルトでは、ARIA属性`aria-live=polite`と`aria-atomic=true`が設定されている状態と同じになります。つまり、`output`要素の内容が変化すると、他の読み上げが一段落したあとで、`output`要素の内容すべてを読み上げます。ライブリージョンの詳細についてはChapter4-2を参照してください。

また、`output`要素は「ラベル付け可能要素」(labelable element)に分類されているため、必要に応じて`label`要素と関連付けることもできます。出力内容を単独で読み上げても理解しにくい場合には、ラベルを付けることを検討してもよいでしょう。
<!-- /a11y note -->

## `progress`要素

`progress`要素は、タスクの進捗状況を表します。これは通常、プログレスバーとしてレンダリングされます。以下は、進捗率が半分の状態のプログレスバーを表示した例です。

```html
<progress value="0.5">50%</progress>
```

![スクリーンショット: MacのChromeでprogress要素を表示した例。横棒の左半分が青く塗りつぶされ、右半分は灰色](../img/3-9-2-06.png)

この要素は動的な進捗状況を表現するものであることに注意してください。単に割合をグラフとして表示したい場合には、後述の`meter`要素などを利用します。
`progress`要素を実際に利用する場合は、進捗状況を動的に反映させるために、JavaScriptから`value`プロパティの値を操作します。

<!-- HTML LSからのコピーだが、サンプルコードを見直すべきか。issue #156も参照。 -->
```html
<progress id="progress_bar" max="100" value="0"><span>0</span>%</progress>
  <script>
  const progressBar = document.getElementById('progress_bar');
  function updateProgress(newValue) {
    progressBar.value = newValue;
    progressBar.firstElementChild.textContent = newValue;
  }
</script>
```

この例では、`updateProgress()`関数を外部から呼び出すことで`progress`要素の値を更新できます。

### 内容モデル

`progress`要素の内容モデルはPhrasingです。ただし、`progress`要素を子孫に持つことはできません。

`progress`要素の内容は表示されませんが、`progress`要素を理解しないブラウザーに対するフォールバックとして機能します。先の例のように、テキストを入れて進捗状況がわかるようにしておき、プログレスバーの更新と同時に内容のテキストも更新するとよいでしょう。
<!-- /内容モデル -->

### 属性

<!--
value — 説明あり、見出し立てる
max — 説明あり、見出し立てる
-->
`progress`要素には`value`属性と`max`属性を指定できます。

#### `value`属性

`value`属性で進捗の現在値を表します。属性値は任意の浮動小数点数です。`max`属性が指定されていない場合、`value`属性は0.0〜1.0のいずれかの値を取り、1.0の場合に進捗が完了したことになります。負の値も指定可能ですが、プログレスバー上では負の値は表現されず、0のときと同じ表示になります。

`value`属性を省略すると、値は「不定」(indeterminate)となります。これは、`progress`要素で表すタスクが処理中であるものの、完了が予測できない状態を表します。多くのブラウザーは、プログレスバー自体がローディング中であるような表示をします。

#### `max`属性

`max`属性で進捗の最大値を指定できます。`max`属性が指定されていると、`value`属性の値は`max`属性の値に対する割合として扱われます。たとえば、`max=100`を指定すると、`value=50`のときに半分、`value=100`のときに最大となります。

なお、`max`属性に0以下の値の指定はできません。0や負の値を指定すると、不正な値とみなされて`max`属性は無視されます（その結果として初期値が採用され、`max=1.0`を指定した場合と同じように動作します）。

`progress`要素に`min`属性はありません。最小値は変更できず、常に0となります。

### アクセシビリティ上の注意点

`progress`要素のデフォルトのARIAロールは`progressbar`です。スクリーンリーダーは、進捗の割合を読み上げた上でこのコントロールの名前を読み上げます。たとえば、「50% 進行インジケーター」のように読み上げることがあります。

ライブリージョンの機能は持たないため、進捗状況が変化しても自動的に読み上げられるわけではありません（プログレスバーが変化するたびに読み上げられると煩わしい場合が多いでしょう）。

`progress`要素は「ラベル付け可能要素」(labelable element)に分類されているため、必要に応じて`label`要素と関連付けることもできます。文脈から何を表しているのかがわかれば問題ありませんが、単独で読み上げても理解しにくい場合には、ラベルを付けることを検討してもよいでしょう。
<!-- /a11y note -->

## `meter`要素

`meter`要素は、一定範囲に収まるスカラー量や、割合で表現できる値を表します。たとえば、ディスク使用量や投票率などです。これは通常、棒グラフのようなゲージとしてレンダリングされます。以下は0.75（75%、3/4）のゲージを表示する例です。

```html
<meter value="0.75">0.75</meter>
```

![スクリーンショット: MacのChromeでmeter要素を表示した例。横棒の左3/4が緑色で塗りつぶされ、右半分は灰色](../img/3-9-2-07.png)

見た目は前述の`progress`要素と似た表現になります。動的に変化する進捗状況を表現したい場合には`progress`要素を、そうでない場合には`meter`要素を使います。

### 内容モデル

`meter`要素の内容モデルはPhrasingです。ただし、`meter`要素を子孫に持つことはできません。

`meter`要素の内容は表示されませんが、`meter`要素を理解しないブラウザーに対するフォールバックとして機能します。先の例のように、テキストを入れて進捗状況がわかるようにしておくとよいでしょう。
<!-- /内容モデル -->

### 属性

<!--
すべて説明あり、見出しどうするか
value — Current value of the element
min — Lower bound of range
max — Upper bound of range
low — High limit of low range
high — Low limit of high range
optimum — Optimum value in gauge
-->

#### `value`属性

`value`属性で割合を表します。属性値は任意の浮動小数点数です。`min`属性や`max`属性が指定されていない場合、`value`属性は0.0〜1.0までのいずれかの値をとり、1.0の場合に最大となります。

負の値を指定可能ですが、`min`属性で指定した最小値（`min`属性がない場合は0）を下回る値は表現できず、最小値のときと同じ表示になります。同様に、`max`属性で指定した最大値（`max`属性がない場合は1）を超える値を指定すると、最大値のときと同じ表示になります。

#### `min`属性、`max`属性

`min`属性、`max`属性を指定すると、それぞれゲージの最小値、最大値を表します。指定できる値は任意の浮動小数点数で、負の値も設定可能です。ただし、`min`属性と`max`属性の両方を指定する場合、`min`属性の値よりも`max`属性の値のほうが大きくなくてはなりません。

以下は、-100℃から200℃までの温度を表現するゲージの例です。

```html
<meter min="-100" max="200" value="10">10℃</meter>
```

#### `low`属性、`high`属性

ときには、値が一定の範囲を超えた場合にゲージの見た目を変えて、ユーザーに注意を促したいこともあるでしょう。

`low`属性と`high`属性を使用すると、低い値、高い値の閾値<!-- 元々は「いきち」と読むが最近「しきいち」と読まれることも多い -->を指定できます。`low`属性で指定した値以下の値は、低い値であるとみなされます。同様に、`high`属性で指定した値以上の値は、高い値であるとみなされます。

前出の温度ゲージに閾値を追加し、0℃以下を低温、100℃以上を高温とみなすようにすると、以下のようになります。

```html
<meter min="-100" low="0" high="100" max="200" value="10">10℃</meter>
```

`value`属性の値を-50、50、150にしたものを並べてみると、以下のようになります。

```html
<meter min="-100" low="0" high="100" max="200" value="-50">-50℃</meter>
<meter min="-100" low="0" high="100" max="200" value="50">50℃</meter>
<meter min="-100" low="0" high="100" max="200" value="150">150℃</meter>
```

これはたとえば以下のように表示されます。

![スクリーンショット: Chromeで表示された温度ゲージの例。ゲージが3本並んでおり、左から順にバーが長くなっていく。中央のゲージは緑色で、左右のゲージは黄色で表現されている](../img/3-9-2-08.png)

50℃は適温と判断されて通常の表示となり、-50℃は低温、150℃は高温と判断されて色が変化しています。

#### `optimum`属性

`optimum`属性は、どのレンジの値が適切な値であるのか指定します。先に挙げた`low`属性、`high`属性の使用例では、中間のレンジを適温（適切な値）としていました。`optimum`属性を利用すると、より低い値や、より高い値を適切な値にできます。

属性値は浮動小数点数で指定し、その値を含むレンジが適切な値であるとみなされます。先の例で`optimum=-100`を指定すると以下のようになります。

```html
<meter min="-100" low="0" high="100" max="200" optimum="-100" value="-50">-50℃</meter>
<meter min="-100" low="0" high="100" max="200" optimum="-100" value="50">50℃</meter>
<meter min="-100" low="0" high="100" max="200" optimum="-100" value="150">150℃</meter>
```

これはたとえば以下のように表示されます。

![スクリーンショット: Chromeで表示された温度ゲージの例。ゲージが3本並んでおり、左から順にバーが長くなっていく。左のゲージは緑、中央のゲージは黄色、右のゲージは赤で表現されている](../img/3-9-2-09.png)

-50℃は適温と判断されて通常の表示となり、50℃は高温と判断されて色が変化しています。150℃は超高温と判断され、さらに色が変化しています。

`optimum`属性を省略した場合の初期値は、最小値と最大値の中間の値となります。言い換えれば`min`属性と`max`属性の値の平均です。`low`属性と`high`属性の平均値ではないことに注意してください。
<!--
>Otherwise, the candidate optimum point is the midpoint between the minimum value and the maximum value.
-->

以下は、先の例の`min`属性と`max`属性の値を変更し、温度の範囲を-273℃から1000℃とした例です。`optimum`属性は省略されています。

```html
<meter min="-273" max="1000" value="50" low="0" high="100">50℃</meter>
```

この例では`optimum`属性を省略しているため、`min`属性と`max`属性の値の中間である363.5という値が含まれるレンジ、すなわち`high`属性の値以上のレンジが適切であるとみなされます。

### アクセシビリティ上の注意点

`meter`要素にデフォルトのARIAロールはありません。スクリーンリーダーは、ゲージの割合を読み上げた上で「レベルインジケーター」などと読み上げることがあります。`low`および`high`属性を使用しているケースについては、特別な読み上げはなされず、値が特定のしきい値を超えていることが伝わらない場合があります。

`meter`要素は「ラベル付け可能要素」(labelable element)に分類されているため、必要に応じて`label`要素と関連付けることもできます。文脈から何を表しているのかがわかれば問題ありませんが、単独で読み上げても理解しにくい場合には、ラベルを付けることを検討してもよいでしょう。
<!-- /a11y note -->

## `fieldset`要素

`fieldset`要素は、一連のフォームコントロールをグループ化します。`legend`要素を使用してグループにラベルを付けることもできます。主にラジオボタンやチェックボックスのグループにラベルを付けるのに使いますが、他の種類のコントロールをグループ化できます。以下は、いくつかの種類のコントロールをグループ化してラベルを付けた例です。

```html
<fieldset>
  <legend>ディスプレイ表示</legend>
  <p><label><input type="radio" name="c" value="0" checked>黒地に白字</label>
  <p><label><input type="radio" name="c" value="1">白地に黒字</label>
  <p><label><input type="checkbox" name="g">グレースケールを使用する</label>
  <p><label>コントラストを強調する <input type="range" name="e" list="contrast" min="0" max="100" value="0" step="1"></label>
  <datalist id="contrast">
    <option label="Normal" value="0">
    <option label="Maximum" value="100">
  </datalist>
</fieldset>
```

### 内容モデル

`fieldset`要素の内容モデルは、オプションで単一の`legend`要素と、Flowです。`legend`要素は省略可能ですが、使用する場合は`fieldset`要素の最初の子要素である必要があります。また、`legend`要素は`fieldset`要素の直接の子要素でなければならないため、`fieldset`要素を`div`要素や他の要素で囲むことはできません。<!--たまにやろうとする人がいるのですが、できません。-->

`legend`要素のあとには、Flowのコンテンツを自由に置くことができます。`p`要素で説明文を書いたり、`ul`要素で複数のフォームコントロールをリスト化したりできます。`fieldset`要素の中に他の`fieldset`要素を入れ子にもできます。

見出しを入れることもできます。参考として、アウトラインアルゴリズムでは`fieldset`要素はセクショニングルートとなり、見出しを入れた場合に、外のアウトラインとは独立したアウトラインが作られます。
<!-- /内容モデル -->

### 属性

<!--
disabled — 共通属性だが特殊な効果があり要説明
form — 共通、後述
name — 共通だが特殊な効果あり。あまり使わないが、仕様にはコード例も出ているし取り上げた方が良いか。共通のname属性のところで書くかか。
-->

`fieldset`要素には`disabled`属性、`name`属性、`form`属性が指定できます。`form`属性については、フォームコントロールの共通属性を参照してください。

#### `disabled`属性

`disabled`属性については、「フォームコントロールの共通属性」を参照してください。`fieldset`要素の場合、この要素自身はもともと選択できませんが、`disabled`属性を指定すると、子孫のフォームコントロールをまとめて無効にできます。

このとき無効になるのは、`fieldset`要素の子孫であり、かつ`legend`要素の子孫ではないフォームコントロールです。`legend`要素の中にあるフォームコントロールは無効になりません。

#### `name`属性

`fieldset`要素に`name`属性を指定すると、グループに名前をつけられます。この名前は、JavaScriptから参照する際に利用できます。フォームコントロールの`name`属性と異なり、フォーム送信時にこの名前がデータとして送信されることはありません。

### アクセシビリティ上の注意点

`fieldset`要素のデフォルトのARIAロールは`group`です。多くのスクリーンリーダーは、グループ内の最初のフォームコントロールへフォーカスしたときにグループのラベルを読み上げます。`legend`要素を使用してラベルを付けることを勧めます。

ラジオボタンやチェックボックスに使用する場合、`label`要素によるラベルは個々の選択肢の名前となります。選択肢だけを読み上げられても、何に対する選択なのかわからないことが多いため、`fieldset`要素と`legend`要素でグループ全体にラベルを付けるとよいでしょう。<!-- legend要素に2回言及しているが… -->

ラジオボタンをグループ化している場合は、`role=radiogroup`を指定できます。<!--この情報いる? スクリーンリーダーで何か変わる? -->
<!-- /a11y note -->

## `legend`要素

`legend`要素は、`fieldset`要素のキャプションを表します。`fieldset`要素で表したグループのラベルとして機能します。使い方については`fieldset`要素を参照してください。

### 内容モデル

`legend`要素の内容モデルはPhrasingですが、オプションで見出し要素を混在させることができます。`legend`要素に見出しを入れると、グループのラベルと見出しを兼ねさせることができます。

```html
<fieldset>
  <legend><h2>希望する連絡方法</h2></legend>
  <ul>
    <li><label><input type="radio" name="contact" checked>電子メール</label></li>
    <li><label><input type="radio" name="contact">電話</label></li>
    <li><label><input type="radio" name="contact">ファクシミリ</label></li>
  </ul>
</fieldset>
```

見出しはあくまでオプションであり、必須ではありません。通常は単にテキストを入れることが多いでしょう。Phrasingが入りますので、テキストをマークアップしたり、フォームコントロールを入れたり、`label`要素を入れたりもできます。ただし、`legend`要素の内容はグループのラベルとして使用されるものですので、あまり長いテキストを入れると理解が難しくなるかもしれません。

繰り返しになりますが、見出しを除き、Phrasingではない要素を入れることはできません。たとえば、`div`要素は入れられませんので注意してください。
<!-- /内容モデル -->

<!-- legendの属性はgobalのみ -->

### アクセシビリティ上の注意点

`legend`要素にデフォルトのARIAロールはありません。`legend`要素は`fieldset`要素のラベルとして扱われます。スクリーンリーダーは、`fieldset`要素内のフォームコントロールへフォーカスしたときに`legend`要素の内容を読み上げることがあります。
<!-- /a11y note -->
